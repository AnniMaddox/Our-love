import{r as c,j as e,cy as V,cz as te}from"./index-Gl0K_ej6.js";function G(){return{name:"",leftNick:"M",rightNick:"ä½ ",leftAvatarDataUrl:"",rightAvatarDataUrl:""}}function J(a){return a.trim().toLowerCase()}function ge(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function se(a,r,s){if(!a)return null;const n=J(a);return n?r.some(o=>J(o)===n)?"user":s.some(o=>J(o)===n)?"assistant":null:null}function Ne(a){const r=["content","message","text","body"];for(const s of r){const n=a[s];if(typeof n=="string"&&n.trim())return n.trim()}return""}function je(a){const r=["timestamp","time","datetime","date"];for(const s of r){const n=a[s];if(typeof n!="string")continue;const o=n.trim();if(!o)continue;const m=new Date(o);return Number.isNaN(m.getTime())?o.replace("T"," ").slice(0,16):`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}-${String(m.getDate()).padStart(2,"0")} ${String(m.getHours()).padStart(2,"0")}:${String(m.getMinutes()).padStart(2,"0")}`}}function ae(a,r){for(const s of r){const n=a.match(new RegExp(`^${ge(s)}\\s*[ï¼š:]\\s*(.*)$`,"i"));if(n)return(n[1]??"").trim()}return null}function ye(a,r){const s=V(r?.leftNick,"M"),n=V(r?.rightNick,"ä½ "),o=a.trim();if(o.startsWith("[")||o.startsWith("{"))try{const d=JSON.parse(o),N=Array.isArray(d)?d:[d],w=[];for(const b of N){if(!b||typeof b!="object")continue;const u=b,p=Ne(u);if(!p)continue;let j=null;const f=u.role;if(f==="user"||f==="assistant")j=f;else{const F=(typeof u.speaker=="string"?u.speaker:void 0)??(typeof u.name=="string"?u.name:void 0)??(typeof u.author=="string"?u.author:void 0)??(typeof u.from=="string"?u.from:void 0);j=se(F,n,s)}j&&w.push({role:j,content:p,time:je(u)})}if(w.length>0)return w}catch{}const m=a.split(`
`),g=[];let y=null,h="",A;function v(){y&&h.trim()&&g.push({role:y,content:h.trim(),time:A}),h="",A=void 0}for(const d of m){const N=d.trim();if(!N)continue;const w=N.match(/^\[(\d{4}-\d{2}-\d{2}[\sT]\d{2}:\d{2}(?::\d{2})?)\]/);if(w){A=w[1].replace("T"," ").slice(0,16);continue}const b=N.match(/^ã€(user|assistant)ã€‘\s*(?:\[([^\]]+)\])?(.*)$/i);if(b){v(),y=b[1].toLowerCase()==="user"?"user":"assistant",b[2]&&(A=b[2].replace("T"," ").slice(0,16));const f=(b[3]??"").trim();f&&(h=f);continue}const u=ae(N,n);if(u!==null){v(),y="user",h=u;continue}const p=ae(N,s);if(p!==null){v(),y="assistant",h=p;continue}const j=N.match(/^ã€([^ã€‘]+)ã€‘\s*(.*)$/);if(j){const f=se(j[1],n,s);f&&(v(),y=f,h=(j[2]??"").trim());continue}h&&(h+=`
`),h+=N}return v(),g}function re(a){return a.trim().toLowerCase()}function W(a){return a.replace(/\.(txt|md|docx|json)$/i,"")}function ne(a,r){return V(a,r)[0]??r}const ve=["#efeff4","#f6f1e7","#eaf1f6","#f4e9ef","#eef3e6"];function we(a){const r=a.chatBackgroundImageUrl.trim();if(!r)return{backgroundColor:a.chatBackgroundColor};const s=Math.max(0,Math.min(.9,a.chatBackgroundOverlay/100));return{backgroundColor:a.chatBackgroundColor,backgroundImage:`linear-gradient(rgba(255,255,255,${s}), rgba(255,255,255,${s})), url("${r}")`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}function ke(a,r){return a.trim()||r}function Ce(a){const r=a.trim();return r?r.startsWith("data:image/")||r.startsWith("http://")||r.startsWith("https://")||r.startsWith("/")||r.startsWith("./")||r.startsWith("../")||/\.(png|jpe?g|gif|webp|avif|svg)$/i.test(r):!1}function K({icon:a,fallback:r,imageClassName:s="h-6 w-6",textClassName:n="text-2xl leading-none"}){const o=ke(a,r);return Ce(o)?e.jsx("img",{src:o,alt:"",className:`${s} object-contain`}):e.jsx("span",{className:n,children:o})}function P({panelKey:a,openPanel:r,onToggle:s,title:n,subtitle:o,children:m}){const g=r===a;return e.jsxs("section",{className:"overflow-hidden rounded-2xl border border-stone-200 bg-white shadow-sm",children:[e.jsxs("button",{type:"button",onClick:()=>s(a),className:"flex w-full items-center gap-3 px-4 py-3 text-left transition hover:bg-stone-50",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm text-stone-800",children:n}),e.jsx("p",{className:"truncate text-xs text-stone-500",children:o})]}),e.jsx("span",{className:`text-xl leading-none text-stone-400 transition-transform ${g?"rotate-90":""}`,"aria-hidden":"true",children:"â€º"})]}),g&&e.jsx("div",{className:"border-t border-stone-200 p-4",children:m})]})}function Ue({logs:a,chatProfiles:r,settings:s,onSettingChange:n,onImportChatLogFiles:o,onImportChatLogFolderFiles:m,onClearAllChatLogs:g,onDeleteChatLog:y,onSaveChatProfile:h,onDeleteChatProfile:A,onBindLogProfile:v,onExit:d}){const[N,w]=c.useState(""),[b,u]=c.useState(""),[p,j]=c.useState(s.chatAppDefaultProfileId),[f,F]=c.useState(""),[B,H]=c.useState("messages"),[M,le]=c.useState("data"),[Y,E]=c.useState(s.chatBackgroundImageUrl),[oe,_]=c.useState(!1),[R,D]=c.useState(G),[T,z]=c.useState(""),[U,k]=c.useState(null),I=c.useMemo(()=>a.find(t=>t.name===N)??null,[a,N]),q=c.useMemo(()=>{const t=re(f);return t?a.filter(l=>re(l.name).includes(t)):a},[a,f]),$=c.useMemo(()=>r.find(t=>t.id===p)??r[0]??null,[r,p]),ce=c.useMemo(()=>r.find(t=>t.id===b)??$,[r,b,$]);c.useEffect(()=>{j(s.chatAppDefaultProfileId)},[s.chatAppDefaultProfileId]),c.useEffect(()=>{E(s.chatBackgroundImageUrl)},[s.chatBackgroundImageUrl]),c.useEffect(()=>{if(I){u(I.profileId??p);return}u("")},[I?.name,I?.profileId,p]),c.useEffect(()=>{!p||r.some(l=>l.id===p)||(j(""),n({chatAppDefaultProfileId:""}))},[r,p,n]),c.useEffect(()=>{if(!T)return;const t=r.find(l=>l.id===T);if(!t){z(""),k(null);return}k({name:t.name,leftNick:t.leftNick,rightNick:t.rightNick,leftAvatarDataUrl:t.leftAvatarDataUrl,rightAvatarDataUrl:t.rightAvatarDataUrl})},[r,T]);const ie=c.useCallback(t=>{w(t)},[]),X=c.useCallback(()=>{if(!a.length)return;const t=a[Math.floor(Math.random()*a.length)];w(t.name)},[a]),S=s.chatAppShowLabels,de=ne($?.leftNick,"Michael"),xe=$?`${ne($.rightNick,"ä½ ")} â™¡`:"ðŸ¥º â¤ï¸",Z=$?.leftAvatarDataUrl||$?.rightAvatarDataUrl,ee=c.useMemo(()=>we(s),[s.chatBackgroundColor,s.chatBackgroundImageUrl,s.chatBackgroundOverlay]);function ue(t){j(t),n({chatAppDefaultProfileId:t})}function Q(t,l){n({[t]:l})}function me(t,l){if(!l)return;const x=new FileReader;x.onload=()=>{const i=typeof x.result=="string"?x.result:"";i&&Q(t,i)},x.readAsDataURL(l)}function he(t){if(!t)return;const l=new FileReader;l.onload=()=>{const x=typeof l.result=="string"?l.result:"";x&&(E(x),n({chatBackgroundImageUrl:x}))},l.readAsDataURL(t)}function L(t){le(l=>l===t?null:t)}function O(t,l,x){if(!l)return;const i=new FileReader;i.onload=()=>{const C=typeof i.result=="string"?i.result:"";C&&x(fe=>({...fe,[t]:C}))},i.readAsDataURL(l)}async function pe(){!R.name.trim()||!await h({...R,id:`profile-${Date.now()}`})||(_(!1),D(G()),te({kind:"success",message:"è§’è‰²è¨­å®šå·²å„²å­˜"}))}async function be(){!T||!U||!U.name.trim()||!await h({...U,id:T})||(z(""),k(null),te({kind:"success",message:"è§’è‰²è¨­å®šå·²å„²å­˜"}))}return I?e.jsx(Ae,{log:I,chatProfiles:r,selectedProfileId:b,selectedProfile:ce,onSelectProfile:t=>{u(t),v?.(I.name,t)},backgroundStyle:ee,onBack:()=>w(""),onExit:d}):e.jsxs("div",{className:"mx-auto flex h-full w-full max-w-xl flex-col overflow-hidden",style:ee,children:[e.jsx("header",{className:"shrink-0 border-b border-stone-200/70 bg-white/95 px-4 pb-3 pt-[max(0.75rem,env(safe-area-inset-top))] backdrop-blur",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[d?e.jsx("button",{type:"button",onClick:d,className:"h-9 w-9 rounded-full border border-stone-300 bg-white text-xl leading-none text-stone-700 transition active:scale-95","aria-label":"è¿”å›ž",title:"è¿”å›ž",children:"â€¹"}):e.jsx("span",{className:"h-9 w-9"}),e.jsx("h1",{className:"font-normal tracking-wide text-stone-900",style:{fontSize:"var(--ui-header-title-size, 17px)"},children:B==="messages"?"æ¶ˆæ¯":B==="discover"?"ç™¼ç¾":"æˆ‘"}),e.jsx("button",{type:"button",onClick:X,disabled:!a.length,className:"h-9 w-9 rounded-full border border-stone-300 bg-white text-xl leading-none text-stone-700 transition active:scale-95 disabled:opacity-40","aria-label":"éš¨æ©Ÿæ‰“é–‹",title:"éš¨æ©Ÿæ‰“é–‹",children:"ï¼‹"})]})}),e.jsxs("main",{className:"min-h-0 flex-1 overflow-y-auto",children:[B==="messages"&&e.jsxs("div",{className:"space-y-3 px-3 py-3",children:[e.jsxs("button",{type:"button",onClick:X,disabled:!a.length,className:"flex w-full items-center gap-3 rounded-2xl border border-stone-200 bg-white px-3 py-3 text-left shadow-sm transition active:scale-[0.99] disabled:opacity-40",children:[Z?e.jsx("img",{src:Z,alt:"",className:"h-16 w-16 rounded-2xl border border-stone-200 object-cover"}):e.jsx("div",{className:"grid h-16 w-16 place-items-center rounded-2xl border border-stone-200 bg-stone-100 text-2xl text-stone-500",children:"ðŸ’¬"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-stone-900",style:{fontSize:"var(--chat-contact-title-size, 30px)",lineHeight:1.1},children:de}),e.jsx("p",{className:"mt-1 text-stone-500",style:{fontSize:"var(--chat-contact-subtitle-size, 18px)",lineHeight:1.2},children:xe})]}),e.jsx("span",{className:"text-2xl text-stone-400",children:"â€º"})]}),!a.length&&e.jsx("div",{className:"rounded-2xl border border-stone-200 bg-white px-4 py-8 text-center text-sm text-stone-500 shadow-sm",children:"è«‹å…ˆåˆ°ã€Œæˆ‘ã€åˆ†é åŒ¯å…¥å°è©±ç´€éŒ„"})]}),B==="discover"&&e.jsxs("div",{className:"space-y-3 px-3 py-3",children:[e.jsx("div",{className:"rounded-2xl border border-stone-200 bg-white p-3 shadow-sm",children:e.jsx("input",{type:"search",value:f,onChange:t=>F(t.target.value),placeholder:"æœå°‹æª”å",className:"w-full rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm text-stone-800 outline-none focus:border-stone-500"})}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-stone-200 bg-white shadow-sm",children:[e.jsx("ul",{className:"divide-y divide-stone-100",children:q.map(t=>e.jsx("li",{children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[e.jsxs("button",{type:"button",onClick:()=>ie(t.name),className:"flex min-w-0 flex-1 items-center justify-between gap-3 rounded-xl px-2 py-2 text-left transition active:bg-stone-100",children:[e.jsx("span",{className:"min-w-0 flex-1 truncate text-sm text-stone-800",children:W(t.name)}),e.jsx("span",{className:"text-xs text-stone-400",children:"â€º"})]}),e.jsx("button",{type:"button",onClick:()=>{window.confirm(`è¦åˆªé™¤é€™ä»½å°è©±ç´€éŒ„å—Žï¼Ÿ

${W(t.name)}`)&&y(t.name)},className:"inline-flex h-8 w-8 items-center justify-center rounded-full border border-rose-200 bg-rose-50 text-sm text-rose-600 transition active:scale-95","aria-label":`åˆªé™¤ ${W(t.name)}`,title:"åˆªé™¤",children:"âœ•"})]})},t.name))}),!q.length&&e.jsx("p",{className:"px-4 py-6 text-center text-sm text-stone-400",children:"æ²’æœ‰ç¬¦åˆçš„ç´€éŒ„"})]})]}),B==="me"&&e.jsxs("div",{className:"space-y-3 px-3 py-3",children:[e.jsxs(P,{panelKey:"nav",openPanel:M,onToggle:L,title:"åº•éƒ¨åˆ†é åœ–ç¤º",subtitle:"å¯è¼¸å…¥ç¬¦è™Ÿ / è²¼åœ–ç‰‡ç¶²å€ / ç›´æŽ¥ä¸Šå‚³åœ–ç‰‡",children:[e.jsx("div",{className:"space-y-2",children:[{label:"æ¶ˆæ¯",field:"chatAppMessagesIcon",value:s.chatAppMessagesIcon,fallback:"ðŸ’¬"},{label:"ç™¼ç¾",field:"chatAppDiscoverIcon",value:s.chatAppDiscoverIcon,fallback:"âœ¨"},{label:"æˆ‘",field:"chatAppMeIcon",value:s.chatAppMeIcon,fallback:"ðŸ‘¤"}].map(t=>e.jsxs("div",{className:"space-y-1.5 rounded-xl border border-stone-200 bg-stone-50 p-2.5",children:[e.jsx("p",{className:"text-xs text-stone-600",children:t.label}),e.jsxs("div",{className:"grid grid-cols-[2.5rem_1fr_auto_auto] items-center gap-2",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl border border-stone-300 bg-white",children:e.jsx(K,{icon:t.value,fallback:t.fallback,imageClassName:"h-6 w-6"})}),e.jsx("input",{type:"text",value:t.value,onChange:l=>Q(t.field,l.target.value),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-2 text-sm",placeholder:t.fallback}),e.jsxs("label",{className:"inline-flex h-10 w-10 cursor-pointer items-center justify-center rounded-lg border border-stone-300 bg-white text-sm text-stone-700 transition active:scale-95",children:["â¤´",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:l=>{me(t.field,l.target.files?.[0]),l.currentTarget.value=""}})]}),e.jsx("button",{type:"button",onClick:()=>Q(t.field,""),className:"inline-flex h-10 w-10 items-center justify-center rounded-lg border border-stone-300 bg-white text-sm text-stone-700 transition active:scale-95","aria-label":"é‚„åŽŸ",title:"é‚„åŽŸ",children:"â†º"})]})]},t.field))}),e.jsxs("label",{className:"mt-3 flex items-center justify-between rounded-xl border border-stone-200 bg-stone-50 px-3 py-2 text-sm text-stone-700",children:[e.jsx("span",{children:"é¡¯ç¤ºæ–‡å­—"}),e.jsx("input",{type:"checkbox",checked:s.chatAppShowLabels,onChange:t=>n({chatAppShowLabels:t.target.checked}),className:"h-4 w-4 accent-stone-900"})]})]}),e.jsxs(P,{panelKey:"data",openPanel:M,onToggle:L,title:"å°è©±è³‡æ–™",subtitle:`ç›®å‰ ${a.length} ä»½`,children:[e.jsxs("div",{className:"mb-3 flex items-end justify-between gap-3",children:[e.jsx("p",{className:"text-xs text-stone-500",children:"æ”¯æ´ txt / md / json / docx"}),e.jsx("button",{type:"button",onClick:g,disabled:!a.length,className:"rounded-lg border border-rose-200 bg-rose-50 px-2.5 py-1.5 text-xs text-rose-700 disabled:opacity-50",children:"æ¸…ç©º"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"cursor-pointer rounded-xl bg-stone-900 py-2.5 text-center text-sm text-white transition active:opacity-80",children:["åŒ¯å…¥æª”æ¡ˆ",e.jsx("input",{type:"file",multiple:!0,accept:".txt,.md,.json,.docx",className:"hidden",onChange:t=>{const l=t.target.files?Array.from(t.target.files):[];l.length&&o(l),t.currentTarget.value=""}})]}),e.jsxs("label",{className:"cursor-pointer rounded-xl bg-stone-900 py-2.5 text-center text-sm text-white transition active:opacity-80",children:["åŒ¯å…¥è³‡æ–™å¤¾",e.jsx("input",{type:"file",webkitdirectory:"",multiple:!0,accept:".txt,.md,.json,.docx",className:"hidden",onChange:t=>{const l=t.target.files?Array.from(t.target.files):[];l.length&&m(l),t.currentTarget.value=""}})]})]})]}),e.jsx(P,{panelKey:"defaultProfile",openPanel:M,onToggle:L,title:"é è¨­è§’è‰²",subtitle:"æ¶ˆæ¯é é ­åƒ / åç¨±æœƒè·Ÿéš¨é€™çµ„",children:e.jsxs("select",{value:p,onChange:t=>ue(t.target.value),className:"w-full rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm text-stone-700",children:[e.jsx("option",{value:"",children:"é è¨­ï¼ˆä½  / Mï¼‰"}),r.map(t=>e.jsxs("option",{value:t.id,children:[t.name,"ï¼ˆ",t.rightNick," / ",t.leftNick,"ï¼‰"]},t.id))]})}),e.jsx(P,{panelKey:"bubble",openPanel:M,onToggle:L,title:"æ³¡æ³¡å¤–è§€",subtitle:"æ¨£å¼ / åœ“è§’ / é¡è‰²",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n({chatBubbleStyle:"jelly"}),className:`rounded-lg border px-3 py-2 text-sm ${s.chatBubbleStyle==="jelly"?"border-stone-900 bg-stone-900 text-white":"border-stone-300 bg-white text-stone-700"}`,children:"QQ æžœå‡"}),e.jsx("button",{type:"button",onClick:()=>n({chatBubbleStyle:"imessage"}),className:`rounded-lg border px-3 py-2 text-sm ${s.chatBubbleStyle==="imessage"?"border-stone-900 bg-stone-900 text-white":"border-stone-300 bg-white text-stone-700"}`,children:"iMessage"}),e.jsx("button",{type:"button",onClick:()=>n({chatBubbleStyle:"imessageClassic"}),className:`rounded-lg border px-3 py-2 text-sm ${s.chatBubbleStyle==="imessageClassic"?"border-stone-900 bg-stone-900 text-white":"border-stone-300 bg-white text-stone-700"}`,children:"iMessage+"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsxs("span",{className:"flex items-center justify-between text-xs text-stone-600",children:[e.jsx("span",{children:"æ³¡æ³¡åœ“è§’"}),e.jsxs("span",{children:[s.chatBubbleRadius,"px"]})]}),e.jsx("input",{type:"range",min:10,max:36,step:1,value:s.chatBubbleRadius,onChange:t=>n({chatBubbleRadius:Number(t.target.value)}),className:"w-full accent-stone-800"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"æˆ‘æ–¹åº•è‰²"}),e.jsx("input",{type:"color",value:s.chatUserBubbleColor,onChange:t=>n({chatUserBubbleColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"å°æ–¹åº•è‰²"}),e.jsx("input",{type:"color",value:s.chatAiBubbleColor,onChange:t=>n({chatAiBubbleColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"æˆ‘æ–¹é‚Šæ¡†"}),e.jsx("input",{type:"color",value:s.chatUserBubbleBorderColor,onChange:t=>n({chatUserBubbleBorderColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"å°æ–¹é‚Šæ¡†"}),e.jsx("input",{type:"color",value:s.chatAiBubbleBorderColor,onChange:t=>n({chatAiBubbleBorderColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"æˆ‘æ–¹æ–‡å­—"}),e.jsx("input",{type:"color",value:s.chatUserBubbleTextColor,onChange:t=>n({chatUserBubbleTextColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"å°æ–¹æ–‡å­—"}),e.jsx("input",{type:"color",value:s.chatAiBubbleTextColor,onChange:t=>n({chatAiBubbleTextColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]})]})]})}),e.jsx(P,{panelKey:"background",openPanel:M,onToggle:L,title:"é–±è®€èƒŒæ™¯",subtitle:"è‰²ç¥¨ã€åœ–ç‰‡ã€é€æ˜Žåº¦",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:ve.map(t=>{const l=s.chatBackgroundColor.toLowerCase()===t.toLowerCase();return e.jsx("button",{type:"button",onClick:()=>n({chatBackgroundColor:t}),className:`h-7 w-7 rounded-full border transition active:scale-95 ${l?"border-stone-900 ring-2 ring-stone-300":"border-stone-300"}`,style:{background:t},"aria-label":`èƒŒæ™¯è‰² ${t}`,title:t},t)})}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"è‡ªè¨‚åº•è‰²"}),e.jsx("input",{type:"color",value:s.chatBackgroundColor,onChange:t=>n({chatBackgroundColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"èƒŒæ™¯åœ–ç‰‡ URL"}),e.jsx("input",{type:"url",value:Y,onChange:t=>E(t.target.value),placeholder:"https://.../chat-bg.jpg",className:"w-full rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm text-stone-700"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n({chatBackgroundImageUrl:Y.trim()}),className:"rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-700 transition active:scale-[0.99]",children:"å¥—ç”¨åœ–ç‰‡ URL"}),e.jsxs("label",{className:"cursor-pointer rounded-xl border border-stone-300 bg-white py-2 text-center text-sm text-stone-700 transition active:opacity-80",children:["ä¸Šå‚³åœ–ç‰‡",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{he(t.target.files?.[0]),t.currentTarget.value=""}})]})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsxs("span",{className:"flex items-center justify-between text-xs text-stone-600",children:[e.jsx("span",{children:"åœ–ç‰‡é®ç½©"}),e.jsxs("span",{children:[s.chatBackgroundOverlay,"%"]})]}),e.jsx("input",{type:"range",min:0,max:90,step:1,value:s.chatBackgroundOverlay,onChange:t=>n({chatBackgroundOverlay:Number(t.target.value)}),className:"w-full accent-stone-800"})]}),e.jsx("button",{type:"button",onClick:()=>{E(""),n({chatBackgroundImageUrl:"",chatBackgroundOverlay:0})},className:"w-full rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-700 transition active:scale-[0.99]",children:"ç§»é™¤èƒŒæ™¯åœ–ç‰‡"})]})}),e.jsx(P,{panelKey:"profiles",openPanel:M,onToggle:L,title:"èŠå¤©è§’è‰²è¨­å®šï¼ˆæ´—è§’è‰²åç¨±ï¼‰",subtitle:`å…± ${r.length} çµ„`,children:e.jsxs("div",{className:"space-y-3",children:[r.length===0&&e.jsx("p",{className:"text-xs text-stone-400",children:"å°šæœªå»ºç«‹è§’è‰²è¨­å®šï¼Œé è¨­ç‚ºã€Œä½ ã€/ã€ŒMã€ã€‚"}),e.jsx("div",{className:"space-y-2",children:r.map(t=>{const l=T===t.id&&!!U;return e.jsx("div",{className:"rounded-lg border border-stone-200 bg-stone-50 p-3",children:l?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:U.name,onChange:x=>k(i=>i&&{...i,name:x.target.value}),placeholder:"è¨­å®šåç¨±",className:"w-full rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{type:"text",value:U.rightNick,onChange:x=>k(i=>i&&{...i,rightNick:x.target.value}),placeholder:"å³å´æš±ç¨±ï¼ˆå¯ / åˆ†éš”ï¼‰",className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"}),e.jsx("input",{type:"text",value:U.leftNick,onChange:x=>k(i=>i&&{...i,leftNick:x.target.value}),placeholder:"å·¦å´æš±ç¨±ï¼ˆå¯ / åˆ†éš”ï¼‰",className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"å³å´é ­åƒ"}),e.jsx("input",{type:"file",accept:"image/*",onChange:x=>O("rightAvatarDataUrl",x.target.files?.[0],i=>k(C=>C&&i(C))),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs"})]}),e.jsxs("label",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"å·¦å´é ­åƒ"}),e.jsx("input",{type:"file",accept:"image/*",onChange:x=>O("leftAvatarDataUrl",x.target.files?.[0],i=>k(C=>C&&i(C))),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{be()},className:"flex-1 rounded-xl bg-stone-900 py-2 text-sm text-white",children:"å„²å­˜"}),e.jsx("button",{type:"button",onClick:()=>{z(""),k(null)},className:"flex-1 rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-600",children:"å–æ¶ˆ"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm text-stone-800",children:t.name}),e.jsxs("p",{className:"text-xs text-stone-400",children:["å³ï¼š",t.rightNick," ï¼ å·¦ï¼š",t.leftNick]})]}),e.jsx("button",{type:"button",onClick:()=>{z(t.id),k({name:t.name,leftNick:t.leftNick,rightNick:t.rightNick,leftAvatarDataUrl:t.leftAvatarDataUrl,rightAvatarDataUrl:t.rightAvatarDataUrl})},className:"rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs text-stone-700",children:"ç·¨è¼¯"}),e.jsx("button",{type:"button",onClick:()=>A(t.id),className:"rounded-lg border border-rose-200 bg-rose-50 px-2 py-1 text-xs text-rose-600",children:"åˆªé™¤"})]})},t.id)})}),oe?e.jsxs("div",{className:"space-y-2 rounded-lg border border-violet-200 bg-violet-50 p-3",children:[e.jsx("input",{type:"text",placeholder:"è¨­å®šåç¨±ï¼Œä¾‹ï¼šå’Œ4oçš„å°è©±",value:R.name,onChange:t=>D(l=>({...l,name:t.target.value})),className:"w-full rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{type:"text",placeholder:"å³å´æš±ç¨±ï¼ˆå¯ / åˆ†éš”ï¼‰",value:R.rightNick,onChange:t=>D(l=>({...l,rightNick:t.target.value})),className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"}),e.jsx("input",{type:"text",placeholder:"å·¦å´æš±ç¨±ï¼ˆå¯ / åˆ†éš”ï¼‰",value:R.leftNick,onChange:t=>D(l=>({...l,leftNick:t.target.value})),className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"å³å´é ­åƒ"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>O("rightAvatarDataUrl",t.target.files?.[0],D),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs"})]}),e.jsxs("label",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"å·¦å´é ­åƒ"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>O("leftAvatarDataUrl",t.target.files?.[0],D),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{pe()},className:"flex-1 rounded-xl bg-stone-900 py-2 text-sm text-white",children:"å„²å­˜"}),e.jsx("button",{type:"button",onClick:()=>{_(!1),D(G())},className:"flex-1 rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-600",children:"å–æ¶ˆ"})]})]}):e.jsx("button",{type:"button",onClick:()=>_(!0),className:"w-full rounded-xl border border-violet-200 bg-violet-50 py-2 text-sm text-violet-700",children:"ï¼‹ æ–°å¢žè§’è‰²è¨­å®š"})]})})]})]}),e.jsx("nav",{className:"shrink-0 border-t border-stone-200 bg-white px-2 pb-[max(0.5rem,env(safe-area-inset-bottom))] pt-2",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>H("messages"),className:`flex flex-col items-center rounded-xl px-2 py-1.5 transition ${B==="messages"?"text-black":"text-stone-400"} ${S?"gap-1 text-xs":"gap-0 text-base"}`,"aria-label":"æ¶ˆæ¯",children:[e.jsx(K,{icon:s.chatAppMessagesIcon,fallback:"ðŸ’¬",imageClassName:"h-6 w-6",textClassName:"text-2xl leading-none"}),S&&e.jsx("span",{children:"æ¶ˆæ¯"})]}),e.jsxs("button",{type:"button",onClick:()=>H("discover"),className:`flex flex-col items-center rounded-xl px-2 py-1.5 transition ${B==="discover"?"text-black":"text-stone-400"} ${S?"gap-1 text-xs":"gap-0 text-base"}`,"aria-label":"ç™¼ç¾",children:[e.jsx(K,{icon:s.chatAppDiscoverIcon,fallback:"âœ¨",imageClassName:"h-6 w-6",textClassName:"text-2xl leading-none"}),S&&e.jsx("span",{children:"ç™¼ç¾"})]}),e.jsxs("button",{type:"button",onClick:()=>H("me"),className:`flex flex-col items-center rounded-xl px-2 py-1.5 transition ${B==="me"?"text-black":"text-stone-400"} ${S?"gap-1 text-xs":"gap-0 text-base"}`,"aria-label":"æˆ‘",children:[e.jsx(K,{icon:s.chatAppMeIcon,fallback:"ðŸ‘¤",imageClassName:"h-6 w-6",textClassName:"text-2xl leading-none"}),S&&e.jsx("span",{children:"æˆ‘"})]})]})})]})}function Ae({log:a,chatProfiles:r,selectedProfileId:s,selectedProfile:n,onSelectProfile:o,backgroundStyle:m,onBack:g,onExit:y}){const h=c.useRef(null),A=W(a.name),v=c.useMemo(()=>ye(a.content,n),[a.content,n]);return c.useEffect(()=>{const d=h.current;d&&d.scrollTo({top:d.scrollHeight})},[a.name,s]),e.jsxs("div",{className:"mx-auto flex h-full w-full max-w-xl flex-col overflow-hidden",style:m,children:[e.jsx("div",{className:"shrink-0 border-b border-stone-200 bg-white px-3 pb-2 pt-[max(0.75rem,env(safe-area-inset-top))]",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("button",{type:"button",onClick:g,className:"h-9 w-9 rounded-full border border-stone-300 bg-white text-xl leading-none text-stone-700 transition active:scale-95","aria-label":"è¿”å›ž",title:"è¿”å›ž",children:"â€¹"}),e.jsx("p",{className:"min-w-0 flex-1 truncate text-center text-sm text-stone-700",children:A}),y?e.jsx("button",{type:"button",onClick:y,className:"h-9 w-9 rounded-full border border-stone-300 bg-white text-xl leading-none text-stone-700 transition active:scale-95","aria-label":"é›¢é–‹",title:"é›¢é–‹",children:"Ã—"}):e.jsx("span",{className:"h-9 w-9"})]})}),e.jsx("div",{ref:h,id:"chat-messages",className:"min-h-0 flex-1 overflow-y-auto px-3 py-3",children:v.length>0?e.jsx(Be,{messages:v,profile:n}):e.jsxs("p",{className:"rounded-2xl border border-stone-200 bg-white px-3 py-4 text-sm text-stone-500",children:["ç„¡æ³•è§£æžç‚ºèŠå¤©æ ¼å¼ï¼Œä»¥ä¸‹æ˜¯åŽŸæ–‡ï¼š",e.jsx("span",{className:"mt-2 block whitespace-pre-wrap rounded-xl border border-stone-200 bg-white p-3 text-left text-xs text-stone-700",children:a.content})]})}),e.jsx("div",{className:"shrink-0 border-t border-stone-200 bg-white px-2.5 pb-[max(0.5rem,env(safe-area-inset-bottom))] pt-2.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex h-9 w-9 items-center justify-center text-[1.55rem] text-stone-700","aria-hidden":"true",children:"âœ‰"}),e.jsx("div",{className:"relative min-w-0 flex-1",children:r.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:s,onChange:d=>o(d.target.value),className:"h-11 w-full appearance-none rounded-full border border-stone-300 bg-stone-50 pl-4 pr-8 text-base text-stone-700",children:[e.jsx("option",{value:"",children:"è§’è‰²é è¨­ï¼ˆé»žæˆ‘åˆ‡æ›ï¼‰"}),r.map(d=>e.jsxs("option",{value:d.id,children:[d.name,"ï¼ˆ",d.rightNick," / ",d.leftNick,"ï¼‰"]},d.id))]}),e.jsx("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-xs text-stone-500",children:"â–¾"})]}):e.jsx("div",{className:"h-11 rounded-full border border-stone-300 bg-stone-50 px-4 text-base leading-[2.75rem] text-stone-400",children:"å°šæœªå»ºç«‹è§’è‰²è¨­å®š"})}),e.jsx("span",{className:"inline-flex h-9 w-9 items-center justify-center text-[1.8rem] leading-none text-stone-700","aria-hidden":"true",children:"+"})]})})]})}function Be({messages:a,profile:r}){return e.jsx("div",{className:"flex flex-col gap-1.5",children:a.map((s,n)=>{const o=s.role==="user",m=o?r?.rightAvatarDataUrl:r?.leftAvatarDataUrl,g=s.time&&(n===0||a[n-1]?.time?.slice(0,10)!==s.time.slice(0,10))?s.time.slice(0,10):null;return e.jsxs("div",{children:[g&&e.jsx("div",{className:"my-3 text-center text-[11px] text-stone-400",children:g}),e.jsxs("div",{className:`flex items-end gap-2 ${o?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:"mb-4 shrink-0",children:m?e.jsx("img",{src:m,alt:"",className:"h-8 w-8 rounded-full object-cover"}):e.jsx("div",{className:`grid h-8 w-8 place-items-center rounded-full text-xs font-medium text-white ${o?"bg-emerald-400":"bg-sky-300"}`,children:o?r?.rightNick?.[0]??"ä½ ":r?.leftNick?.[0]??"M"})}),e.jsxs("div",{className:`flex max-w-[75%] flex-col gap-0.5 ${o?"items-end":"items-start"}`,children:[e.jsx("div",{className:`message-bubble ${o?"user":"ai"}`,children:e.jsx("div",{className:"content",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:s.content})}),s.time&&e.jsx("p",{className:"px-1 text-[10px] text-stone-400",children:s.time.slice(11,16)})]})]})]},`${n}-${s.time??""}`)})})}export{Ue as ChatLogPage};
