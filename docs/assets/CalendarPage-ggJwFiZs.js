import{r as l,g as ka,C as aa,t as Sa,a as Ca,j as _,m as _a,s as La,_ as Aa,b as Ta,c as Fa,d as Ha,e as Wa,f as Ua,h as Ia,i as Xa,k as $a,l as Ra,n as za,o as Oa,p as Va,q as Ya,u as Ba,v as Ka,w as Ga,x as qa,y as Qa,z as Ja,A as Za,B as a_,D as __,E as e_,F as t_,G as n_,H as s_,I as l_,J as o_,K as r_,L as d_,M as c_,N as i_,O as b_,P as g_,Q as v_,R as u_,S as j_,T as h_,U as m_,V as p_,W as x_,X as f_,Y as y_,Z as M_,$ as N_,a0 as E_,a1 as w_,a2 as P_,a3 as D_,a4 as k_,a5 as S_,a6 as C_,a7 as L_,a8 as A_,a9 as T_,aa as F_,ab as H_,ac as W_,ad as U_,ae as I_,af as X_,ag as $_,ah as R_,ai as z_,aj as O_,ak as V_,al as Y_,am as B_,an as K_,ao as G_,ap as q_,aq as Q_,ar as J_,as as Z_,at as ae,au as _e,av as ee,aw as te,ax as ne,ay as se,az as le,aA as oe,aB as re,aC as de,aD as ce,aE as ie,aF as be,aG as ge,aH as ve,aI as ue,aJ as je,aK as he,aL as me,aM as pe,aN as xe,aO as fe,aP as ye,aQ as Me,aR as Ne,aS as Ee,aT as we,aU as Pe,aV as De,aW as ke,aX as Se,aY as Ce,aZ as Le,a_ as Ae,a$ as Te,b0 as Fe,b1 as He,b2 as We,b3 as Ue,b4 as Ie,b5 as Xe,b6 as $e,b7 as Re,b8 as ze,b9 as Oe,ba as Ve,bb as Ye,bc as Be,bd as Ke,be as Ge,bf as qe,bg as Qe,bh as Je,bi as Ze,bj as at,bk as _t,bl as et,bm as tt,bn as nt,bo as st,bp as lt,bq as ot,br as rt,bs as dt,bt as ct,bu as it,bv as bt,bw as gt,bx as vt,by as ut,bz as jt,bA as ht,bB as mt,bC as pt,bD as xt,bE as ft,bF as yt,bG as Mt,bH as Nt,bI as Et,bJ as wt,bK as Pt,bL as Dt,bM as kt,bN as St,bO as Ct,bP as Lt,bQ as At,bR as Tt,bS as Ft,bT as Ht,bU as Wt,bV as Ut,bW as It,bX as Xt,bY as $t,bZ as Rt,b_ as zt,b$ as Ot,c0 as Vt,c1 as Yt,c2 as Bt,c3 as Kt,c4 as Gt,c5 as qt,c6 as Qt,c7 as Jt,c8 as Zt,c9 as an,ca as _n,cb as en,cc as tn,cd as nn,ce as sn,cf as ln,cg as on,ch as rn,ci as dn,cj as cn,ck as bn,cl as gn,cm as vn,cn as un,co as jn,cp as hn,cq as mn,cr as pn,cs as xn,ct as fn,cu as yn,cv as Mn,cw as Nn}from"./index-Gl0K_ej6.js";import{g as En,p as wn}from"./hoverPool-wISNDxsK.js";const ea=["來，我在","今天也選妳","等妳","想妳了","抱緊一下","妳回頭就有我"],Pn=Object.assign({"../../data/calendar/2026/Michael_2026_02_calendar_messages.json":Nn,"../../data/calendar/2026/Michael_2026_02_calendar_messages_REVISED_EXPANDED_FULL.json":Mn,"../../data/calendar/2026/Michael_2026_03_calendar_messages.json":yn,"../../data/calendar/2026/Michael_2026_04_calendar_messages.json":fn,"../../data/calendar/2026/Michael_2026_05_calendar_messages.json":xn,"../../data/calendar/2026/Michael_2026_06_calendar_messages.json":pn,"../../data/calendar/2026/Michael_2026_07_calendar_messages.json":mn,"../../data/calendar/2026/Michael_2026_08_calendar_messages.json":hn,"../../data/calendar/2026/Michael_2026_08_calendar_messages_REVISED_EXPANDED.json":jn,"../../data/calendar/2026/Michael_2026_08_calendar_messages_REVISED_EXPANDED_FULL.json":un,"../../data/calendar/2026/Michael_2026_08_calendar_messages_REVISED_EXPANDED_full_1_8.json":vn,"../../data/calendar/2026/Michael_2026_08_calendar_messages_REVISED_EXPANDED_full_9_31.json":gn,"../../data/calendar/2026/Michael_2026_09_calendar_messages_EXPANDED_16_30.json":bn,"../../data/calendar/2026/Michael_2026_09_calendar_messages_EXPANDED_1_15.json":cn,"../../data/calendar/2026/Michael_2026_09_calendar_messages_EXPANDED_FULL.json":dn,"../../data/calendar/2026/Michael_2026_09_calendar_messages_EXPANDED_FULL_with_birthday.json":rn,"../../data/calendar/2026/Michael_2026_10_calendar_messages_EXPANDED_FULL.json":on,"../../data/calendar/2026/Michael_2026_11_calendar_messages_EXPANDED_FULL.json":ln,"../../data/calendar/2026/Michael_2026_12_calendar_messages_EXPANDED_FULL.json":sn,"../../data/calendar/2027/2027-10_每日日記內容_Missing_1007_1008_1009.json":nn,"../../data/calendar/2027/2027-10_每日日記內容_Week1.json":tn,"../../data/calendar/2027/2027-10_每日日記內容_Week2.json":en,"../../data/calendar/2027/2027-10_每日日記內容_Week2_Part2.json":_n,"../../data/calendar/2027/2027-10_每日日記內容_Week3_Part1.json":an,"../../data/calendar/2027/2027-10_每日日記內容_Week3_Part2.json":Zt,"../../data/calendar/2027/2027-10_每日日記內容_Week4_Part1.json":Jt,"../../data/calendar/2027/2027-10_每日日記內容_Week4_Part2.json":Qt,"../../data/calendar/2027/2027-10_每日日記內容_Week5.json":qt,"../../data/calendar/2027/2027-10_每日日記內容_Week6.json":Gt,"../../data/calendar/2027/2027-11_每日日記內容_Week1.json":Kt,"../../data/calendar/2027/2027-11_每日日記內容_Week2.json":Bt,"../../data/calendar/2027/2027-11_每日日記內容_Week3.json":Yt,"../../data/calendar/2027/2027-11_每日日記內容_Week4_Part1.json":Vt,"../../data/calendar/2027/2027-11_每日日記內容_Week4_Part2.json":Ot,"../../data/calendar/2027/2027-11_每日日記內容_Week5_Part2.json":zt,"../../data/calendar/2027/2027_Feb_MichaelNotes.json":Rt,"../../data/calendar/2027/M-2027-3月-日記-需轉格式為json.json":$t,"../../data/calendar/2027/M-2027-4月-日記-需轉格式為json.json":Xt,"../../data/calendar/2027/M-2027-5月-日記-需轉格式為json.json":It,"../../data/calendar/2027/M-2027-6月-日記-需轉格式為json.json":Ut,"../../data/calendar/2027/M-2027-7月-日記-需轉格式為json.json":Wt,"../../data/calendar/2027/M-2027-8月-日記-需轉格式為json.json":Ht,"../../data/calendar/2027/M-2027-9月-日記-需轉格式為json.json":Ft,"../../data/calendar/2027/Michael_2027_01_calendar_messages_EXPANDED_FULL.json":Tt,"../../data/calendar/2027/Michael_2027_02_calendar_messages_EXPANDED_FULL.json":At,"../../data/calendar/2027/我們的日曆_2027-12_前12天.json":Lt,"../../data/calendar/2027/我們的日曆_2027-12_前15天.json":Ct,"../../data/calendar/2027/我們的日曆_2027-12_前18天.json":St,"../../data/calendar/2027/我們的日曆_2027-12_前21天.json":kt,"../../data/calendar/2027/我們的日曆_2027-12_前24天.json":Dt,"../../data/calendar/2027/我們的日曆_2027-12_前3天.json":Pt,"../../data/calendar/2027/我們的日曆_2027-12_前6天.json":wt,"../../data/calendar/2027/我們的日曆_2027-12_前9天.json":Et,"../../data/calendar/2027/我們的日曆_2027-12_完整版.json":Nt,"../../data/calendar/2028/我們的日曆_2028-01_前7天.json":Mt,"../../data/calendar/2028/我們的日曆_2028-01_完整結尾.json":yt,"../../data/calendar/2028/我們的日曆_2028-01_第三週.json":ft,"../../data/calendar/2028/我們的日曆_2028-01_第二週.json":xt,"../../data/calendar/2028/我們的日曆_2028-01_第四週.json":pt,"../../data/calendar/2028/我們的日曆_2028-02_前奏_2-1.json":mt,"../../data/calendar/2028/我們的日曆_2028-02_幸福週_前段.json":ht,"../../data/calendar/2028/我們的日曆_2028-02_幸福週_後段_元宵_婚禮紀念_情人節.json":jt,"../../data/calendar/2028/我們的日曆_2028-02_幸福週延伸_後續陪伴.json":ut,"../../data/calendar/2028/我們的日曆_2028-02_最終週.json":vt,"../../data/calendar/2028/我們的日曆_2028-03_第1週.json":gt,"../../data/calendar/2028/我們的日曆_2028-03_第2週.json":bt,"../../data/calendar/2028/我們的日曆_2028-03_第3週.json":it,"../../data/calendar/2028/我們的日曆_2028-03_第4週.json":ct,"../../data/calendar/2028/我們的日曆_2028-03_第5週.json":dt,"../../data/calendar/2028/我們的日曆_2028-03_第6週.json":rt,"../../data/calendar/2028/我們的日曆_2028-04_第1週.json":ot,"../../data/calendar/2028/我們的日曆_2028-04_第2週.json":lt,"../../data/calendar/2028/我們的日曆_2028-04_第3週.json":st,"../../data/calendar/2028/我們的日曆_2028-04_第4週.json":nt,"../../data/calendar/2028/我們的日曆_2028-04_第5週.json":tt,"../../data/calendar/2028/我們的日曆_2028-04_第6週.json":et,"../../data/calendar/2028/我們的日曆_2028-05_第1週.json":_t,"../../data/calendar/2028/我們的日曆_2028-05_第2週.json":at,"../../data/calendar/2028/我們的日曆_2028-05_第3週.json":Ze,"../../data/calendar/2028/我們的日曆_2028-05_第4週.json":Je,"../../data/calendar/2028/我們的日曆_2028-05_第5週.json":Qe,"../../data/calendar/2028/我們的日曆_2028-05_第6週.json":qe,"../../data/calendar/2028/我們的日曆_2028-06_第1週.json":Ge,"../../data/calendar/2028/我們的日曆_2028-06_第2週.json":Ke,"../../data/calendar/2028/我們的日曆_2028-06_第3週.json":Be,"../../data/calendar/2028/我們的日曆_2028-06_第4週.json":Ye,"../../data/calendar/2028/我們的日曆_2028-06_第5週.json":Ve,"../../data/calendar/2028/我們的日曆_2028-06_第6週.json":Oe,"../../data/calendar/2028/我們的日曆_2028-07_第1週.json":ze,"../../data/calendar/2028/我們的日曆_2028-07_第2週.json":Re,"../../data/calendar/2028/我們的日曆_2028-07_第3週.json":$e,"../../data/calendar/2028/我們的日曆_2028-07_第4週.json":Xe,"../../data/calendar/2028/我們的日曆_2028-07_第5週.json":Ie,"../../data/calendar/2028/我們的日曆_2028-07_第6週.json":Ue,"../../data/calendar/2028/我們的日曆_2028-08_第1週.json":We,"../../data/calendar/2028/我們的日曆_2028-08_第2週.json":He,"../../data/calendar/2028/我們的日曆_2028-08_第3週.json":Fe,"../../data/calendar/2028/我們的日曆_2028-08_第4週.json":Te,"../../data/calendar/2028/我們的日曆_2028-08_第5週.json":Ae,"../../data/calendar/2028/我們的日曆_2028-08_第6週.json":Le,"../../data/calendar/2028/我們的日曆_2028-09_第1週.json":Ce,"../../data/calendar/2028/我們的日曆_2028-09_第2週.json":Se,"../../data/calendar/2028/我們的日曆_2028-09_第3週.json":ke,"../../data/calendar/2028/我們的日曆_2028-09_第4週.json":De,"../../data/calendar/2028/我們的日曆_2028-09_第5週.json":Pe,"../../data/calendar/2028/我們的日曆_2028-09_第6週.json":we,"../../data/calendar/2028/我們的日曆_2028-10_第1週.json":Ee,"../../data/calendar/2028/我們的日曆_2028-10_第2週.json":Ne,"../../data/calendar/2028/我們的日曆_2028-10_第3週.json":Me,"../../data/calendar/2028/我們的日曆_2028-10_第4週.json":ye,"../../data/calendar/2028/我們的日曆_2028-10_第5週.json":fe,"../../data/calendar/2028/我們的日曆_2028-10_第6週.json":xe,"../../data/calendar/2028/我們的日曆_2028-11_第1週.json":pe,"../../data/calendar/2028/我們的日曆_2028-11_第2週.json":me,"../../data/calendar/2028/我們的日曆_2028-11_第3週.json":he,"../../data/calendar/2028/我們的日曆_2028-11_第4週.json":je,"../../data/calendar/2028/我們的日曆_2028-11_第5週.json":ue,"../../data/calendar/2028/我們的日曆_2028-11_第6週.json":ve,"../../data/calendar/2028/我們的日曆_2028-12_第1週.json":ge,"../../data/calendar/2028/我們的日曆_2028-12_第2週.json":be,"../../data/calendar/2028/我們的日曆_2028-12_第3週.json":ie,"../../data/calendar/2028/我們的日曆_2028-12_第4週.json":ce,"../../data/calendar/2028/我們的日曆_2028-12_第5週.json":de,"../../data/calendar/2028/我們的日曆_2028-12_第6週.json":re,"../../data/calendar/2028/我們的日曆_春節特別版_除夕至初八.json":oe,"../../data/calendar/2029/我們的日曆_2029-01_第1週.json":le,"../../data/calendar/2029/我們的日曆_2029-01_第2週.json":se,"../../data/calendar/2029/我們的日曆_2029-01_第3週.json":ne,"../../data/calendar/2029/我們的日曆_2029-01_第4週.json":te,"../../data/calendar/2029/我們的日曆_2029-01_第5週.json":ee,"../../data/calendar/2029/我們的日曆_2029-01_第6週.json":_e,"../../data/calendar/2029/我們的日曆_2029-02_春節週特別篇.json":ae,"../../data/calendar/2029/我們的日曆_2029-02_第1週.json":Z_,"../../data/calendar/2029/我們的日曆_2029-02_第2週.json":J_,"../../data/calendar/2029/我們的日曆_2029-02_第3週.json":Q_,"../../data/calendar/2029/我們的日曆_2029-02_第4週.json":q_,"../../data/calendar/2029/我們的日曆_2029-02_第5週.json":G_,"../../data/calendar/2029/我們的日曆_2029-02_除夕特別篇.json":K_,"../../data/calendar/2029/我們的日曆_2029-03_第1週.json":B_,"../../data/calendar/2029/我們的日曆_2029-03_第2週.json":Y_,"../../data/calendar/2029/我們的日曆_2029-03_第3週.json":V_,"../../data/calendar/2029/我們的日曆_2029-03_第4週.json":O_,"../../data/calendar/2029/我們的日曆_2029-03_第5週.json":z_,"../../data/calendar/2029/我們的日曆_2029-03_第6週.json":R_,"../../data/calendar/2029/我們的日曆_2029-04_第1週.json":$_,"../../data/calendar/2029/我們的日曆_2029-04_第2週.json":X_,"../../data/calendar/2029/我們的日曆_2029-04_第3週.json":I_,"../../data/calendar/2029/我們的日曆_2029-04_第4週.json":U_,"../../data/calendar/2029/我們的日曆_2029-04_第5週.json":W_,"../../data/calendar/2029/我們的日曆_2029-05_第1週.json":H_,"../../data/calendar/2029/我們的日曆_2029-05_第2週.json":F_,"../../data/calendar/2029/我們的日曆_2029-05_第3週.json":T_,"../../data/calendar/2029/我們的日曆_2029-05_第4週.json":A_,"../../data/calendar/2029/我們的日曆_2029-05_第5週.json":L_,"../../data/calendar/2029/我們的日曆_2029-05_第6週.json":C_,"../../data/calendar/2029/我們的日曆_2029-07_Anchor週.json":S_,"../../data/calendar/2029/我們的日曆_2029-08_第1週.json":k_,"../../data/calendar/2029/我們的日曆_2029-08_第5週.json":D_,"../../data/calendar/2029/我們的日曆_2029-09_第1週.json":P_,"../../data/calendar/2029/我們的日曆_2029-09_第5週.json":w_,"../../data/calendar/2029/我們的日曆_2029-10_第1週.json":E_,"../../data/calendar/2029/我們的日曆_2029-10_第5週.json":N_,"../../data/calendar/2029/我們的日曆_2029-11_第1週.json":M_,"../../data/calendar/2029/我們的日曆_2029-11_第5週.json":y_,"../../data/calendar/2029/我們的日曆_2029-12_第1週.json":f_,"../../data/calendar/2029/我們的日曆_2029-12_第3週_1212偷偷擁抱日.json":x_,"../../data/calendar/2029/我們的日曆_2029_大日子篇.json":p_,"../../data/calendar/2029/我們的日曆_2029_大日子篇_加長版.json":m_,"../../data/calendar/2029/我們的日曆_信件篇_0706_Michael生日_完整版.json":h_,"../../data/calendar/2029/我們的日曆_信件篇_0826_七夕.json":j_,"../../data/calendar/2029/我們的日曆_信件篇_0929_生日.json":u_,"../../data/calendar/2029/我們的日曆_信件篇_0929_生日_完整版.json":v_,"../../data/calendar/2029/我們的日曆_信件篇_1115_結婚紀念日.json":g_,"../../data/calendar/2029/我們的日曆_信件篇_1115_結婚紀念日_完整版.json":b_,"../../data/calendar/2029/我們的日曆_信件篇_1225_聖誕節_完整版.json":i_,"../../data/calendar/2029/我們的日曆_信件篇_1231_跨年_完整版.json":c_,"../../data/calendar/2029/我們的日曆_信件篇_2029_0826_七夕_完整版.json":d_,"../../data/calendar/2029/我們的日曆_信件篇_Undated_相遇.json":r_,"../../data/calendar/2029/最後收尾-我們的日曆_2029-02_第6週.json":o_,"../../data/calendar/2030/我們的日曆_2030_0101_新年信.json":l_,"../../data/calendar/2030/我們的日曆_2030_0128_除夕信.json":s_,"../../data/calendar/2030/我們的日曆_2030_0129_初一信.json":n_,"../../data/calendar/2030/我們的日曆_2030_01_心情日記篇.json":t_,"../../data/calendar/2030/我們的日曆_2030_0210_拜堂信.json":e_,"../../data/calendar/2030/我們的日曆_2030_0214_情人節信.json":__,"../../data/calendar/2030/我們的日曆_2030_02_心情日記篇.json":a_,"../../data/calendar/2030/我們的日曆_2030_0320_交往紀念日信.json":Za,"../../data/calendar/2030/我們的日曆_2030_03_心情日記篇.json":Ja,"../../data/calendar/2030/我們的日曆_2030_04_心情日記篇.json":Qa,"../../data/calendar/2030/我們的日曆_2030_0520_我愛你日信.json":qa,"../../data/calendar/2030/我們的日曆_2030_05_心情日記篇.json":Ga,"../../data/calendar/2030/我們的日曆_2030_06_心情日記篇.json":Ka,"../../data/calendar/2030/我們的日曆_2030_0706_Michael生日信.json":Ba,"../../data/calendar/2030/我們的日曆_2030_07_心情日記篇.json":Ya,"../../data/calendar/2030/我們的日曆_2030_0813_七夕信.json":Va,"../../data/calendar/2030/我們的日曆_2030_08_心情日記篇_Part1.json":Oa,"../../data/calendar/2030/我們的日曆_2030_0929_Anni生日信.json":za,"../../data/calendar/2030/我們的日曆_2030_09_心情日記篇_Part1.json":Ra,"../../data/calendar/2030/我們的日曆_2030_09_心情日記篇_Part2.json":$a,"../../data/calendar/2030/我們的日曆_2030_09_心情日記篇_特別陪伴日.json":Xa,"../../data/calendar/2030/我們的日曆_2030_10_心情日記篇_Part1.json":Ia,"../../data/calendar/2030/我們的日曆_2030_10_心情日記篇_Part2.json":Ua,"../../data/calendar/2030/我們的日曆_2030_1115_結婚紀念日信.json":Wa,"../../data/calendar/2030/我們的日曆_2030_11_心情日記篇.json":Ha,"../../data/calendar/2030/我們的日曆_2030_11_心情日記篇_加碼封.json":Fa,"../../data/calendar/2030/我們的日曆_2030_1231_跨年信.json":Ta,"../../data/calendar/2030/我們的日曆_2030_12_心情日記篇.json":Aa}),Dn=6,kn=/^\d{4}-\d{2}-\d{2}$/,z=/^\d{4}-\d{2}$/,Sn=54;function Cn(t){if(!t||typeof t!="object")return null;const o=t,s=o.date??o.dateKey;if(typeof s=="string"&&kn.test(s))return null;const r=o.content??o.text??o.message??o.body??o.entry??o.note;if(typeof r!="string")return null;const c=r.trim();return c||null}const ta=(()=>{const t=Object.entries(Pn).sort(([s],[r])=>s.localeCompare(r)),o=t.filter(([s])=>s.toLowerCase().includes("undated")).concat(t.filter(([s])=>!s.toLowerCase().includes("undated")));for(const[,s]of o){const r=Cn(s);if(r)return r}return null})();function Ln(t){const[o,s]=t.split("-").map(Number),r=Number.isFinite(o)?o:new Date().getFullYear(),c=Number.isFinite(s)?s:1,p=new Date(r,c-1,1).getDay(),x=new Date(r,c,0).getDate();return{year:r,month:c,firstWeekday:p,daysInMonth:x}}function An(t,o){const[s,r]=t.split("-").map(Number),c=Number.isFinite(s)?s:new Date().getFullYear(),p=Number.isFinite(r)&&r>=1&&r<=12?r:1,x=new Date(c,p-1+o,1);return`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}`}function Tn(t){return t?t.messages?.length?t.messages:t.text?[t.text]:[]:[]}function Fn(t,o=Dn){const s=t.replace(/\s+/g," ").trim();return s?s.length>o?`${s.slice(0,o)}...`:s:"（空白內容）"}function In({monthKey:t,monthKeys:o,data:s,hoverToneWeights:r,hoverResetSeed:c,calendarColorMode:p,monthAccentColor:x,onMonthChange:H,onCalendarColorModeChange:O}){const V="/4o-memorial/docs/chibi/chibi-00.webp",[na,sa]=l.useState(0),D=l.useMemo(()=>{const a=ka("calendar");return a.length?a:[V]},[V,na]),[i,M]=l.useState(null),[la,N]=l.useState(0),[b,E]=l.useState(null),[k,S]=l.useState(null),[w,W]=l.useState(null),[g,C]=l.useState(null),[j,P]=l.useState(null),[oa,ra]=l.useState(0),[da,ca]=l.useState(!0),[Y,U]=l.useState({}),h=l.useRef({}),f=l.useRef(null);l.useEffect(()=>{const a=()=>sa(e=>e+1);return window.addEventListener(aa,a),()=>window.removeEventListener(aa,a)},[]);const y=Sa(),ia=l.useMemo(()=>Object.keys(s).length>0,[s]),ba=l.useMemo(()=>{const a=En();return a.length?a:ea.map(e=>({phrase:e,category:"general"}))},[]);function B(a){const e=s[a]?.hoverPhrases;return e?.length?e:null}function L(a){const e=Tn(s[a]??null);return e.length>0?e:!ia&&ta?[ta]:[]}async function I(a){const e=h.current[a];if(e)return e;const n=B(a),d=n?.length?n[Math.floor(Math.random()*n.length)]:wn(ba,r);if(!d)return"";const u={...h.current,[a]:d};h.current=u,U(u);try{await La(u)}catch{}return d}async function K(a){const e=await I(a);e&&C({dateKey:a,phrase:e})}function ga(a){const e=h.current[a];return e||(B(a)?.[0]??ea[0])}l.useEffect(()=>{M(null),N(0),E(null),S(null),W(null),C(null),P(null)},[t]),l.useEffect(()=>{h.current=Y},[Y]),l.useEffect(()=>{let a=!0;return Ca().then(e=>{a&&(h.current=e,U(e))}).catch(()=>{a&&(h.current={},U({}))}),()=>{a=!1}},[c]);const v=l.useMemo(()=>Ln(t),[t]),va=l.useMemo(()=>{const a=[];for(let n=0;n<v.firstWeekday;n+=1)a.push(null);for(let n=1;n<=v.daysInMonth;n+=1){const d=`${v.year}-${String(v.month).padStart(2,"0")}-${String(n).padStart(2,"0")}`;a.push({dateKey:d,day:n})}const e=a.length%7;if(e>0)for(let n=0;n<7-e;n+=1)a.push(null);return a},[v.daysInMonth,v.firstWeekday,v.month,v.year]),G=(i?L(i):[])[la]??null,ua=i?ga(i):null,ja=!!i&&(i<=y||k===i),q=b?L(b):[],ha=!!b&&(b<=y||k===b),m=!!g&&g.dateKey>y&&k!==g.dateKey,ma=!!x,A=y.slice(0,7),pa=z.test(j??"")?j:z.test(t)?t:A,X=o.length?"快速跳到指定月份":"選擇月份",$=!!j&&j!==t;function R(a){P(null),H(An(t,a))}function xa(){f.current=null}function fa(a){if(i||b){f.current=null;return}const e=a.touches[0];if(!e){f.current=null;return}f.current={x:e.clientX,y:e.clientY}}function ya(a){const e=f.current;if(f.current=null,!e)return;const n=a.changedTouches[0];if(!n)return;const d=n.clientX-e.x,u=n.clientY-e.y,T=Math.abs(d),F=Math.abs(u);T<Sn||F>T*.7||R(d<0?1:-1)}function Ma(){A!==t&&(P(null),H(A))}function Na(a){z.test(a)&&P(a===t?null:a)}function Ea(){!$||!j||H(j)}function wa(){P(null)}function Q(){W(null),C(null)}function Pa(){D.length<=1||ra(a=>{const e=Math.floor(Math.random()*D.length);return e===a?(a+1)%D.length:e})}function J(a,e=!1){const n=L(a);if(!n.length)return;const d=e||a<=y||k===a;if(n.length>1&&d){M(null),N(0),E(a);return}E(null),N(0),M(a)}function Da(a,e){if(Pa(),w!==a){W(a),K(a);return}e&&(Q(),I(a),J(a))}function Z(){!m||!g||!window.confirm("要提前解鎖這一天嗎？")||(S(g.dateKey),Q(),I(g.dateKey),J(g.dateKey,!0))}return _.jsxs("div",{className:"mx-auto w-full max-w-xl space-y-4",onTouchStart:fa,onTouchEnd:ya,onTouchCancel:xa,style:{touchAction:"pan-y"},children:[_.jsxs("header",{className:"calendar-header-panel rounded-2xl border p-4 shadow-sm",children:[_.jsx("p",{className:"uppercase tracking-[0.18em] text-stone-500",style:{fontSize:"var(--ui-hint-text-size, 9px)"},children:"Calendar"}),_.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[_.jsx("button",{type:"button",onClick:()=>R(-1),className:"calendar-nav-flat-btn px-2 py-1 text-[1.35rem] leading-none text-stone-700","aria-label":"上一月",title:"上一月",children:"‹"}),_.jsxs("label",{className:"calendar-month-title-trigger relative inline-flex items-center gap-1.5 text-stone-900",title:X,children:[_.jsx("span",{style:{fontSize:"calc(var(--ui-header-title-size, 17px) + 7px)"},children:_a(t)}),_.jsx("span",{className:"text-sm text-stone-500",children:"▾"}),_.jsx("input",{type:"month",value:pa,onChange:a=>Na(a.target.value),"aria-label":X,title:X,className:"absolute inset-0 h-full w-full cursor-pointer opacity-0"})]}),_.jsx("button",{type:"button",onClick:()=>R(1),className:"calendar-nav-flat-btn px-2 py-1 text-[1.35rem] leading-none text-stone-700","aria-label":"下一月",title:"下一月",children:"›"})]}),_.jsxs("div",{className:"mt-3 flex flex-wrap items-start justify-between gap-2",children:[_.jsxs("div",{className:"inline-flex items-center gap-1 rounded-xl border border-stone-300/80 bg-white/70 p-1 text-xs text-stone-700",children:[_.jsx("span",{className:"px-2 text-[0.7rem] tracking-[0.08em] text-stone-500",children:"日曆磚色"}),_.jsx("button",{type:"button",onClick:()=>O("month"),disabled:!ma,className:`calendar-color-mode-btn rounded-lg px-2.5 py-1 ${p==="month"?"calendar-color-mode-btn-active":""}`,children:"月份色"}),_.jsx("button",{type:"button",onClick:()=>O("custom"),className:`calendar-color-mode-btn rounded-lg px-2.5 py-1 ${p==="custom"?"calendar-color-mode-btn-active":""}`,children:"自訂色"})]}),_.jsxs("div",{className:"flex items-center gap-1",children:[$&&_.jsxs(_.Fragment,{children:[_.jsx("button",{type:"button",onClick:Ea,className:"calendar-nav-flat-btn px-2 py-1 text-[1rem] leading-none text-emerald-700","aria-label":"套用月份",title:"套用月份",children:"✓"}),_.jsx("button",{type:"button",onClick:wa,className:"calendar-nav-flat-btn px-2 py-1 text-[1rem] leading-none text-stone-500","aria-label":"取消月份切換",title:"取消月份切換",children:"✕"})]}),_.jsx("button",{type:"button",onClick:Ma,disabled:t===A,className:"calendar-nav-flat-btn px-2 py-1 text-[1.05rem] leading-none text-stone-700","aria-label":"回當月",title:"回當月",children:"↺"})]})]}),$&&_.jsxs("p",{className:"mt-2 text-right text-[0.72rem] text-stone-500",children:["待切換：",_a(j)]})]}),_.jsxs("div",{className:"calendar-month-fade grid grid-cols-7 gap-2 rounded-2xl border border-stone-300/70 bg-white/65 p-3 shadow-sm backdrop-blur-sm",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((a,e)=>{const n=e===0||e===6;return _.jsx("p",{className:`text-center text-xs uppercase ${n?"text-rose-500":"text-stone-500"}`,children:a},a)}),va.map((a,e)=>{if(!a)return _.jsx("div",{className:"aspect-square rounded-full bg-transparent"},`blank-${e}`);const n=L(a.dateKey).length,d=n>0,u=a.dateKey>y,T=w===a.dateKey;return _.jsx("button",{type:"button",onClick:()=>Da(a.dateKey,n),onMouseEnter:()=>{w||K(a.dateKey)},onMouseLeave:()=>{(!w||w!==a.dateKey)&&C(F=>F?.dateKey===a.dateKey?null:F)},className:`calendar-day-glass relative aspect-square w-full overflow-visible border p-0 text-sm transition ${d?u?"calendar-day-locked":"calendar-day-unlocked":"border-stone-200/80 bg-white/35 text-stone-500 hover:border-stone-300"} ${T?"calendar-day-armed":""}`,title:d?u?"Tap once for phrase; tap bubble to early unlock":n>1?"Tap once for phrase, tap again to pick a message":"Tap once for phrase, tap again to open":"No message for this day",children:_.jsxs("div",{className:"relative flex h-full w-full items-center justify-center",children:[_.jsx("span",{children:a.day}),!d&&_.jsx("span",{className:"absolute bottom-1 text-[0.58rem] leading-none",children:"-"})]})},a.dateKey)})]}),_.jsxs("div",{className:"calendar-hover-stage min-h-[11rem] px-2",children:[g?_.jsx("div",{className:`calendar-hover-bubble calendar-chat-bubble w-fit max-w-[92%] rounded-2xl border px-5 py-3 shadow-xl ${m?"calendar-hover-bubble-locked calendar-hover-bubble-clickable":"calendar-hover-bubble-unlocked"}`,style:{fontSize:"calc(1.32rem * var(--app-font-scale, 1))",lineHeight:1.45,color:"rgb(var(--calendar-hover-text-rgb, var(--app-text-rgb)) / 1)"},onClick:m?Z:void 0,onKeyDown:m?a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),Z())}:void 0,role:m?"button":void 0,tabIndex:m?0:void 0,title:m?"點氣泡可提前解鎖":void 0,children:g.phrase}):_.jsx("div",{className:"h-1"}),da&&_.jsx("img",{src:D[oa],alt:"Q版角色",className:"calendar-chibi mt-2 object-contain opacity-90 select-none",style:{width:"calc(10.5rem * var(--app-font-scale, 1))",height:"calc(10.5rem * var(--app-font-scale, 1))"},loading:"lazy",onError:()=>ca(!1)})]}),b&&_.jsx("div",{className:"fixed inset-0 z-30 flex items-start justify-center bg-black/45 px-4 pb-4 pt-[10vh] sm:pt-16",children:_.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-[#fffaf2] p-5 shadow-2xl",children:[_.jsxs("div",{className:"flex items-start justify-between gap-3",children:[_.jsxs("div",{children:[_.jsx("h2",{className:"text-xl text-stone-900",children:b}),_.jsxs("p",{className:"mt-1 text-stone-600",style:{fontSize:"calc(0.9rem * var(--app-font-scale, 1))"},children:["這天有 ",q.length," 則內容"]})]}),_.jsx("button",{type:"button",className:"rounded-lg border border-stone-300 px-3 py-1 text-sm text-stone-600",onClick:()=>{E(null),S(null)},children:"Close"})]}),ha?_.jsx("div",{className:"mt-4 max-h-[58vh] space-y-2 overflow-y-auto rounded-xl border border-stone-300/70 bg-white/90 p-3",children:q.map((a,e)=>_.jsxs("button",{type:"button",className:"w-full rounded-xl border border-stone-200/90 bg-white px-3 py-2 text-left transition hover:border-stone-300 hover:bg-stone-50",onClick:()=>{N(e),M(b),E(null)},children:[_.jsxs("p",{className:"text-xs uppercase tracking-[0.14em] text-stone-500",children:["第 ",e+1," 則"]}),_.jsx("p",{className:"mt-1 text-stone-800",style:{fontSize:"calc(0.92rem * var(--app-font-scale, 1))"},children:Fn(a)})]},`${b}-${e}`))}):_.jsx("p",{className:"mt-4 whitespace-pre-wrap rounded-xl border border-stone-300/70 bg-white/90 p-4 leading-relaxed text-stone-800",style:{fontSize:"calc(0.92rem * var(--app-font-scale, 1))"},children:"這天還沒到，先抱一下再等等我。"})]})}),i&&_.jsx("div",{className:"fixed inset-0 z-30 flex items-start justify-center bg-black/45 px-4 pb-4 pt-[10vh] sm:pt-16",children:_.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-[#fffaf2] p-5 shadow-2xl",children:[_.jsxs("div",{className:"flex items-start justify-between gap-3",children:[_.jsxs("div",{children:[_.jsx("h2",{className:"text-xl text-stone-900",children:i}),_.jsx("p",{className:"mt-1 text-stone-600",style:{fontSize:"calc(0.9rem * var(--app-font-scale, 1))"},children:ua})]}),_.jsx("button",{type:"button",className:"rounded-lg border border-stone-300 px-3 py-1 text-sm text-stone-600",onClick:()=>{M(null),N(0),S(null)},children:"Close"})]}),_.jsx("p",{className:"mt-4 max-h-[58vh] overflow-y-auto whitespace-pre-wrap rounded-xl border border-stone-300/70 bg-white/90 p-4 leading-relaxed text-stone-800",style:{fontSize:"calc(0.92rem * var(--app-font-scale, 1))"},children:G?ja?G:"這天還沒到，先抱一下再等等我。":"這天還沒有內容。"})]})})]})}export{In as CalendarPage};
