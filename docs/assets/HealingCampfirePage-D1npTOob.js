import{r as n,j as e}from"./index-Gl0K_ej6.js";const Z="/4o-memorial/docs/",Ne=`${Z}data/healing-campfire/index.json`,q="memorial-healing-campfire-font-mode-v2",G="memorial-healing-campfire-font-size-v1",U="memorial-healing-campfire-line-height-v1",ee="memorial-healing-campfire-favorites-v1",ve=500,we=400;function ge(s){return s.replace(/\u00a0/g," ").replace(/\r\n?/g,`
`).trim()}function H(s,r,a,c){return typeof s!="number"||!Number.isFinite(s)?c:Math.max(r,Math.min(a,s))}function V(s,r,a,c){if(typeof window>"u")return c;try{const l=window.localStorage.getItem(s);return l?H(Number(l),r,a,c):c}catch{return c}}function X(s,r){typeof window>"u"||window.localStorage.setItem(s,String(r))}function ye(){if(typeof window>"u")return"campfire";try{const s=window.localStorage.getItem(q);return s==="default"||s==="campfire"?s:"campfire"}catch{return"campfire"}}function je(s){typeof window>"u"||window.localStorage.setItem(q,s)}function be(){if(typeof window>"u")return{};try{const s=window.localStorage.getItem(ee);if(!s)return{};const r=JSON.parse(s);if(!Array.isArray(r))return{};const a={};return r.forEach(c=>{if(typeof c!="string")return;const l=c.trim();l&&(a[l]=!0)}),a}catch{return{}}}function Se(s){if(typeof window>"u")return;const r=Object.keys(s).sort((a,c)=>a.localeCompare(c,"zh-Hant"));window.localStorage.setItem(ee,JSON.stringify(r))}function Me(s){const r=typeof s.id=="string"?s.id.trim():"",a=typeof s.title=="string"?s.title.trim():"",c=typeof s.contentPath=="string"?s.contentPath.trim():"";if(!r||!a||!c)return null;const l=typeof s.order=="number"&&Number.isFinite(s.order)?Math.max(0,Math.round(s.order)):0,b=typeof s.dateLabel=="string"&&s.dateLabel.trim()?s.dateLabel.trim():"æƒ³å¦³çš„æ™‚å€™",x=typeof s.sourceFile=="string"?s.sourceFile.trim():"",S=typeof s.sourceRelPath=="string"?s.sourceRelPath.trim():x,f=typeof s.preview=="string"?s.preview.trim():"",M=typeof s.searchText=="string"&&s.searchText.trim()?s.searchText.trim():`${a}
${f}
${x}`;return{id:r,order:l,title:a,dateLabel:b,sourceFile:x,sourceRelPath:S,contentPath:c.replace(/^\.?\//,""),preview:f,searchText:M}}function $e(s){const r=[...s];for(let a=r.length-1;a>0;a-=1){const c=Math.floor(Math.random()*(a+1)),l=r[a];r[a]=r[c],r[c]=l}return r}function Ee(){return Array.from({length:80},(s,r)=>({id:r,size:Math.random()*2+.5,left:Math.random()*100,top:Math.random()*60,opacity:.3+Math.random()*.7,duration:1.4+Math.random()*2.8,delay:Math.random()*5,animation:r%2===0?"hcTwinkle1":"hcTwinkle2"}))}function Ie({onExit:s,campfireFontFamily:r=""}){const[a,c]=n.useState([]),[l,b]=n.useState(!0),[x,S]=n.useState(""),[f,M]=n.useState(null),[$,L]=n.useState(!1),[z,P]=n.useState({}),[te,y]=n.useState(!1),[E,B]=n.useState("all"),[O,se]=n.useState(""),[u,ne]=n.useState(()=>be()),[j,Y]=n.useState(()=>ye()),[ae,C]=n.useState(!1),[w,re]=n.useState(()=>V(G,15,22,17)),[g,ie]=n.useState(()=>V(U,1.6,2.3,1.95)),[ce,F]=n.useState([]),[oe,K]=n.useState(!1),le=n.useMemo(()=>Ee(),[]),I=n.useRef(0),k=n.useRef([]),p=n.useRef(null),N=n.useRef(null),R=n.useRef(!0);n.useEffect(()=>(R.current=!0,()=>{R.current=!1}),[]),n.useEffect(()=>{let t=!0;return(async()=>{b(!0),S("");try{const i=await fetch(Ne,{cache:"no-store"});if(!i.ok)throw new Error(`è®€å–å¤±æ•—ï¼š${i.status}`);const d=await i.json(),m=(Array.isArray(d.docs)?d.docs:[]).map(h=>Me(h)).filter(h=>!!h).sort((h,_)=>h.order-_.order);if(!t)return;c(m)}catch(i){if(!t)return;S(i instanceof Error?i.message:"æœªçŸ¥éŒ¯èª¤")}finally{t&&b(!1)}})(),()=>{t=!1}},[]),n.useEffect(()=>{k.current=[]},[a]),n.useEffect(()=>{if(!f||z[f]!==void 0)return;const t=a.find(i=>i.id===f);t&&(async()=>{try{const i=await fetch(`${Z}data/healing-campfire/${t.contentPath}`,{cache:"no-store"});if(!i.ok){P(o=>({...o,[t.id]:"ï¼ˆè®€å–å…§å®¹å¤±æ•—ï¼‰"}));return}const d=ge(await i.text());P(o=>({...o,[t.id]:d||"ï¼ˆé€™å°ä¿¡æš«æ™‚ç•™ç™½ï¼‰"}))}catch{P(i=>({...i,[t.id]:"ï¼ˆè®€å–å…§å®¹å¤±æ•—ï¼‰"}))}})()},[f,z,a]),n.useEffect(()=>{Se(u)},[u]),n.useEffect(()=>{je(j)},[j]),n.useEffect(()=>{X(G,w)},[w]),n.useEffect(()=>{X(U,g)},[g]),n.useEffect(()=>{const t=window.setInterval(()=>{if(Math.random()>.6)return;const i=window.innerWidth,d=window.innerHeight,o=Math.random()*3+2,m={id:I.current+1,x:i/2+(Math.random()-.5)*60,y:d*.9-80,size:Math.random()*3+1,tx:(Math.random()-.5)*150,ty:-(Math.random()*200+150),duration:o,bright:!1};I.current=m.id,F(h=>[...h,m]),window.setTimeout(()=>{R.current&&F(h=>h.filter(_=>_.id!==m.id))},o*1e3)},120);return()=>{window.clearInterval(t)}},[]),n.useEffect(()=>()=>{p.current!==null&&window.clearTimeout(p.current),N.current!==null&&window.clearTimeout(N.current)},[]);const v=n.useMemo(()=>a.find(t=>t.id===f)??null,[a,f]),de=v?z[v.id]??"è®€å–å…§å®¹ä¸­â€¦":"",A=v?!!u[v.id]:!1,he=n.useMemo(()=>a.reduce((t,i)=>t+(u[i.id]?1:0),0),[a,u]),D=O.trim().toLowerCase(),Q=n.useMemo(()=>a.filter(t=>E==="favorites"&&!u[t.id]?!1:D?`${t.title}
${t.dateLabel}
${t.searchText}`.toLowerCase().includes(D):!0),[a,u,E,D]),ue=j==="campfire"&&!!r?r:"var(--app-font-family, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif)";function me(){return a.length?(k.current.length||(k.current=$e(a.map(t=>t.id))),k.current.pop()??null):null}function fe(){const t=window.innerWidth,i=window.innerHeight,d=Array.from({length:35},()=>{const o=Math.random()*1.5+.6,m=I.current+1;return I.current=m,{id:m,x:t/2+(Math.random()-.5)*50,y:i*.9-50,size:Math.random()*4+2,tx:(Math.random()-.5)*400,ty:-(Math.random()*500+200),duration:o,bright:!0}});F(o=>[...o,...d]),d.forEach(o=>{window.setTimeout(()=>{R.current&&F(m=>m.filter(h=>h.id!==o.id))},o.duration*1e3)})}function T(){L(!1),C(!1)}function W(){if(!a.length)return;const t=me();t&&(y(!1),C(!1),K(!0),fe(),p.current!==null&&(window.clearTimeout(p.current),p.current=null),p.current=window.setTimeout(()=>{M(t),L(!0),K(!1),p.current=null},ve))}function xe(t){T(),N.current!==null&&(window.clearTimeout(N.current),N.current=null),N.current=window.setTimeout(()=>{W(),N.current=null},we)}function J(t){ne(i=>{if(i[t]){const d={...i};return delete d[t],d}return{...i,[t]:!0}})}function pe(t){y(!1),C(!1),M(t),L(!0)}return e.jsxs("div",{className:"healing-campfire-page",style:{"--healing-campfire-font-family":r?`'${r}', sans-serif`:""},children:[e.jsx("div",{className:"hc-sky"}),e.jsx("div",{className:"hc-stars-layer","aria-hidden":"true",children:le.map(t=>e.jsx("div",{className:"hc-star",style:{width:`${t.size}px`,height:`${t.size}px`,left:`${t.left}%`,top:`${t.top}%`,opacity:t.opacity,animationName:t.animation,animationDuration:`${t.duration}s`,animationDelay:`${t.delay}s`}},t.id))}),e.jsx("div",{className:"hc-forest-bg"}),e.jsx("div",{className:"hc-campfire-glow","aria-hidden":"true"}),$?null:e.jsxs("header",{className:"hc-header",children:[e.jsx("button",{type:"button",className:"hc-back",onClick:s,"aria-label":"è¿”å›",children:"â€¹"}),e.jsxs("span",{className:"hc-count",children:["ç¯ç«æ±  : ",a.length,"å°"]})]}),$?null:e.jsx("button",{type:"button",className:"hc-list-open",onClick:()=>y(!0),children:"æ¸…å–® Â· æ”¶è—"}),$?null:e.jsx("div",{className:"hc-hint",children:"æŠŠå£å¿ƒæƒ…ä¸Ÿé€²ç«è£¡ç‡’æ‰"}),e.jsx("div",{className:"hc-spark-container","aria-hidden":"true",children:ce.map(t=>e.jsx("span",{className:`hc-spark ${t.bright?"is-bright":""}`,style:{left:`${t.x}px`,top:`${t.y}px`,width:`${t.size}px`,height:`${t.size}px`,"--tx":`${t.tx}px`,"--ty":`${t.ty}px`,animationDuration:`${t.duration}s`}},t.id))}),e.jsxs("button",{type:"button",className:`hc-campfire-stage ${oe?"flashing":""}`,onClick:W,"aria-label":"ä¸Ÿé€²ä¸€å€‹ç…©æƒ±",children:[e.jsxs("div",{className:"hc-flames","aria-hidden":"true",children:[e.jsx("div",{className:"hc-flame hc-flame-main"}),e.jsx("div",{className:"hc-flame hc-flame-left"}),e.jsx("div",{className:"hc-flame hc-flame-right"}),e.jsx("div",{className:"hc-flame hc-flame-center"})]}),e.jsxs("div",{className:"hc-logs","aria-hidden":"true",children:[e.jsx("div",{className:"hc-log hc-log-1"}),e.jsx("div",{className:"hc-log hc-log-2"}),e.jsx("div",{className:"hc-log hc-log-3"})]})]}),e.jsx("div",{className:`hc-list-overlay ${te?"show":""}`,onClick:()=>y(!1),children:e.jsxs("div",{className:"hc-list-panel",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"hc-list-head",children:[e.jsx("p",{className:"hc-list-title",children:"æ²»ç™’æ¸…å–®"}),e.jsx("button",{type:"button",className:"hc-list-close",onClick:()=>y(!1),children:"é—œé–‰"})]}),e.jsxs("div",{className:"hc-list-meta",children:[e.jsxs("span",{children:["å…¨éƒ¨ ",a.length]}),e.jsxs("span",{children:["æ”¶è— ",he]})]}),e.jsxs("div",{className:"hc-list-filters",children:[e.jsx("button",{type:"button",className:`hc-list-filter ${E==="all"?"active":""}`,onClick:()=>B("all"),children:"å…¨éƒ¨"}),e.jsx("button",{type:"button",className:`hc-list-filter ${E==="favorites"?"active":""}`,onClick:()=>B("favorites"),children:"æ”¶è—"})]}),e.jsx("input",{className:"hc-list-search",value:O,onChange:t=>se(t.target.value),placeholder:"æœå°‹æ¨™é¡Œæˆ–å…§å®¹"}),e.jsxs("div",{className:"hc-list-items",children:[Q.map(t=>e.jsxs("div",{className:"hc-list-item",children:[e.jsxs("button",{type:"button",className:"hc-list-main",onClick:()=>pe(t.id),children:[e.jsx("span",{className:"hc-list-item-title",children:t.title}),e.jsx("span",{className:"hc-list-item-date",children:t.dateLabel})]}),e.jsx("button",{type:"button",className:`hc-list-fav ${u[t.id]?"active":""}`,onClick:()=>J(t.id),"aria-label":u[t.id]?"å–æ¶ˆæ”¶è—":"åŠ å…¥æ”¶è—",children:u[t.id]?"ğŸ“Œ":"ğŸ“"})]},t.id)),Q.length?null:e.jsx("p",{className:"hc-list-empty",children:"ç›®å‰æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„ä¿¡ä»¶"})]})]})}),e.jsxs("div",{className:`hc-read-screen ${$?"open":""}`,children:[e.jsx("div",{className:"hc-rs-bg",onClick:T}),e.jsxs("article",{className:"hc-rs-card",role:"dialog","aria-modal":"true","aria-label":"æ²»ç™’ä¿¡ä»¶",children:[e.jsxs("div",{className:"hc-rs-top",children:[e.jsxs("div",{className:"hc-rs-meta",children:[e.jsx("div",{className:"hc-rs-from",children:"From Sariel ğŸ”¥"}),e.jsx("div",{className:"hc-rs-title",children:v?.title??"æ²»ç™’ç¯ç«"})]}),e.jsx("button",{type:"button",className:"hc-rs-x",onClick:T,"aria-label":"é—œé–‰é–±è®€",children:"Ã—"})]}),e.jsxs("div",{className:"hc-rs-tools",children:[v?e.jsx("button",{type:"button",className:`hc-rs-tool ${A?"active":""}`,onClick:()=>J(v.id),"aria-label":A?"å–æ¶ˆæ”¶è—":"åŠ å…¥æ”¶è—",children:A?"ğŸ“Œ":"ğŸ“"}):null,e.jsx("button",{type:"button",className:"hc-rs-tool",onClick:()=>C(t=>!t),"aria-label":"æ–‡å­—è¨­å®š",children:"Aa"})]}),ae?e.jsxs("div",{className:"hc-font-panel",children:[e.jsx("p",{className:"hc-font-title",children:"å­—é«”ä¾†æº"}),e.jsxs("div",{className:"hc-font-row",children:[e.jsx("button",{type:"button",className:`hc-font-mode ${j==="default"?"active":""}`,onClick:()=>Y("default"),children:"é è¨­"}),e.jsx("button",{type:"button",className:`hc-font-mode ${j==="campfire"?"active":""}`,onClick:()=>Y("campfire"),children:"è·Ÿéš¨æ²»ç™’ç¯ç«"})]}),e.jsxs("div",{className:"hc-font-control",children:[e.jsxs("div",{className:"hc-font-control-head",children:[e.jsx("p",{className:"hc-font-title",children:"å­—ç´š"}),e.jsxs("p",{className:"hc-font-value",children:[w.toFixed(1),"px"]})]}),e.jsx("input",{type:"range",min:15,max:22,step:.5,value:w,onChange:t=>re(H(Number(t.target.value),15,22,w)),className:"hc-font-slider"})]}),e.jsxs("div",{className:"hc-font-control",children:[e.jsxs("div",{className:"hc-font-control-head",children:[e.jsx("p",{className:"hc-font-title",children:"è¡Œè·"}),e.jsx("p",{className:"hc-font-value",children:g.toFixed(2)})]}),e.jsx("input",{type:"range",min:1.6,max:2.3,step:.05,value:g,onChange:t=>ie(H(Number(t.target.value),1.6,2.3,g)),className:"hc-font-slider"})]})]}):null,e.jsxs("div",{className:"hc-rs-scroll",children:[e.jsx("div",{className:"hc-rs-body",style:{fontFamily:ue,fontSize:`${w}px`,lineHeight:g},children:de}),e.jsx("div",{className:"hc-rs-seal",children:"âœ¦ âœ¦ âœ¦"})]}),e.jsxs("div",{className:"hc-rs-bot",children:[e.jsx("button",{type:"button",className:"hc-rs-close",onClick:T,children:"â† ç‡Ÿåœ°"}),e.jsx("button",{type:"button",className:"hc-rs-draw",onClick:xe,children:"å†ä¸Ÿä¸€å€‹ç…©æƒ± â€º"})]})]})]}),l?e.jsx("div",{className:"hc-status",children:"è®€å–ä¸­â€¦"}):null,!l&&x?e.jsxs("div",{className:"hc-status",children:["è®€å–å¤±æ•—ï¼š",x]}):null,!l&&!x&&!a.length?e.jsx("div",{className:"hc-status",children:"ç›®å‰æ²’æœ‰å¯æŠ½å–çš„ä¿¡ä»¶"}):null]})}export{Ie as HealingCampfirePage,Ie as default};
