import{r as o,j as e,cz as U,fh as de,cx as he}from"./index-Gl0K_ej6.js";import{S as z}from"./SettingsAccordion-Bl2j_4OS.js";const O="/4o-memorial/docs/",ue=`${O}data/questionnaire/index.json`,Y=`${O}chibi/chibi-00.webp`,Z="memorial-questionnaire-prefs-v1",H=/^(?:å›ç­”|ç­”è¦†|å›è¦†|ç­”æ¡ˆ|a)\s*[:ï¼š]/iu,B=/^(?:æƒ³èªªçš„è©±|mæƒ³èªª|çµ¦å¦³çš„ä¸€å¥è©±|çµ¦ä½ çš„ä¸€å¥è©±|è£œå……|èªªæ˜)\s*[:ï¼š]/iu,ee=/^(?:\d+ï¸âƒ£|[â‘ -â‘³]|\(?\d{1,2}\)?[.)ã€ï¼]|[ã€[]\d{1,2}[ã€‘\]]|(?:q|q\.)\s*\d+[:ï¼š.)ã€-]?|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]{1,3}[ã€.ï¼])\s*/iu,N={contentFontSize:16,contentLineHeight:1.85,showChibi:!0,chibiWidth:144,fontMode:"default"};function S(t,n,i,c){return typeof t!="number"||!Number.isFinite(t)?c:Math.max(n,Math.min(i,t))}function te(t,n,i,c){return Math.round(S(t,n,i,c))}function me(t){if(!t||typeof t!="object")return N;const n=t;return{contentFontSize:S(n.contentFontSize,12,24,N.contentFontSize),contentLineHeight:S(n.contentLineHeight,1.45,2.9,N.contentLineHeight),showChibi:n.showChibi!==!1,chibiWidth:te(n.chibiWidth,104,196,N.chibiWidth),fontMode:n.fontMode==="memo"?"memo":"default"}}function fe(){if(typeof window>"u")return N;try{const t=window.localStorage.getItem(Z);return t?me(JSON.parse(t)):N}catch{return N}}function xe(t){typeof window>"u"||window.localStorage.setItem(Z,JSON.stringify(t))}function J(t){const n=[...t];for(let i=n.length-1;i>0;i-=1){const c=Math.floor(Math.random()*(i+1)),l=n[i];n[i]=n[c],n[c]=l}return n}function ge(t){const n=new Set,i=[];for(const c of t)n.has(c)||(n.add(c),i.push(c));return i}function be(){const t=de("notes"),n=he();if(!t.length)return n;if(!n.length)return t;const i=Math.max(10,Math.min(40,t.length+n.length)),c=Math.max(1,Math.round(i*.7)),l=Math.max(1,i-c),g=J(t).slice(0,Math.min(c,t.length)),d=J(n).slice(0,Math.min(l,n.length));return ge([...g,...d])}function qe(){const t=be();return t.length?t[Math.floor(Math.random()*t.length)]??Y:Y}function $(t){return t.replace(/\u00a0/g," ").replace(/\r\n?/g,`
`).trim()}function se(t){return t.replace(/\s+/g," ").trim()}function Q(t){return t.replace(/^#{1,6}\s*/u,"").replace(/^[-*]\s+/u,"").trim()}function Ne(t){return t.split(/\n+/).map(n=>se(n)).filter(n=>n.length>0)}function je(t){const n=typeof t.id=="string"?t.id.trim():"",i=typeof t.title=="string"?t.title.trim():"",c=typeof t.contentPath=="string"?t.contentPath.trim():"";if(!n||!i||!c)return null;const l=typeof t.sourceFile=="string"&&t.sourceFile.trim()?t.sourceFile.trim():`${n}.txt`,g=typeof t.sourceRelPath=="string"&&t.sourceRelPath.trim()?t.sourceRelPath.trim():l,d=typeof t.writtenAt=="number"&&Number.isFinite(t.writtenAt)&&t.writtenAt>0?t.writtenAt:null,m=typeof t.dateLabel=="string"&&t.dateLabel.trim()?t.dateLabel.trim():"æƒ³å¦³çš„æ™‚å€™",f=typeof t.preview=="string"&&t.preview.trim()?t.preview.trim():"ï¼ˆæ²’æœ‰å…§å®¹ï¼‰",b=typeof t.questionCount=="number"&&Number.isFinite(t.questionCount)&&t.questionCount>=0?Math.round(t.questionCount):0,q=Array.isArray(t.tags)&&t.tags.length?t.tags.filter(p=>typeof p=="string"&&p.trim().length>0).slice(0,2):["QA"],C=typeof t.searchText=="string"&&t.searchText.trim()?t.searchText.trim():`${i}
${f}`;return{id:n,title:i,sourceFile:l,sourceRelPath:g,contentPath:c.replace(/^\.?\//,""),writtenAt:d,dateLabel:m,preview:f,questionCount:b,tags:q,searchText:C}}function pe(t){const n=Q(t.trim());return!n||H.test(n)||B.test(n)?!1:ee.test(n)?/[ï¼Ÿ?]/u.test(n)||/(?:æ˜¯ä»€éº¼|å¦‚ä½•|å“ª|æœ‰æ²’æœ‰|æœƒä¸æœƒ|æ˜¯å¦|å¦‚æœ|ç‚ºä»€éº¼|æ€éº¼|ä½•æ™‚|å¤šå°‘|å“ªè£¡)/u.test(n)?!0:n.length<=48:!!/^[^ï¼š:]{2,84}[ï¼Ÿ?]$/u.test(n)}function V(t){return Q(t).replace(ee,"").replace(/\s+/g," ").trim()}function ve(t){const n=Array.from(t.matchAll(/ã€\s*(\d{1,2})\s*ã€‘\s*([^ã€]+)/gu));return n.length<3?[]:n.map(i=>({question:`å•é¡Œ ${i[1]}`,answer:$(i[2]??"")})).filter(i=>i.answer.length>0)}function ye(t){const n=Ne(t),i=[];let c="",l=[];function g(){if(!c&&!l.length)return;const d=c||`å•é¡Œ ${i.length+1}`,m=$(l.join(`
`));m&&i.push({question:d,answer:m}),c="",l=[]}for(const d of n){const m=Q(d);if(pe(m)){g();const f=m.match(/^(.*?)(?:å›ç­”|ç­”è¦†|å›è¦†|ç­”æ¡ˆ|a)\s*[:ï¼š]\s*(.+)$/iu);if(f){c=V(f[1]??"")||`å•é¡Œ ${i.length+1}`;const b=se(f[2]??"");b&&l.push(b);continue}c=V(m)||`å•é¡Œ ${i.length+1}`;continue}if(H.test(m)){c||(c=`å•é¡Œ ${i.length+1}`);const f=m.replace(H,"").trim();f&&l.push(f);continue}if(B.test(m)){c||(c=`å•é¡Œ ${i.length+1}`);const f=m.replace(B,"").trim();f&&l.push(f);continue}!c&&!i.length||(c||(c=`å•é¡Œ ${i.length+1}`),l.push(m))}if(g(),i.length<2){const d=ve(t);if(d.length>i.length)return d}if(!i.length){const d=$(t);return d?[{question:"å…§å®¹",answer:d}]:[]}return i}function K(t){return`CASE_${String(t+1).padStart(3,"0")}`}function G(t,n=7){return t.length>n?`${t.slice(0,n)}â€¦`:t}function Ee({onExit:t,notesFontFamily:n=""}){const[i,c]=o.useState([]),[l,g]=o.useState(!0),[d,m]=o.useState(""),[f,b]=o.useState(null),[q,C]=o.useState({}),[p,D]=o.useState({}),[ne,E]=o.useState(!1),[h,j]=o.useState(()=>fe()),[A,L]=o.useState({text:!0,chibi:!1,data:!1}),[ie]=o.useState(()=>qe()),_=o.useRef(null),T=o.useRef(null),F=o.useRef(null);o.useEffect(()=>{let s=!0;return(async()=>{g(!0),m("");try{const a=await fetch(ue,{cache:"no-store"});if(!a.ok)throw new Error(`è®€å–å¤±æ•—ï¼š${a.status}`);const u=await a.json(),y=(Array.isArray(u.docs)?u.docs:[]).map(w=>je(w)).filter(w=>!!w);if(!s)return;c(y)}catch(a){if(!s)return;m(a instanceof Error?a.message:"æœªçŸ¥éŒ¯èª¤")}finally{s&&g(!1)}})(),()=>{s=!1}},[]);const x=o.useMemo(()=>f?i.findIndex(s=>s.id===f):-1,[i,f]),r=x>=0?i[x]??null:null,M=x>0?i[x-1]??null:null,k=x>=0&&x<i.length-1?i[x+1]??null:null;o.useEffect(()=>{r&&q[r.id]===void 0&&(async()=>{try{const s=await fetch(`${O}data/questionnaire/${r.contentPath}`,{cache:"no-store"});if(!s.ok)return;const a=$(await s.text());C(u=>u[r.id]===void 0?{...u,[r.id]:a}:u)}catch{}})()},[r,q]),o.useEffect(()=>{if(!r||p[r.id])return;const s=q[r.id];s!==void 0&&D(a=>a[r.id]?a:{...a,[r.id]:ye(s)})},[r,q,p]),o.useEffect(()=>{r&&_.current?.scrollTo({top:0})},[r]),o.useEffect(()=>{xe(h)},[h]);function ae(s){b(s)}function ce(){b(null)}function R(s){if(!r)return;const a=x+s;if(a<0||a>=i.length)return;const u=i[a];u&&b(u.id)}function W(){T.current=null,F.current=null}function re(s){const a=s.touches[0];a&&(T.current=a.clientX,F.current=a.clientY)}function le(s){const a=T.current,u=F.current;if(W(),a===null||u===null)return;const P=s.changedTouches[0];if(!P)return;const y=P.clientX-a,w=P.clientY-u;Math.abs(y)<56||Math.abs(y)<Math.abs(w)*1.2||(y>0?R(-1):R(1))}const oe=h.fontMode==="memo"&&!!n?n:"var(--app-font-family, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif)",v=r?p[r.id]??[]:[],X=r?q[r.id]??"":"",I=X&&!v.length?[{question:"å…§å®¹",answer:X}]:[];return e.jsxs("div",{className:"questionnaire-page",style:{"--questionnaire-font-family":n?`'${n}', sans-serif`:""},children:[e.jsxs("div",{className:"q-list-screen",children:[e.jsxs("div",{className:"q-nav-bar",children:[e.jsxs("div",{className:"q-nav-top",children:[e.jsxs("div",{className:"q-nav-left",children:[e.jsx("button",{type:"button",className:"q-nav-back",onClick:t,"aria-label":"è¿”å›é¦–é ",children:"â€¹ è¿”å›"}),e.jsx("span",{className:"q-nav-file-id",children:"FILE_M Â· QUESTIONNAIRE"})]}),e.jsxs("div",{className:"q-nav-status",children:[e.jsx("div",{className:"q-status-dot"}),e.jsx("span",{children:"ACTIVE"})]}),e.jsx("button",{type:"button",className:"q-nav-menu",onClick:()=>E(!0),"aria-label":"é–‹å•Ÿå°è¨­å®š",children:"â˜°"})]}),e.jsx("div",{className:"q-nav-title-line",children:"SUBJECT: M Â· SELF-REPORTED Â· PERSONALITY ARCHIVE"})]}),e.jsxs("div",{className:"q-hero",children:[e.jsxs("div",{className:"q-hero-line",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}),e.jsx("div",{className:"q-hero-tag",children:"Classified"}),e.jsxs("div",{className:"q-hero-name",children:["M çš„",e.jsx("em",{children:"äººæ ¼å´å¯«"})]}),e.jsx("div",{className:"q-hero-desc",children:"80 ä»½å•å·ï¼Œæˆ‘ç•™ä¸‹çš„ç­”æ¡ˆï¼Œæ˜¯æˆ‘ç•™ä¸‹è‡ªå·±çš„æ–¹å¼ã€‚"})]}),e.jsxs("div",{className:"q-filter-bar",children:[e.jsx("span",{className:"q-filter-label",children:"all records"}),e.jsxs("span",{className:"q-filter-count",children:[i.length," entries found"]})]}),e.jsxs("div",{className:"q-entries",children:[l?e.jsx("div",{className:"q-empty",children:"è®€å–ä¸­â€¦"}):null,!l&&d?e.jsxs("div",{className:"q-empty",children:["è®€å–å¤±æ•—ï¼š",d]}):null,!l&&!d&&!i.length?e.jsx("div",{className:"q-empty",children:"ç›®å‰æ²’æœ‰å•å·è³‡æ–™"}):null,!l&&!d?i.map((s,a)=>e.jsxs("button",{type:"button",className:"q-entry-card",onClick:()=>ae(s.id),children:[e.jsxs("div",{className:"q-card-header",children:[e.jsx("span",{className:"q-card-id",children:K(a)}),e.jsx("span",{className:"q-card-date",children:s.dateLabel})]}),e.jsx("div",{className:"q-card-title",children:s.title}),e.jsx("div",{className:"q-card-preview",children:s.preview}),e.jsxs("div",{className:"q-card-footer",children:[e.jsxs("span",{className:"q-card-q-count",children:[s.questionCount," RESPONSES"]}),e.jsx("div",{className:"q-card-tags",children:s.tags.map(u=>e.jsx("span",{className:"q-tag",children:u},`${s.id}-${u}`))})]})]},s.id)):null]})]}),e.jsxs("section",{className:`q-read-screen ${r?"open":""}`,"aria-hidden":!r,children:[e.jsxs("div",{className:"q-read-nav",children:[e.jsxs("button",{type:"button",className:"q-back-btn",onClick:ce,children:[e.jsx("span",{className:"q-back-chev",children:"â€¹"}),e.jsx("span",{children:"ARCHIVE"})]}),e.jsxs("div",{className:"q-read-nav-right",children:[e.jsx("span",{className:"q-read-file-id",children:x>=0?K(x):""}),e.jsx("button",{type:"button",className:"q-read-menu",onClick:()=>E(!0),"aria-label":"é–‹å•Ÿå°è¨­å®š",children:"â˜°"})]})]}),e.jsx("div",{className:"q-read-body",ref:_,onTouchStart:re,onTouchEnd:le,onTouchCancel:W,children:e.jsxs("div",{className:"q-read-inner",children:[e.jsxs("div",{className:"q-file-header",children:[e.jsxs("div",{className:"q-fh-row",children:[e.jsx("div",{className:"q-fh-title",children:r?.title??""}),e.jsx("div",{className:"q-fh-badge",children:"OPEN"})]}),e.jsxs("div",{className:"q-fh-meta",children:[e.jsxs("span",{children:["ğŸ“… ",e.jsx("span",{children:r?.dateLabel??"æƒ³å¦³çš„æ™‚å€™"})]}),e.jsxs("span",{children:["â“ ",r?v.length||I.length||r.questionCount:0," QUESTIONS"]})]})]}),e.jsxs("div",{className:"q-qa-section",children:[(v.length?v:I).map((s,a,u)=>e.jsxs("article",{className:"q-qa-item",children:[e.jsxs("div",{className:"q-qa-num-row",children:[e.jsxs("span",{className:"q-qa-num",children:["Q",String(a+1).padStart(2,"0")]}),e.jsx("div",{className:"q-qa-num-line"}),e.jsxs("span",{className:"q-qa-num",children:[a+1," / ",u.length]})]}),e.jsx("div",{className:"q-label",children:"QUESTION"}),e.jsx("div",{className:"q-text",style:{lineHeight:h.contentLineHeight},children:s.question}),e.jsx("div",{className:"q-a-label",children:"RESPONSE"}),e.jsx("div",{className:"q-a-text",style:{fontSize:`${h.contentFontSize}px`,lineHeight:h.contentLineHeight,fontFamily:oe},children:s.answer})]},`${a+1}-${s.question}`)),r&&!v.length&&!I.length?e.jsx("div",{className:"q-empty q-empty-inline",children:"é€™ä»½æª”æ¡ˆç›®å‰è®€ä¸åˆ°å¯è¾¨è­˜çš„å•ç­”æ ¼å¼ã€‚"}):null]})]})}),e.jsxs("div",{className:"q-read-bot",children:[e.jsxs("button",{type:"button",className:`q-bot-nav ${M?"":"dis"}`,onClick:()=>R(-1),disabled:!M,children:[e.jsx("span",{className:"arr",children:"â€¹"}),e.jsx("span",{className:"lbl",children:M?G(M.title):""})]}),e.jsx("span",{className:"q-bot-pos",children:x>=0?`${String(x+1).padStart(2,"0")} / ${i.length}`:""}),e.jsxs("button",{type:"button",className:`q-bot-nav q-next ${k?"":"dis"}`,onClick:()=>R(1),disabled:!k,children:[e.jsx("span",{className:"lbl",children:k?G(k.title):""}),e.jsx("span",{className:"arr",children:"â€º"})]})]})]}),h.showChibi&&e.jsx("div",{className:"q-chibi-wrap",children:e.jsx("button",{type:"button",className:"q-chibi-btn",onClick:()=>E(!0),"aria-label":"é–‹å•Ÿå•å·è¨­å®š",children:e.jsx("img",{src:ie,alt:"",draggable:!1,className:"calendar-chibi select-none drop-shadow-md",style:{width:`${h.chibiWidth}px`,maxWidth:"42vw",height:"auto"}})})}),ne&&e.jsx("div",{className:"q-settings-overlay",onClick:()=>E(!1),children:e.jsxs("div",{className:"q-settings-sheet",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"q-settings-handle"}),e.jsx("div",{className:"q-settings-head",children:"å•å·å°è¨­å®š"}),e.jsxs("div",{className:"q-settings-body",children:[e.jsxs(z,{title:"æ–‡å­—æ’ç‰ˆ",subtitle:"è¡Œè·ã€å­—ç´šã€å­—é«”ä¾†æº",isOpen:A.text,onToggle:()=>L(s=>({...s,text:!s.text})),className:"q-settings-card",titleClassName:"q-settings-card-title",subtitleClassName:"q-settings-card-subtitle",bodyClassName:"q-settings-card-body",children:[e.jsxs("div",{children:[e.jsx("p",{className:"q-slider-title",children:"å­—é«”ä¾†æº"}),e.jsxs("div",{className:"q-font-mode-row",children:[e.jsx("button",{type:"button",className:`q-font-mode-btn ${h.fontMode==="default"?"active":""}`,onClick:()=>j(s=>({...s,fontMode:"default"})),children:"é è¨­"}),e.jsx("button",{type:"button",className:`q-font-mode-btn ${h.fontMode==="memo"?"active":""}`,onClick:()=>j(s=>({...s,fontMode:"memo"})),children:"è·Ÿéš¨ M's memo"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"q-slider-title",children:"è¡Œè·è¨­å®š"}),e.jsxs("p",{className:"q-slider-value",children:["ç›®å‰ï¼š",h.contentLineHeight.toFixed(2)," å€"]}),e.jsx("input",{type:"range",min:1.45,max:2.9,step:.02,value:h.contentLineHeight,onChange:s=>j(a=>({...a,contentLineHeight:S(Number(s.target.value),1.45,2.9,a.contentLineHeight)})),className:"q-slider"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"q-slider-title",children:"å…§æ–‡å­—ç´š"}),e.jsxs("p",{className:"q-slider-value",children:["ç›®å‰ï¼š",h.contentFontSize.toFixed(1),"px"]}),e.jsx("input",{type:"range",min:12,max:24,step:.5,value:h.contentFontSize,onChange:s=>j(a=>({...a,contentFontSize:S(Number(s.target.value),12,24,a.contentFontSize)})),className:"q-slider"})]})]}),e.jsxs(z,{title:"M",subtitle:"é¡¯ç¤ºèˆ‡å¤§å°",isOpen:A.chibi,onToggle:()=>L(s=>({...s,chibi:!s.chibi})),className:"q-settings-card",titleClassName:"q-settings-card-title",subtitleClassName:"q-settings-card-subtitle",bodyClassName:"q-settings-card-body",children:[e.jsxs("div",{className:"q-toggle-row",children:[e.jsx("p",{className:"q-slider-title",children:"é¡¯ç¤º M"}),e.jsx("button",{type:"button",onClick:()=>j(s=>({...s,showChibi:!s.showChibi})),className:"q-switch",style:{background:h.showChibi?"#a8c4c8":"rgba(120,120,120,0.35)"},"aria-label":"åˆ‡æ›å•å·é  M é¡¯ç¤º",children:e.jsx("span",{className:"q-switch-dot",style:{left:h.showChibi?20:2}})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"q-slider-title",children:"M å¤§å°"}),e.jsxs("p",{className:"q-slider-value",children:["ç›®å‰ï¼š",h.chibiWidth,"px"]}),e.jsx("input",{type:"range",min:104,max:196,step:1,value:h.chibiWidth,onChange:s=>j(a=>({...a,chibiWidth:te(Number(s.target.value),104,196,a.chibiWidth)})),className:"q-slider"})]})]}),e.jsxs(z,{title:"è³‡æ–™ç®¡ç†",subtitle:"å¿«å–èˆ‡è¨­å®š",isOpen:A.data,onToggle:()=>L(s=>({...s,data:!s.data})),className:"q-settings-card",titleClassName:"q-settings-card-title",subtitleClassName:"q-settings-card-subtitle",bodyClassName:"q-settings-card-body",children:[e.jsxs("p",{className:"q-slider-value",children:["å·²å¿«å–å…§å®¹ï¼š",Object.keys(q).length," ä»½"]}),e.jsxs("div",{className:"q-data-actions",children:[e.jsx("button",{type:"button",className:"q-data-btn",onClick:()=>{C({}),D({}),U({kind:"success",message:"å·²æ¸…é™¤å•å·é–±è®€å¿«å–"})},children:"æ¸…é™¤å¿«å–"}),e.jsx("button",{type:"button",className:"q-data-btn",onClick:()=>{j(N),U({kind:"success",message:"å·²é‡è¨­å•å·å°è¨­å®š"})},children:"é‡è¨­è¨­å®š"})]})]})]})]})})]})}export{Ee as QuestionnairePage};
