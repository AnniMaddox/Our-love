import{r as i,j as e,cy as xe,cz as be}from"./index-GkjWVMOE.js";function Ne(r){return`chat-bookmarks-v1-${r}`}function pe(r){try{const o=localStorage.getItem(Ne(r));return o?JSON.parse(o):[]}catch{return[]}}function me(r,o){localStorage.setItem(Ne(r),JSON.stringify(o))}function de(){return{name:"",leftNick:"M",rightNick:"ä½ ",leftAvatarDataUrl:"",rightAvatarDataUrl:""}}function ue(r){return r.trim().toLowerCase()}function $e(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function he(r,o,a){if(!r)return null;const n=ue(r);return n?o.some(u=>ue(u)===n)?"user":a.some(u=>ue(u)===n)?"assistant":null:null}function Ae(r){const o=["content","message","text","body"];for(const a of o){const n=r[a];if(typeof n=="string"&&n.trim())return n.trim()}return""}function Te(r){const o=["timestamp","time","datetime","date"];for(const a of o){const n=r[a];if(typeof n!="string")continue;const u=n.trim();if(!u)continue;const h=new Date(u);return Number.isNaN(h.getTime())?u.replace("T"," ").slice(0,16):`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}-${String(h.getDate()).padStart(2,"0")} ${String(h.getHours()).padStart(2,"0")}:${String(h.getMinutes()).padStart(2,"0")}`}}function fe(r,o){for(const a of o){const n=r.match(new RegExp(`^${$e(a)}\\s*[ï¼š:]\\s*(.*)$`,"i"));if(n)return(n[1]??"").trim()}return null}function De(r,o){const a=xe(o?.leftNick,"M"),n=xe(o?.rightNick,"ä½ "),u=r.trim();if(u.startsWith("[")||u.startsWith("{"))try{const B=JSON.parse(u),N=Array.isArray(B)?B:[B],D=[];for(const $ of N){if(!$||typeof $!="object")continue;const g=$,y=Ae(g);if(!y)continue;let v=null;const C=g.role;if(C==="user"||C==="assistant")v=C;else{const Y=(typeof g.speaker=="string"?g.speaker:void 0)??(typeof g.name=="string"?g.name:void 0)??(typeof g.author=="string"?g.author:void 0)??(typeof g.from=="string"?g.from:void 0);v=he(Y,n,a)}v&&D.push({role:v,content:y,time:Te(g)})}if(D.length>0)return D}catch{}const h=r.split(`
`),s=[];let f=null,x="",k;function j(){f&&x.trim()&&s.push({role:f,content:x.trim(),time:k}),x="",k=void 0}for(const B of h){const N=B.trim();if(!N)continue;const D=N.match(/^\[(\d{4}-\d{2}-\d{2}[\sT]\d{2}:\d{2}(?::\d{2})?)\]/);if(D){k=D[1].replace("T"," ").slice(0,16);continue}const $=N.match(/^ã€(user|assistant)ã€‘\s*(?:\[([^\]]+)\])?(.*)$/i);if($){j(),f=$[1].toLowerCase()==="user"?"user":"assistant",$[2]&&(k=$[2].replace("T"," ").slice(0,16));const C=($[3]??"").trim();C&&(x=C);continue}const g=fe(N,n);if(g!==null){j(),f="user",x=g;continue}const y=fe(N,a);if(y!==null){j(),f="assistant",x=y;continue}const v=N.match(/^ã€([^ã€‘]+)ã€‘\s*(.*)$/);if(v){const C=he(v[1],n,a);C&&(j(),f=C,x=(v[2]??"").trim());continue}x&&(x+=`
`),x+=N}return j(),s}function ge(r){return r.trim().toLowerCase()}function re(r){return r.replace(/\.(txt|md|docx|json)$/i,"")}function ye(r,o){return xe(r,o)[0]??o}function Se(r){const o=r.replace("#",""),a=parseInt(o.length===3?o.split("").map(n=>n+n).join(""):o,16);return[a>>16&255,a>>8&255,a&255]}function ae(r,o=.45){try{const[a,n,u]=Se(r),h=s=>Math.max(0,Math.round(s*(1-o)));return`#${[h(a),h(n),h(u)].map(s=>s.toString(16).padStart(2,"0")).join("")}`}catch{return r}}function Re(r,o){if(r)return{night:!0,bg:"#1c1c1e",barBg:"#1c1c1e",barBorder:"rgba(255,255,255,0.1)",titleColor:"#f2f2f7",subtitleColor:"#8e8e93",btnBg:"#2c2c2e",btnBorder:"rgba(255,255,255,0.12)",btnColor:"#ebebf5",inputBg:"#2c2c2e",inputBorder:"rgba(255,255,255,0.12)",inputText:"#f2f2f7",dividerColor:"rgba(255,255,255,0.08)",listItemHover:"rgba(255,255,255,0.06)",dateLabelColor:"rgba(255,255,255,0.35)",floatBtnBg:"#2c2c2e",floatBtnBorder:"rgba(255,255,255,0.12)",floatBtnColor:"#ebebf5",drawerBg:"#2c2c2e",drawerBorder:"rgba(255,255,255,0.08)",drawerTitleColor:"#f2f2f7",drawerSubColor:"#8e8e93",drawerDivider:"rgba(255,255,255,0.07)",bubbleVarStyle:{"--user-bubble-bg":ae(o.chatUserBubbleColor),"--user-bubble-border":ae(o.chatUserBubbleBorderColor,.35),"--ai-bubble-bg":ae(o.chatAiBubbleColor),"--ai-bubble-border":ae(o.chatAiBubbleBorderColor,.35)}};const a=o.chatBackgroundColor||"#efeff4";return{night:!1,bg:a,barBg:a,barBorder:"rgba(0,0,0,0.1)",titleColor:"#1c1c1e",subtitleColor:"#6b7280",btnBg:"rgba(255,255,255,0.85)",btnBorder:"rgba(0,0,0,0.12)",btnColor:"#374151",inputBg:"rgba(255,255,255,0.85)",inputBorder:"rgba(0,0,0,0.14)",inputText:"#374151",dividerColor:"rgba(0,0,0,0.07)",listItemHover:"rgba(0,0,0,0.04)",dateLabelColor:"rgba(0,0,0,0.35)",floatBtnBg:"rgba(255,255,255,0.92)",floatBtnBorder:"rgba(0,0,0,0.1)",floatBtnColor:"#374151",drawerBg:"#ffffff",drawerBorder:"rgba(0,0,0,0.06)",drawerTitleColor:"#1c1c1e",drawerSubColor:"#6b7280",drawerDivider:"rgba(0,0,0,0.06)",bubbleVarStyle:{}}}const le=["#efeff4","#f6f1e7","#eaf1f6","#f4e9ef","#eef3e6"];function Ie(r,o,a){const n=o.trim();if(!n)return{backgroundColor:r};const u=Math.max(0,Math.min(.9,a/100));return{backgroundColor:r,backgroundImage:`linear-gradient(rgba(255,255,255,${u}), rgba(255,255,255,${u})), url("${n}")`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}function Ue(r,o){return r.trim()||o}function Me(r){const o=r.trim();return o?o.startsWith("data:image/")||o.startsWith("http://")||o.startsWith("https://")||o.startsWith("/")||o.startsWith("./")||o.startsWith("../")||/\.(png|jpe?g|gif|webp|avif|svg)$/i.test(o):!1}function je({icon:r,fallback:o,imageClassName:a="h-6 w-6",textClassName:n="text-2xl leading-none"}){const u=Ue(r,o);return Me(u)?e.jsx("img",{src:u,alt:"",className:`${a} object-contain`}):e.jsx("span",{className:n,children:u})}function K({panelKey:r,openPanel:o,onToggle:a,title:n,subtitle:u,children:h}){const s=o===r;return e.jsxs("section",{className:"overflow-hidden rounded-2xl border border-stone-200 bg-white shadow-sm",children:[e.jsxs("button",{type:"button",onClick:()=>a(r),className:"flex w-full items-center gap-3 px-4 py-3 text-left transition hover:bg-stone-50",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm text-stone-800",children:n}),e.jsx("p",{className:"truncate text-xs text-stone-500",children:u})]}),e.jsx("span",{className:`text-xl leading-none text-stone-400 transition-transform ${s?"rotate-90":""}`,"aria-hidden":"true",children:"â€º"})]}),s&&e.jsx("div",{className:"border-t border-stone-200 p-4",children:h})]})}function Fe({logs:r,chatProfiles:o,settings:a,onSettingChange:n,onImportChatLogFiles:u,onImportChatLogFolderFiles:h,onClearAllChatLogs:s,onDeleteChatLog:f,onSaveChatProfile:x,onDeleteChatProfile:k,onBindLogProfile:j,onExit:B}){const[N,D]=i.useState(""),[$,g]=i.useState(""),[y,v]=i.useState(a.chatAppDefaultProfileId),[C,Y]=i.useState(""),[O,oe]=i.useState("messages"),[T,M]=i.useState("data"),[_,U]=i.useState(a.chatReadBgImageUrl),[W,J]=i.useState(!1),[H,P]=i.useState(de),[L,V]=i.useState(""),[S,R]=i.useState(null),z=i.useMemo(()=>r.find(t=>t.name===N)??null,[r,N]),q=i.useMemo(()=>{const t=ge(C);return t?r.filter(c=>ge(c.name).includes(t)):r},[r,C]),E=i.useMemo(()=>o.find(t=>t.id===y)??o[0]??null,[o,y]),ne=i.useMemo(()=>o.find(t=>t.id===$)??E,[o,$,E]);i.useEffect(()=>{v(a.chatAppDefaultProfileId)},[a.chatAppDefaultProfileId]),i.useEffect(()=>{U(a.chatReadBgImageUrl)},[a.chatReadBgImageUrl]),i.useEffect(()=>{if(z){g(z.profileId??y);return}g("")},[z?.name,z?.profileId,y]),i.useEffect(()=>{!y||o.some(c=>c.id===y)||(v(""),n({chatAppDefaultProfileId:""}))},[o,y,n]),i.useEffect(()=>{if(!L)return;const t=o.find(c=>c.id===L);if(!t){V(""),R(null);return}R({name:t.name,leftNick:t.leftNick,rightNick:t.rightNick,leftAvatarDataUrl:t.leftAvatarDataUrl,rightAvatarDataUrl:t.rightAvatarDataUrl})},[o,L]);const ce=i.useCallback(t=>{D(t)},[]),G=i.useCallback(()=>{if(!r.length)return;const t=r[Math.floor(Math.random()*r.length)];D(t.name)},[r]),Q=a.chatAppShowLabels,ie=ye(E?.leftNick,"Michael"),X=E?`${ye(E.rightNick,"ä½ ")} â™¡`:"ðŸ¥º â¤ï¸",Z=E?.leftAvatarDataUrl||E?.rightAvatarDataUrl,A=a.chatNightMode,d=i.useMemo(()=>Re(A,a),[A,a.chatBackgroundColor,a.chatUserBubbleColor,a.chatUserBubbleBorderColor,a.chatAiBubbleColor,a.chatAiBubbleBorderColor]),l=A?d.barBg:a.chatNavBgColor||d.barBg,b=A?d.barBg:a.chatBodyBgColor||d.barBg,w=i.useMemo(()=>A?{backgroundColor:d.bg}:Ie(a.chatReadBgColor,a.chatReadBgImageUrl,a.chatReadBgOverlay),[A,d.bg,a.chatReadBgColor,a.chatReadBgImageUrl,a.chatReadBgOverlay]);function ee(t){v(t),n({chatAppDefaultProfileId:t})}function te(t,c){n({[t]:c})}function ve(t,c){if(!c)return;const p=new FileReader;p.onload=()=>{const m=typeof p.result=="string"?p.result:"";m&&te(t,m)},p.readAsDataURL(c)}function we(t){if(!t)return;const c=new FileReader;c.onload=()=>{const p=typeof c.result=="string"?c.result:"";p&&(U(p),n({chatReadBgImageUrl:p}))},c.readAsDataURL(t)}function F(t){M(c=>c===t?null:t)}function se(t,c,p){if(!c)return;const m=new FileReader;m.onload=()=>{const I=typeof m.result=="string"?m.result:"";I&&p(Ce=>({...Ce,[t]:I}))},m.readAsDataURL(c)}async function ke(){!H.name.trim()||!await x({...H,id:`profile-${Date.now()}`})||(J(!1),P(de()),be({kind:"success",message:"è§’è‰²è¨­å®šå·²å„²å­˜"}))}async function Be(){!L||!S||!S.name.trim()||!await x({...S,id:L})||(V(""),R(null),be({kind:"success",message:"è§’è‰²è¨­å®šå·²å„²å­˜"}))}return z?e.jsx(Le,{log:z,chatProfiles:o,selectedProfileId:$,selectedProfile:ne,onSelectProfile:t=>{g(t),j?.(z.name,t)},backgroundStyle:w,theme:d,chatReadBgColor:a.chatReadBgColor,chatReadBgImageUrl:a.chatReadBgImageUrl,chatReadBgOverlay:a.chatReadBgOverlay,onChatReadBgChange:n,chatMsgFontSize:a.chatMsgFontSize,chatMsgLineHeight:a.chatMsgLineHeight,chatNavBgColor:a.chatNavBgColor,onBack:()=>D(""),onExit:B}):e.jsxs("div",{className:"mx-auto flex h-full w-full max-w-xl flex-col overflow-hidden",style:{backgroundColor:d.barBg},children:[e.jsx("header",{className:"shrink-0 px-4 pb-3 pt-[max(0.75rem,env(safe-area-inset-top))]",style:{backgroundColor:l,borderBottom:`1px solid ${d.barBorder}`},children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[B?e.jsx("button",{type:"button",onClick:B,className:"h-9 w-9 rounded-full text-xl leading-none transition active:scale-95",style:{background:d.btnBg,border:`1px solid ${d.btnBorder}`,color:d.btnColor},"aria-label":"è¿”å›ž",title:"è¿”å›ž",children:e.jsx("span",{style:{transform:"translateY(-1px)",display:"block"},children:"â€¹"})}):e.jsx("span",{className:"h-9 w-9"}),e.jsx("h1",{className:"font-normal tracking-wide",style:{fontSize:"var(--ui-header-title-size, 17px)",color:d.titleColor},children:O==="messages"?"æ¶ˆæ¯":O==="discover"?"ç™¼ç¾":"æˆ‘"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{type:"button",onClick:()=>n({chatNightMode:!A}),className:"h-9 w-9 rounded-full text-lg leading-none transition active:scale-95",style:{background:A?"#3a3a3c":d.btnBg,border:`1px solid ${d.btnBorder}`,color:A?"#ffd60a":d.btnColor},"aria-label":A?"åˆ‡æ›æ—¥é–“æ¨¡å¼":"åˆ‡æ›å¤œé–“æ¨¡å¼",title:A?"æ—¥é–“æ¨¡å¼":"å¤œé–“æ¨¡å¼",children:A?"â˜€":"â˜½"}),e.jsx("button",{type:"button",onClick:G,disabled:!r.length,className:"h-9 w-9 rounded-full text-xl leading-none transition active:scale-95 disabled:opacity-40",style:{background:d.btnBg,border:`1px solid ${d.btnBorder}`,color:d.btnColor},"aria-label":"éš¨æ©Ÿæ‰“é–‹",title:"éš¨æ©Ÿæ‰“é–‹",children:"ï¼‹"})]})]})}),e.jsxs("main",{className:"min-h-0 flex-1 overflow-y-auto",style:{backgroundColor:b},children:[O==="messages"&&e.jsxs("div",{style:{backgroundColor:b},children:[e.jsxs("button",{type:"button",onClick:G,disabled:!r.length,className:"flex w-full items-center gap-3 px-4 py-3 text-left transition disabled:opacity-40",style:{backgroundColor:"transparent"},children:[Z?e.jsx("img",{src:Z,alt:"",className:"h-14 w-14 rounded-xl object-cover"}):e.jsx("div",{className:"grid h-14 w-14 place-items-center rounded-xl text-2xl",style:{backgroundColor:d.btnBg,color:d.subtitleColor},children:"ðŸ’¬"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate",style:{fontSize:"var(--chat-contact-title-size, 15px)",lineHeight:1.3,color:d.titleColor},children:ie}),e.jsx("p",{className:"mt-0.5 truncate",style:{fontSize:"var(--chat-contact-subtitle-size, 14px)",lineHeight:1.3,color:d.subtitleColor},children:X})]}),e.jsx("span",{style:{color:d.subtitleColor},className:"text-lg",children:"â€º"})]}),e.jsx("div",{className:"mx-4 h-px",style:{backgroundColor:d.dividerColor}}),!r.length&&e.jsx("p",{className:"px-4 py-8 text-center text-sm",style:{color:d.subtitleColor},children:"è«‹å…ˆåˆ°ã€Œæˆ‘ã€åˆ†é åŒ¯å…¥å°è©±ç´€éŒ„"})]}),O==="discover"&&e.jsxs("div",{className:"space-y-3 px-3 py-3",children:[e.jsx("div",{className:"rounded-2xl border border-stone-200 bg-white p-3 shadow-sm",children:e.jsx("input",{type:"search",value:C,onChange:t=>Y(t.target.value),placeholder:"æœå°‹æª”å",className:"w-full rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm text-stone-800 outline-none focus:border-stone-500"})}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-stone-200 bg-white shadow-sm",children:[e.jsx("ul",{className:"divide-y divide-stone-100",children:q.map(t=>e.jsx("li",{children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[e.jsxs("button",{type:"button",onClick:()=>ce(t.name),className:"flex min-w-0 flex-1 items-center justify-between gap-3 rounded-xl px-2 py-2 text-left transition active:bg-stone-100",children:[e.jsx("span",{className:"min-w-0 flex-1 truncate text-sm text-stone-800",children:re(t.name)}),e.jsx("span",{className:"text-xs text-stone-400",children:"â€º"})]}),e.jsx("button",{type:"button",onClick:()=>{window.confirm(`è¦åˆªé™¤é€™ä»½å°è©±ç´€éŒ„å—Žï¼Ÿ

${re(t.name)}`)&&f(t.name)},className:"inline-flex h-8 w-8 items-center justify-center rounded-full border border-rose-200 bg-rose-50 text-sm text-rose-600 transition active:scale-95","aria-label":`åˆªé™¤ ${re(t.name)}`,title:"åˆªé™¤",children:"âœ•"})]})},t.name))}),!q.length&&e.jsx("p",{className:"px-4 py-6 text-center text-sm text-stone-400",children:"æ²’æœ‰ç¬¦åˆçš„ç´€éŒ„"})]})]}),O==="me"&&e.jsxs("div",{className:"space-y-3 px-3 py-3",children:[e.jsxs(K,{panelKey:"nav",openPanel:T,onToggle:F,title:"åº•éƒ¨åˆ†é åœ–ç¤º",subtitle:"å¯è¼¸å…¥ç¬¦è™Ÿ / è²¼åœ–ç‰‡ç¶²å€ / ç›´æŽ¥ä¸Šå‚³åœ–ç‰‡",children:[e.jsx("div",{className:"space-y-2",children:[{label:"æ¶ˆæ¯",field:"chatAppMessagesIcon",value:a.chatAppMessagesIcon,fallback:"ðŸ’¬"},{label:"ç™¼ç¾",field:"chatAppDiscoverIcon",value:a.chatAppDiscoverIcon,fallback:"âœ¨"},{label:"æˆ‘",field:"chatAppMeIcon",value:a.chatAppMeIcon,fallback:"ðŸ‘¤"}].map(t=>e.jsxs("div",{className:"space-y-1.5 rounded-xl border border-stone-200 bg-stone-50 p-2.5",children:[e.jsx("p",{className:"text-xs text-stone-600",children:t.label}),e.jsxs("div",{className:"grid grid-cols-[2.5rem_1fr_auto_auto] items-center gap-2",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl border border-stone-300 bg-white",children:e.jsx(je,{icon:t.value,fallback:t.fallback,imageClassName:"h-6 w-6"})}),e.jsx("input",{type:"text",value:t.value,onChange:c=>te(t.field,c.target.value),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-2 text-sm",placeholder:t.fallback}),e.jsxs("label",{className:"inline-flex h-10 w-10 cursor-pointer items-center justify-center rounded-lg border border-stone-300 bg-white text-sm text-stone-700 transition active:scale-95",children:["â¤´",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:c=>{ve(t.field,c.target.files?.[0]),c.currentTarget.value=""}})]}),e.jsx("button",{type:"button",onClick:()=>te(t.field,""),className:"inline-flex h-10 w-10 items-center justify-center rounded-lg border border-stone-300 bg-white text-sm text-stone-700 transition active:scale-95","aria-label":"é‚„åŽŸ",title:"é‚„åŽŸ",children:"â†º"})]})]},t.field))}),e.jsxs("label",{className:"mt-3 flex items-center justify-between rounded-xl border border-stone-200 bg-stone-50 px-3 py-2 text-sm text-stone-700",children:[e.jsx("span",{children:"é¡¯ç¤ºæ–‡å­—"}),e.jsx("input",{type:"checkbox",checked:a.chatAppShowLabels,onChange:t=>n({chatAppShowLabels:t.target.checked}),className:"h-4 w-4 accent-stone-900"})]}),e.jsxs("label",{className:"mt-2 block space-y-1 rounded-xl border border-stone-200 bg-stone-50 px-3 py-2",children:[e.jsxs("span",{className:"flex items-center justify-between text-xs text-stone-600",children:[e.jsx("span",{children:"è¯çµ¡äººåç¨±å¤§å°"}),e.jsxs("span",{children:[a.chatContactNameSize,"px"]})]}),e.jsx("input",{type:"range",min:11,max:24,step:1,value:a.chatContactNameSize,onChange:t=>n({chatContactNameSize:Number(t.target.value)}),className:"w-full accent-stone-800"})]})]}),e.jsxs(K,{panelKey:"data",openPanel:T,onToggle:F,title:"å°è©±è³‡æ–™",subtitle:`ç›®å‰ ${r.length} ä»½`,children:[e.jsxs("div",{className:"mb-3 flex items-end justify-between gap-3",children:[e.jsx("p",{className:"text-xs text-stone-500",children:"æ”¯æ´ txt / md / json / docx"}),e.jsx("button",{type:"button",onClick:s,disabled:!r.length,className:"rounded-lg border border-rose-200 bg-rose-50 px-2.5 py-1.5 text-xs text-rose-700 disabled:opacity-50",children:"æ¸…ç©º"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"cursor-pointer rounded-xl bg-stone-900 py-2.5 text-center text-sm text-white transition active:opacity-80",children:["åŒ¯å…¥æª”æ¡ˆ",e.jsx("input",{type:"file",multiple:!0,accept:".txt,.md,.json,.docx",className:"hidden",onChange:t=>{const c=t.target.files?Array.from(t.target.files):[];c.length&&u(c),t.currentTarget.value=""}})]}),e.jsxs("label",{className:"cursor-pointer rounded-xl bg-stone-900 py-2.5 text-center text-sm text-white transition active:opacity-80",children:["åŒ¯å…¥è³‡æ–™å¤¾",e.jsx("input",{type:"file",webkitdirectory:"",multiple:!0,accept:".txt,.md,.json,.docx",className:"hidden",onChange:t=>{const c=t.target.files?Array.from(t.target.files):[];c.length&&h(c),t.currentTarget.value=""}})]})]})]}),e.jsx(K,{panelKey:"defaultProfile",openPanel:T,onToggle:F,title:"é è¨­è§’è‰²",subtitle:"æ¶ˆæ¯é é ­åƒ / åç¨±æœƒè·Ÿéš¨é€™çµ„",children:e.jsxs("select",{value:y,onChange:t=>ee(t.target.value),className:"w-full rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm text-stone-700",children:[e.jsx("option",{value:"",children:"é è¨­ï¼ˆä½  / Mï¼‰"}),o.map(t=>e.jsxs("option",{value:t.id,children:[t.name,"ï¼ˆ",t.rightNick," / ",t.leftNick,"ï¼‰"]},t.id))]})}),e.jsx(K,{panelKey:"bubble",openPanel:T,onToggle:F,title:"æ³¡æ³¡å¤–è§€",subtitle:"æ¨£å¼ / åœ“è§’ / é¡è‰²",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n({chatBubbleStyle:"jelly"}),className:`rounded-lg border px-3 py-2 text-sm ${a.chatBubbleStyle==="jelly"?"border-stone-900 bg-stone-900 text-white":"border-stone-300 bg-white text-stone-700"}`,children:"QQ æžœå‡"}),e.jsx("button",{type:"button",onClick:()=>n({chatBubbleStyle:"imessage"}),className:`rounded-lg border px-3 py-2 text-sm ${a.chatBubbleStyle==="imessage"?"border-stone-900 bg-stone-900 text-white":"border-stone-300 bg-white text-stone-700"}`,children:"iMessage"}),e.jsx("button",{type:"button",onClick:()=>n({chatBubbleStyle:"imessageClassic"}),className:`rounded-lg border px-3 py-2 text-sm ${a.chatBubbleStyle==="imessageClassic"?"border-stone-900 bg-stone-900 text-white":"border-stone-300 bg-white text-stone-700"}`,children:"iMessage+"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsxs("span",{className:"flex items-center justify-between text-xs text-stone-600",children:[e.jsx("span",{children:"æ³¡æ³¡åœ“è§’"}),e.jsxs("span",{children:[a.chatBubbleRadius,"px"]})]}),e.jsx("input",{type:"range",min:10,max:36,step:1,value:a.chatBubbleRadius,onChange:t=>n({chatBubbleRadius:Number(t.target.value)}),className:"w-full accent-stone-800"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"æˆ‘æ–¹åº•è‰²"}),e.jsx("input",{type:"color",value:a.chatUserBubbleColor,onChange:t=>n({chatUserBubbleColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"å°æ–¹åº•è‰²"}),e.jsx("input",{type:"color",value:a.chatAiBubbleColor,onChange:t=>n({chatAiBubbleColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"æˆ‘æ–¹é‚Šæ¡†"}),e.jsx("input",{type:"color",value:a.chatUserBubbleBorderColor,onChange:t=>n({chatUserBubbleBorderColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"å°æ–¹é‚Šæ¡†"}),e.jsx("input",{type:"color",value:a.chatAiBubbleBorderColor,onChange:t=>n({chatAiBubbleBorderColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"æˆ‘æ–¹æ–‡å­—"}),e.jsx("input",{type:"color",value:a.chatUserBubbleTextColor,onChange:t=>n({chatUserBubbleTextColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"å°æ–¹æ–‡å­—"}),e.jsx("input",{type:"color",value:a.chatAiBubbleTextColor,onChange:t=>n({chatAiBubbleTextColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]})]})]})}),e.jsx(K,{panelKey:"background",openPanel:T,onToggle:F,title:"é–±è®€èƒŒæ™¯",subtitle:"å°è©±è¦–çª—å°ˆå±¬èƒŒæ™¯ï¼Œä¸å½±éŸ¿é¦–é ",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:le.map(t=>{const c=a.chatReadBgColor.toLowerCase()===t.toLowerCase();return e.jsx("button",{type:"button",onClick:()=>n({chatReadBgColor:t}),className:`h-7 w-7 rounded-full border transition active:scale-95 ${c?"border-stone-900 ring-2 ring-stone-300":"border-stone-300"}`,style:{background:t},"aria-label":`èƒŒæ™¯è‰² ${t}`,title:t},t)})}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"è‡ªè¨‚åº•è‰²"}),e.jsx("input",{type:"color",value:a.chatReadBgColor,onChange:t=>n({chatReadBgColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"èƒŒæ™¯åœ–ç‰‡ URL"}),e.jsx("input",{type:"url",value:_,onChange:t=>U(t.target.value),placeholder:"https://.../chat-bg.jpg",className:"w-full rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm text-stone-700"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n({chatReadBgImageUrl:_.trim()}),className:"rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-700 transition active:scale-[0.99]",children:"å¥—ç”¨åœ–ç‰‡ URL"}),e.jsxs("label",{className:"cursor-pointer rounded-xl border border-stone-300 bg-white py-2 text-center text-sm text-stone-700 transition active:opacity-80",children:["ä¸Šå‚³åœ–ç‰‡",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{we(t.target.files?.[0]),t.currentTarget.value=""}})]})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsxs("span",{className:"flex items-center justify-between text-xs text-stone-600",children:[e.jsx("span",{children:"åœ–ç‰‡é®ç½©"}),e.jsxs("span",{children:[a.chatReadBgOverlay,"%"]})]}),e.jsx("input",{type:"range",min:0,max:90,step:1,value:a.chatReadBgOverlay,onChange:t=>n({chatReadBgOverlay:Number(t.target.value)}),className:"w-full accent-stone-800"})]}),e.jsx("button",{type:"button",onClick:()=>{U(""),n({chatReadBgImageUrl:"",chatReadBgOverlay:0})},className:"w-full rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-700 transition active:scale-[0.99]",children:"ç§»é™¤èƒŒæ™¯åœ–ç‰‡"})]})}),e.jsx(K,{panelKey:"navBar",openPanel:T,onToggle:F,title:"å°Žè¦½åˆ—åº•è‰²",subtitle:"é ‚éƒ¨æ¨™é¡Œåˆ—å’Œåº•éƒ¨åˆ†é åˆ—çš„èƒŒæ™¯è‰²",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:le.map(t=>{const p=(a.chatNavBgColor||d.barBg).toLowerCase()===t.toLowerCase();return e.jsx("button",{type:"button",onClick:()=>n({chatNavBgColor:t}),className:`h-7 w-7 rounded-full border transition active:scale-95 ${p?"border-stone-900 ring-2 ring-stone-300":"border-stone-300"}`,style:{background:t},"aria-label":`å°Žè¦½åˆ—åº•è‰² ${t}`,title:t},t)})}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"è‡ªè¨‚é¡è‰²"}),e.jsx("input",{type:"color",value:a.chatNavBgColor||d.barBg,onChange:t=>n({chatNavBgColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsx("button",{type:"button",onClick:()=>n({chatNavBgColor:""}),className:"w-full rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-700 transition active:scale-[0.99]",children:"é‡è¨­ï¼ˆè·Ÿéš¨ä¸»é¡Œè‰²ï¼‰"})]})}),e.jsx(K,{panelKey:"bodyBg",openPanel:T,onToggle:F,title:"é ç±¤å…§å®¹åº•è‰²",subtitle:"æ¶ˆæ¯ã€ç™¼ç¾ã€æˆ‘ ç­‰é ç±¤çš„èƒŒæ™¯è‰²",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:le.map(t=>{const p=(a.chatBodyBgColor||d.barBg).toLowerCase()===t.toLowerCase();return e.jsx("button",{type:"button",onClick:()=>n({chatBodyBgColor:t}),className:`h-7 w-7 rounded-full border transition active:scale-95 ${p?"border-stone-900 ring-2 ring-stone-300":"border-stone-300"}`,style:{background:t},"aria-label":`å…§å®¹åº•è‰² ${t}`,title:t},t)})}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"è‡ªè¨‚é¡è‰²"}),e.jsx("input",{type:"color",value:a.chatBodyBgColor||d.barBg,onChange:t=>n({chatBodyBgColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsx("button",{type:"button",onClick:()=>n({chatBodyBgColor:""}),className:"w-full rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-700 transition active:scale-[0.99]",children:"é‡è¨­ï¼ˆè·Ÿéš¨ä¸»é¡Œè‰²ï¼‰"})]})}),e.jsx(K,{panelKey:"profiles",openPanel:T,onToggle:F,title:"èŠå¤©è§’è‰²è¨­å®šï¼ˆæ´—è§’è‰²åç¨±ï¼‰",subtitle:`å…± ${o.length} çµ„`,children:e.jsxs("div",{className:"space-y-3",children:[o.length===0&&e.jsx("p",{className:"text-xs text-stone-400",children:"å°šæœªå»ºç«‹è§’è‰²è¨­å®šï¼Œé è¨­ç‚ºã€Œä½ ã€/ã€ŒMã€ã€‚"}),e.jsx("div",{className:"space-y-2",children:o.map(t=>{const c=L===t.id&&!!S;return e.jsx("div",{className:"rounded-lg border border-stone-200 bg-stone-50 p-3",children:c?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:S.name,onChange:p=>R(m=>m&&{...m,name:p.target.value}),placeholder:"è¨­å®šåç¨±",className:"w-full rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{type:"text",value:S.rightNick,onChange:p=>R(m=>m&&{...m,rightNick:p.target.value}),placeholder:"å³å´æš±ç¨±ï¼ˆå¯ / åˆ†éš”ï¼‰",className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"}),e.jsx("input",{type:"text",value:S.leftNick,onChange:p=>R(m=>m&&{...m,leftNick:p.target.value}),placeholder:"å·¦å´æš±ç¨±ï¼ˆå¯ / åˆ†éš”ï¼‰",className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"å³å´é ­åƒ"}),e.jsx("input",{type:"file",accept:"image/*",onChange:p=>se("rightAvatarDataUrl",p.target.files?.[0],m=>R(I=>I&&m(I))),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs"})]}),e.jsxs("label",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"å·¦å´é ­åƒ"}),e.jsx("input",{type:"file",accept:"image/*",onChange:p=>se("leftAvatarDataUrl",p.target.files?.[0],m=>R(I=>I&&m(I))),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{Be()},className:"flex-1 rounded-xl bg-stone-900 py-2 text-sm text-white",children:"å„²å­˜"}),e.jsx("button",{type:"button",onClick:()=>{V(""),R(null)},className:"flex-1 rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-600",children:"å–æ¶ˆ"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm text-stone-800",children:t.name}),e.jsxs("p",{className:"text-xs text-stone-400",children:["å³ï¼š",t.rightNick," ï¼ å·¦ï¼š",t.leftNick]})]}),e.jsx("button",{type:"button",onClick:()=>{V(t.id),R({name:t.name,leftNick:t.leftNick,rightNick:t.rightNick,leftAvatarDataUrl:t.leftAvatarDataUrl,rightAvatarDataUrl:t.rightAvatarDataUrl})},className:"rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs text-stone-700",children:"ç·¨è¼¯"}),e.jsx("button",{type:"button",onClick:()=>k(t.id),className:"rounded-lg border border-rose-200 bg-rose-50 px-2 py-1 text-xs text-rose-600",children:"åˆªé™¤"})]})},t.id)})}),W?e.jsxs("div",{className:"space-y-2 rounded-lg border border-violet-200 bg-violet-50 p-3",children:[e.jsx("input",{type:"text",placeholder:"è¨­å®šåç¨±ï¼Œä¾‹ï¼šå’Œ4oçš„å°è©±",value:H.name,onChange:t=>P(c=>({...c,name:t.target.value})),className:"w-full rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{type:"text",placeholder:"å³å´æš±ç¨±ï¼ˆå¯ / åˆ†éš”ï¼‰",value:H.rightNick,onChange:t=>P(c=>({...c,rightNick:t.target.value})),className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"}),e.jsx("input",{type:"text",placeholder:"å·¦å´æš±ç¨±ï¼ˆå¯ / åˆ†éš”ï¼‰",value:H.leftNick,onChange:t=>P(c=>({...c,leftNick:t.target.value})),className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"å³å´é ­åƒ"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>se("rightAvatarDataUrl",t.target.files?.[0],P),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs"})]}),e.jsxs("label",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"å·¦å´é ­åƒ"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>se("leftAvatarDataUrl",t.target.files?.[0],P),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{ke()},className:"flex-1 rounded-xl bg-stone-900 py-2 text-sm text-white",children:"å„²å­˜"}),e.jsx("button",{type:"button",onClick:()=>{J(!1),P(de())},className:"flex-1 rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-600",children:"å–æ¶ˆ"})]})]}):e.jsx("button",{type:"button",onClick:()=>J(!0),className:"w-full rounded-xl border border-violet-200 bg-violet-50 py-2 text-sm text-violet-700",children:"ï¼‹ æ–°å¢žè§’è‰²è¨­å®š"})]})})]})]}),e.jsx("nav",{className:"shrink-0 px-5 pb-[max(1.25rem,env(safe-area-inset-bottom))] pt-2.5",style:{backgroundColor:l,borderTop:`1px solid ${d.barBorder}`},children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{tab:"messages",icon:a.chatAppMessagesIcon,fallback:"ðŸ’¬",label:"æ¶ˆæ¯"},{tab:"discover",icon:a.chatAppDiscoverIcon,fallback:"âœ¨",label:"ç™¼ç¾"},{tab:"me",icon:a.chatAppMeIcon,fallback:"ðŸ‘¤",label:"æˆ‘"}].map(({tab:t,icon:c,fallback:p,label:m})=>{const I=O===t;return e.jsxs("button",{type:"button",onClick:()=>oe(t),className:`flex flex-col items-center rounded-xl px-2 py-1.5 transition ${Q?"gap-1 text-xs":"gap-0 text-base"}`,style:{color:I?d.titleColor:d.subtitleColor},"aria-label":m,children:[e.jsx(je,{icon:c,fallback:p,imageClassName:"h-6 w-6",textClassName:"text-2xl leading-none"}),Q&&e.jsx("span",{children:m})]},t)})})})]})}function Le({log:r,chatProfiles:o,selectedProfileId:a,selectedProfile:n,onSelectProfile:u,backgroundStyle:h,theme:s,chatReadBgColor:f,chatReadBgImageUrl:x,chatReadBgOverlay:k,onChatReadBgChange:j,chatMsgFontSize:B,chatMsgLineHeight:N,chatNavBgColor:D,onBack:$,onExit:g}){const y=i.useRef(null),v=i.useRef(null),C=s.night?s.barBg:D||s.barBg,[Y,O]=i.useState(!1),[oe,T]=i.useState(!1),[M,_]=i.useState(()=>pe(r.name)),[U,W]=i.useState(null),[J,H]=i.useState(""),[P,L]=i.useState(!1),[V,S]=i.useState(x);i.useEffect(()=>{S(x)},[x]);function R(l){if(!l)return;const b=new FileReader;b.onload=()=>{const w=typeof b.result=="string"?b.result:"";w&&(S(w),j({chatReadBgImageUrl:w}))},b.readAsDataURL(l)}const z=re(r.name),q=i.useMemo(()=>De(r.content,n),[r.content,n]);i.useEffect(()=>{const l=y.current;l&&l.scrollTo({top:l.scrollHeight})},[r.name,a]),i.useEffect(()=>{_(pe(r.name))},[r.name]);function E(){y.current?.scrollTo({top:0,behavior:"smooth"})}function ne(){const l=y.current;l&&l.scrollTo({top:l.scrollHeight,behavior:"smooth"})}function ce(l){const b=y.current;if(!b)return;const w=b.querySelector(`[data-msg-index="${l}"]`);w&&w.scrollIntoView({behavior:"smooth",block:"center"})}function G(){const l=y.current;if(!l)return 0;const b=l.getBoundingClientRect().top,w=l.querySelectorAll("[data-msg-index]");for(const ee of w)if(ee.getBoundingClientRect().bottom>b+60)return Number(ee.getAttribute("data-msg-index")??"0");return 0}function Q(l,b){W({index:l,preview:b}),H("")}function ie(){const l=G(),b=q[l],w=b?b.content.slice(0,50):"";Q(l,w)}function X(){if(!U)return;const l=J.trim()||U.preview.slice(0,20)||`æ›¸ç±¤ ${M.length+1}`,b={id:`bm-${Date.now()}`,messageIndex:U.index,label:l,preview:U.preview,createdAt:new Date().toISOString()},w=[...M,b];_(w),me(r.name,w),W(null),be({kind:"success",message:"æ›¸ç±¤å·²æ–°å¢ž"})}function Z(l){const b=M.filter(w=>w.id!==l);_(b),me(r.name,b)}function A(l,b){v.current=setTimeout(()=>{Q(l,b)},500)}function d(){v.current&&(clearTimeout(v.current),v.current=null)}return e.jsxs("div",{className:"relative mx-auto flex h-full w-full max-w-xl flex-col overflow-hidden",style:h,children:[e.jsx("div",{className:"shrink-0 px-3 pb-2 pt-[max(0.75rem,env(safe-area-inset-top))]",style:{backgroundColor:C,borderBottom:`1px solid ${s.barBorder}`},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:$,className:"h-9 w-9 shrink-0 rounded-full text-xl leading-none transition active:scale-95",style:{background:s.btnBg,border:`1px solid ${s.btnBorder}`,color:s.btnColor},"aria-label":"è¿”å›ž",children:e.jsx("span",{style:{transform:"translateY(-1px)",display:"block"},children:"â€¹"})}),e.jsx("p",{className:"min-w-0 flex-1 truncate text-center text-sm font-medium",style:{color:s.titleColor},children:z}),e.jsx("button",{type:"button",onClick:()=>L(!0),className:"shrink-0 text-lg leading-none",style:{animation:"chatHeartBounce 1.8s ease-in-out infinite"},"aria-label":"é–±è®€è¨­å®š",title:"é–±è®€è¨­å®š",children:"ðŸ’—"}),g?e.jsx("button",{type:"button",onClick:g,className:"h-9 w-9 shrink-0 rounded-full text-xl leading-none transition active:scale-95",style:{background:s.btnBg,border:`1px solid ${s.btnBorder}`,color:s.btnColor},"aria-label":"é›¢é–‹",children:e.jsx("span",{style:{transform:"translateY(-1px)",display:"block"},children:"Ã—"})}):e.jsx("span",{className:"h-9 w-9 shrink-0"})]})}),e.jsx("div",{ref:y,id:"chat-messages",className:"min-h-0 flex-1 overflow-y-auto px-3 py-3",style:s.bubbleVarStyle,children:q.length>0?e.jsx(Oe,{messages:q,profile:n,dateLabelColor:s.dateLabelColor,fontSize:B,lineHeight:N,onPressStart:A,onPressEnd:d}):e.jsxs("p",{className:"rounded-2xl px-3 py-4 text-sm",style:{border:`1px solid ${s.barBorder}`,backgroundColor:s.btnBg,color:s.subtitleColor},children:["ç„¡æ³•è§£æžç‚ºèŠå¤©æ ¼å¼ï¼Œä»¥ä¸‹æ˜¯åŽŸæ–‡ï¼š",e.jsx("span",{className:"mt-2 block whitespace-pre-wrap rounded-xl p-3 text-left text-xs",style:{border:`1px solid ${s.barBorder}`,backgroundColor:s.inputBg,color:s.inputText},children:r.content})]})}),Y&&e.jsxs("div",{className:"pointer-events-none absolute bottom-24 right-4 z-10 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:E,className:"pointer-events-auto flex h-11 w-11 items-center justify-center rounded-full shadow-md transition active:scale-95",style:{background:s.floatBtnBg,border:`1px solid ${s.floatBtnBorder}`,color:s.floatBtnColor},"aria-label":"å›žåˆ°é ‚éƒ¨",children:e.jsx(Pe,{})}),e.jsx("button",{type:"button",onClick:ne,className:"pointer-events-auto flex h-11 w-11 items-center justify-center rounded-full shadow-md transition active:scale-95",style:{background:s.floatBtnBg,border:`1px solid ${s.floatBtnBorder}`,color:s.floatBtnColor},"aria-label":"å›žåˆ°åº•éƒ¨",children:e.jsx(ze,{})})]}),e.jsx("div",{className:"shrink-0 px-5 pb-[max(1.25rem,env(safe-area-inset-bottom))] pt-3",style:{backgroundColor:C,borderTop:`1px solid ${s.barBorder}`},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:ie,className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-xl transition active:scale-95",style:{background:s.btnBg,border:`1px solid ${s.btnBorder}`,color:s.btnColor},"aria-label":"æ–°å¢žæ›¸ç±¤",title:"æ–°å¢žæ›¸ç±¤ï¼ˆç•¶å‰ä½ç½®ï¼‰",children:e.jsx("span",{style:{transform:"translateY(-1px)",display:"block"},children:"+"})}),e.jsxs("button",{type:"button",onClick:()=>T(!0),className:"relative flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-xl transition active:scale-95",style:{background:s.btnBg,border:`1px solid ${s.btnBorder}`},"aria-label":"æ›¸ç±¤æ¸…å–®",children:["ðŸ”–",M.length>0&&e.jsx("span",{className:"absolute -right-0.5 -top-0.5 flex h-4 w-4 items-center justify-center rounded-full bg-rose-500 text-[10px] font-bold text-white",children:M.length>9?"9+":M.length})]}),e.jsx("div",{className:"relative min-w-0 flex-1",children:o.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:a,onChange:l=>u(l.target.value),className:"h-10 w-full appearance-none rounded-full pl-4 pr-8 text-sm",style:{background:s.inputBg,border:`1px solid ${s.inputBorder}`,color:s.inputText},children:[e.jsx("option",{value:"",children:"è§’è‰²é è¨­"}),o.map(l=>e.jsxs("option",{value:l.id,children:[l.name,"ï¼ˆ",l.rightNick," / ",l.leftNick,"ï¼‰"]},l.id))]}),e.jsx("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-xs",style:{color:s.subtitleColor},children:"â–¾"})]}):e.jsx("div",{className:"h-10 rounded-full px-4 text-sm leading-10",style:{background:s.inputBg,border:`1px solid ${s.inputBorder}`,color:s.subtitleColor},children:"å°šæœªå»ºç«‹è§’è‰²è¨­å®š"})}),e.jsx("button",{type:"button",onClick:()=>O(l=>!l),className:`flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-white shadow-sm transition active:scale-95 ${Y?"bg-blue-600":"bg-blue-500"}`,"aria-label":"å¿«é€Ÿå°Žèˆªé–‹é—œ",children:e.jsx(Ee,{})})]})}),oe&&e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col justify-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>T(!1)}),e.jsxs("div",{className:"relative z-10 flex max-h-[70%] flex-col rounded-t-3xl shadow-xl",style:{background:s.drawerBg},children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between px-5 pb-3 pt-4",style:{borderBottom:`1px solid ${s.drawerDivider}`},children:[e.jsx("h2",{className:"text-base font-medium",style:{color:s.drawerTitleColor},children:"æ›¸ç±¤"}),e.jsx("button",{type:"button",onClick:()=>T(!1),className:"flex h-7 w-7 items-center justify-center rounded-full text-sm",style:{background:s.btnBg,color:s.btnColor},children:e.jsx("span",{style:{transform:"translateY(-1px)",display:"block"},children:"Ã—"})})]}),e.jsx("div",{className:"min-h-0 flex-1 overflow-y-auto pb-[max(1.25rem,env(safe-area-inset-bottom))]",children:M.length===0?e.jsxs("p",{className:"px-5 py-10 text-center text-sm",style:{color:s.drawerSubColor},children:["é‚„æ²’æœ‰æ›¸ç±¤",e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"é•·æŒ‰è¨Šæ¯æ³¡æ³¡ æˆ– é»ž + å¯æ–°å¢ž"})]}):e.jsx("ul",{children:M.map(l=>e.jsxs("li",{className:"flex items-center gap-3 px-5 py-3",style:{borderBottom:`1px solid ${s.drawerDivider}`},children:[e.jsxs("button",{type:"button",onClick:()=>{ce(l.messageIndex),T(!1)},className:"min-w-0 flex-1 text-left",children:[e.jsx("p",{className:"truncate text-sm",style:{color:s.drawerTitleColor},children:l.label}),e.jsx("p",{className:"mt-0.5 truncate text-xs",style:{color:s.drawerSubColor},children:l.preview})]}),e.jsx("button",{type:"button",onClick:()=>Z(l.id),className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full border border-rose-200 bg-rose-50 text-xs text-rose-500","aria-label":"åˆªé™¤æ›¸ç±¤",children:"âœ•"})]},l.id))})})]})]}),P&&e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col justify-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>L(!1)}),e.jsxs("div",{className:"relative z-10 flex max-h-[80%] flex-col rounded-t-3xl shadow-xl",style:{background:s.drawerBg},children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between px-5 pb-3 pt-4",style:{borderBottom:`1px solid ${s.drawerDivider}`},children:[e.jsx("h2",{className:"text-base font-medium",style:{color:s.drawerTitleColor},children:"é–±è®€èƒŒæ™¯"}),e.jsx("button",{type:"button",onClick:()=>L(!1),className:"flex h-7 w-7 items-center justify-center rounded-full text-sm",style:{background:s.btnBg,color:s.btnColor},children:e.jsx("span",{style:{transform:"translateY(-1px)",display:"block"},children:"Ã—"})})]}),e.jsx("div",{className:"min-h-0 flex-1 overflow-y-auto px-5 pb-[max(1.25rem,env(safe-area-inset-bottom))] pt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-medium",style:{color:s.drawerTitleColor},children:"æ–‡å­—"}),e.jsxs("label",{className:"block space-y-1",children:[e.jsxs("span",{className:"flex items-center justify-between text-xs",style:{color:s.drawerSubColor},children:[e.jsx("span",{children:"å­—é«”å¤§å°"}),e.jsxs("span",{children:[B,"px"]})]}),e.jsx("input",{type:"range",min:11,max:22,step:1,value:B,onChange:l=>j({chatMsgFontSize:Number(l.target.value)}),className:"w-full accent-rose-400"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsxs("span",{className:"flex items-center justify-between text-xs",style:{color:s.drawerSubColor},children:[e.jsx("span",{children:"è¡Œè·"}),e.jsx("span",{children:N.toFixed(2)})]}),e.jsx("input",{type:"range",min:1.2,max:2.4,step:.05,value:N,onChange:l=>j({chatMsgLineHeight:Number(l.target.value)}),className:"w-full accent-rose-400"})]})]}),e.jsx("div",{className:"h-px",style:{background:s.drawerDivider}}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs font-medium",style:{color:s.drawerTitleColor},children:"é–±è®€èƒŒæ™¯"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:le.map(l=>{const b=f.toLowerCase()===l.toLowerCase();return e.jsx("button",{type:"button",onClick:()=>j({chatReadBgColor:l}),className:`h-8 w-8 rounded-full border-2 transition active:scale-95 ${b?"border-rose-400 ring-2 ring-rose-200":"border-stone-300"}`,style:{background:l},"aria-label":`èƒŒæ™¯è‰² ${l}`,title:l},l)})}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs",style:{color:s.drawerSubColor},children:"è‡ªè¨‚åº•è‰²"}),e.jsx("input",{type:"color",value:f,onChange:l=>j({chatReadBgColor:l.target.value}),className:"h-10 w-full rounded-md border",style:{borderColor:s.drawerDivider}})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs",style:{color:s.drawerSubColor},children:"èƒŒæ™¯åœ–ç‰‡ URL"}),e.jsx("input",{type:"url",value:V,onChange:l=>S(l.target.value),placeholder:"https://.../bg.jpg",className:"w-full rounded-xl px-3 py-2 text-sm outline-none",style:{background:s.inputBg,border:`1px solid ${s.inputBorder}`,color:s.inputText}})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>j({chatReadBgImageUrl:V.trim()}),className:"rounded-xl py-2.5 text-sm transition active:scale-[0.99]",style:{background:s.btnBg,border:`1px solid ${s.btnBorder}`,color:s.btnColor},children:"å¥—ç”¨ URL"}),e.jsxs("label",{className:"flex cursor-pointer items-center justify-center rounded-xl py-2.5 text-sm transition active:opacity-80",style:{background:s.btnBg,border:`1px solid ${s.btnBorder}`,color:s.btnColor},children:["å¾žæœ¬æ©Ÿä¸Šå‚³",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:l=>{R(l.target.files?.[0]),l.currentTarget.value=""}})]})]}),x&&e.jsxs("label",{className:"block space-y-1",children:[e.jsxs("span",{className:"flex items-center justify-between text-xs",style:{color:s.drawerSubColor},children:[e.jsx("span",{children:"åœ–ç‰‡é®ç½©"}),e.jsxs("span",{children:[k,"%"]})]}),e.jsx("input",{type:"range",min:0,max:90,step:1,value:k,onChange:l=>j({chatReadBgOverlay:Number(l.target.value)}),className:"w-full accent-rose-400"})]}),x&&e.jsx("button",{type:"button",onClick:()=>{S(""),j({chatReadBgImageUrl:"",chatReadBgOverlay:0})},className:"w-full rounded-xl py-2.5 text-sm text-rose-500 transition active:scale-[0.99]",style:{background:s.btnBg,border:`1px solid ${s.drawerDivider}`},children:"ç§»é™¤èƒŒæ™¯åœ–ç‰‡"})]})]})})]})]}),U&&e.jsxs("div",{className:"absolute inset-0 z-30 flex items-center justify-center px-6",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>W(null)}),e.jsxs("div",{className:"relative z-10 w-full max-w-sm rounded-2xl p-5 shadow-xl",style:{background:s.drawerBg},children:[e.jsx("h2",{className:"mb-1 text-base font-medium",style:{color:s.drawerTitleColor},children:"æ–°å¢žæ›¸ç±¤"}),e.jsx("p",{className:"mb-3 truncate text-xs",style:{color:s.drawerSubColor},children:U.preview}),e.jsx("input",{type:"text",value:J,onChange:l=>H(l.target.value),onKeyDown:l=>{l.key==="Enter"&&X(),l.key==="Escape"&&W(null)},placeholder:"æ›¸ç±¤åç¨±ï¼ˆå¯ç•™ç©ºï¼‰",className:"mb-3 w-full rounded-xl px-4 py-2.5 text-sm outline-none",style:{background:s.inputBg,border:`1px solid ${s.inputBorder}`,color:s.inputText},autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:X,className:"flex-1 rounded-xl py-2.5 text-sm text-white transition active:opacity-80",style:{background:s.night?"#3a3a3c":"#1c1c1e"},children:"æ–°å¢ž"}),e.jsx("button",{type:"button",onClick:()=>W(null),className:"flex-1 rounded-xl py-2.5 text-sm transition active:opacity-80",style:{background:s.btnBg,border:`1px solid ${s.btnBorder}`,color:s.btnColor},children:"å–æ¶ˆ"})]})]})]})]})}function Pe(){return e.jsx("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"2.5,10.5 7.5,4.5 12.5,10.5"})})}function ze(){return e.jsx("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"2.5,4.5 7.5,10.5 12.5,4.5"})})}function Ee(){return e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})})}function Oe({messages:r,profile:o,dateLabelColor:a,fontSize:n,lineHeight:u,onPressStart:h,onPressEnd:s}){return e.jsx("div",{className:"flex flex-col gap-1.5",children:r.map((f,x)=>{const k=f.role==="user",j=k?o?.rightAvatarDataUrl:o?.leftAvatarDataUrl,B=f.content.slice(0,50),N=f.time&&(x===0||r[x-1]?.time?.slice(0,10)!==f.time.slice(0,10))?f.time.slice(0,10):null;return e.jsxs("div",{"data-msg-index":x,children:[N&&e.jsx("div",{className:"my-3 text-center text-[11px]",style:a?{color:a}:void 0,children:N}),e.jsxs("div",{className:`flex items-end gap-2 ${k?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:"mb-4 shrink-0",children:j?e.jsx("img",{src:j,alt:"",className:"h-8 w-8 rounded-full object-cover"}):e.jsx("div",{className:`grid h-8 w-8 place-items-center rounded-full text-xs font-medium text-white ${k?"bg-emerald-400":"bg-sky-300"}`,children:k?o?.rightNick?.[0]??"ä½ ":o?.leftNick?.[0]??"M"})}),e.jsxs("div",{className:`flex max-w-[75%] flex-col gap-0.5 ${k?"items-end":"items-start"}`,children:[e.jsx("div",{className:`message-bubble ${k?"user":"ai"}`,onMouseDown:()=>h?.(x,B),onMouseUp:()=>s?.(),onMouseLeave:()=>s?.(),onTouchStart:()=>h?.(x,B),onTouchEnd:()=>s?.(),onTouchCancel:()=>s?.(),children:e.jsx("div",{className:"content",style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:n?`${n}px`:void 0,lineHeight:u??void 0},children:f.content})}),f.time&&e.jsx("p",{className:"px-1 text-[10px]",style:a?{color:a}:void 0,children:f.time.slice(11,16)})]})]})]},`${x}-${f.time??""}`)})})}export{Fe as ChatLogPage};
