import{r as c,fi as y,g as Le,fj as j,fk as je,j as e,fl as Z,fm as Ne,fn as ae,fo as Ue,fp as Ge,fq as Je,cz as we}from"./index-Gl0K_ej6.js";import{S as ve}from"./SettingsAccordion-Bl2j_4OS.js";const Ce="memorial-soulmate-page-title-v1",Ie="memorial-soulmate-reader-prefs-v1",V="å®¶",E={paperKey:"lined",textColorKey:"ink",fontSize:16,lineHeight:1.95,showChibi:!0,chibiSize:136,chibiX:0,chibiY:0};function We(i){return i.length?i[Math.floor(Math.random()*i.length)]:null}function O(i,l,o,p){return Number.isFinite(i)?Math.max(l,Math.min(o,i)):p}function Ee(i){const l=i??{},o=l.fontKey,p=o==="mono"?"plain":o==="sans"?"soft":o==="serif"?"lined":null;return{paperKey:l.paperKey==="lined"||l.paperKey==="soft"||l.paperKey==="plain"||l.paperKey==="petal"||l.paperKey==="mist"?l.paperKey:p??"lined",textColorKey:l.textColorKey==="ink"||l.textColorKey==="brown"||l.textColorKey==="slate"||l.textColorKey==="forest"||l.textColorKey==="rose"||l.textColorKey==="navy"?l.textColorKey:"ink",fontSize:Math.round(O(l.fontSize??NaN,13,24,E.fontSize)),lineHeight:Number(O(l.lineHeight??NaN,1.45,2.6,E.lineHeight).toFixed(2)),showChibi:l.showChibi!==!1,chibiSize:Math.round(O(l.chibiSize??NaN,104,196,E.chibiSize)),chibiX:Math.round(O(l.chibiX??NaN,-96,96,E.chibiX)),chibiY:Math.round(O(l.chibiY??NaN,-96,96,E.chibiY))}}function qe(){return typeof window>"u"?V:(window.localStorage.getItem(Ce)??"").trim()||V}function Ze(){if(typeof window>"u")return E;try{const i=window.localStorage.getItem(Ie);if(!i)return E;const l=JSON.parse(i);return Ee(l)}catch{return E}}function Qe(i){return i==="brown"?"#5f4330":i==="slate"?"#374151":i==="forest"?"#2f5544":i==="rose"?"#7a4755":i==="navy"?"#324a68":"#3f3327"}function Ve(i){return i==="petal"?{className:"border-[#e6cfd3]/85 bg-[#fff4f1]",style:{backgroundImage:"radial-gradient(circle at 12% 18%, rgba(242, 193, 201, 0.24) 0, rgba(242, 193, 201, 0) 42%), radial-gradient(circle at 88% 84%, rgba(240, 206, 177, 0.2) 0, rgba(240, 206, 177, 0) 38%)"}}:i==="mist"?{className:"border-[#cfdde7]/85 bg-[#f3f9ff]",style:{backgroundImage:"linear-gradient(165deg, rgba(255, 255, 255, 0.72) 0%, rgba(227, 239, 252, 0.72) 100%), repeating-linear-gradient(to bottom, rgba(105, 136, 172, 0.08) 0, rgba(105, 136, 172, 0.08) 1px, transparent 1px, transparent 30px)",backgroundPosition:"0 0, 0 16px",backgroundSize:"100% 100%, 100% 31px"}}:i==="soft"?{className:"border-stone-200/80 bg-white",style:{}}:i==="plain"?{className:"border-[#d9c9af]/85 bg-[#f3e8d7]",style:{}}:{className:"border-amber-200/80 bg-[#fff8e8]",style:{backgroundImage:"repeating-linear-gradient(to bottom, rgba(176, 136, 74, 0.2) 0, rgba(176, 136, 74, 0.2) 1px, transparent 1px, transparent 29px)",backgroundPosition:"0 16px",backgroundSize:"100% 30px"}}}function ke(i="soulmate"){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?`${i}-${crypto.randomUUID()}`:`${i}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`}function I(i){return i===y||i===j}function re(i,l){const o=/^#[0-9a-fA-F]{6}$/.test(i)?i:"#d6d3d1",p=parseInt(o.slice(1,3),16),u=parseInt(o.slice(3,5),16),R=parseInt(o.slice(5,7),16);return`rgba(${p},${u},${R},${l})`}function et(i){return i.replace(/<style[\s\S]*?<\/style>/gi," ").replace(/<script[\s\S]*?<\/script>/gi," ").replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim()}function tt(i){const l=i.content.trim()||et(i.htmlContent);return l?l.length>56?`${l.slice(0,56)}...`:l:"ï¼ˆæ²’æœ‰å…§å®¹ï¼‰"}function st(i){const l=new Date(i);if(Number.isNaN(l.getTime()))return"æœªçŸ¥æ™‚é–“";const o=l.getFullYear(),p=String(l.getMonth()+1).padStart(2,"0"),u=String(l.getDate()).padStart(2,"0");return`${o}/${p}/${u}`}function Q(i){return i.slice().sort((l,o)=>l.order-o.order).map((l,o)=>({...l,order:o}))}function Se(i,l){const o=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),p=URL.createObjectURL(o),u=document.createElement("a");u.href=p,u.download=i,u.click(),URL.revokeObjectURL(p)}function K({title:i,description:l,isOpen:o,onToggle:p,children:u}){return e.jsxs("section",{className:"rounded-2xl border border-stone-200/80 bg-white/78 p-3.5 shadow-sm",children:[e.jsxs("button",{type:"button",onClick:p,className:"flex w-full items-center justify-between gap-2 text-left",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-stone-800",children:i}),e.jsx("p",{className:"mt-0.5 text-xs text-stone-500",children:l})]}),e.jsx("span",{className:`text-lg text-stone-500 transition-transform ${o?"rotate-180":""}`,children:"âŒ„"})]}),o?e.jsx("div",{className:"mt-3",children:u}):null]})}function rt({onExit:i,soulmateFontFamily:l=""}){const[o,p]=c.useState("shelf"),[u,R]=c.useState({boxes:[],entries:[]}),[b,w]=c.useState([]),[ie,le]=c.useState(()=>qe()),[x,$e]=c.useState(()=>Ze()),[Te,T]=c.useState(!1),[_,ee]=c.useState(y),[X,Y]=c.useState(null),[B,L]=c.useState(y),[A,U]=c.useState(y),[M,G]=c.useState([]),[P,Be]=c.useState({page:!0,boxes:!0,directImport:!0,batchImport:!1,backup:!1}),[oe,ce]=c.useState({reading:!1,chibi:!1}),[Me,Re]=c.useState(!0),[de,v]=c.useState(!1),[J,m]=c.useState(""),[xe]=c.useState(()=>We(Le("mdiary"))??""),W=c.useRef(null),F=u.boxes,k=u.entries,$=ie.trim()||V,pe=l||"'Iansui', 'Klee One', 'Noto Serif TC', 'PingFang TC', serif",Ae=Qe(x.textColorKey),ue=Ve(x.paperKey),q=!x.showChibi||!xe,g=c.useMemo(()=>F.filter(t=>t.id!==j),[F]),Pe=c.useMemo(()=>{const t=new Map;for(const n of k)t.set(n.boxId,(t.get(n.boxId)??0)+1);return t},[k]),h=c.useMemo(()=>g.find(t=>t.id===_)??g[0]??null,[g,_]),N=c.useMemo(()=>h?k.filter(t=>t.boxId===h.id):[],[k,h]),S=c.useMemo(()=>k.find(t=>t.id===X)??null,[k,X]),D=c.useMemo(()=>N.findIndex(t=>t.id===X),[N,X]),me=t=>t.find(n=>n.id!==j)?.id??y,te=async()=>{const t=await je();return R(t),w(t.boxes),t},Fe=async(t,n)=>{v(!0);try{await ae(t);const s=await te(),r=me(s.boxes);L(d=>s.boxes.some(a=>a.id===d&&a.id!==j)?d:r),U(d=>s.boxes.some(a=>a.id===d&&a.id!==j)?d:r),m(n),we({kind:"success",message:n})}catch(s){const r=`å„²å­˜å¤±æ•—ï¼š${s instanceof Error?s.message:"æœªçŸ¥éŒ¯èª¤"}`;m(r),we({kind:"error",message:r})}finally{v(!1)}};c.useEffect(()=>{let t=!0;return(async()=>{try{const n=await je();if(!t)return;const s=me(n.boxes);R(n),w(n.boxes),ee(s),L(s),U(s)}catch(n){if(!t)return;m(`è®€å–å¤±æ•—ï¼š${n instanceof Error?n.message:"æœªçŸ¥éŒ¯èª¤"}`)}finally{t&&Re(!1)}})(),()=>{t=!1}},[]),c.useEffect(()=>{if(!g.length)return;const t=g[0].id;g.some(n=>n.id===_)||ee(t),g.some(n=>n.id===B)||L(t),g.some(n=>n.id===A)||U(t)},[g,_,B,A]),c.useEffect(()=>{o==="manage"&&w(u.boxes)},[o,u.boxes]),c.useEffect(()=>{o==="box"&&!h&&p("shelf")},[o,h]),c.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Ce,$)},[$]),c.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Ie,JSON.stringify(x))},[x]),c.useEffect(()=>{o==="manage"&&T(!1)},[o]),c.useEffect(()=>{if(o==="entry"){if(!N.length){p("box"),Y(null);return}(!S||S.boxId!==h?.id)&&Y(N[0]?.id??null)}},[o,N,S,h]);const z=t=>{Be(n=>({...n,[t]:!n[t]}))},C=t=>{$e(n=>Ee({...n,...t}))},he=t=>{if(o!=="entry"||D<0)return;const n=N[D+t];n&&Y(n.id)},De=t=>{const n=t.touches[0];n&&(W.current={x:n.clientX,y:n.clientY})},ze=t=>{if(!W.current)return;const n=t.changedTouches[0],s=W.current;if(W.current=null,!n||!s)return;const r=n.clientX-s.x,d=n.clientY-s.y;Math.abs(r)<48||Math.abs(r)<Math.abs(d)*1.15||(r<0?he(1):he(-1))},se=()=>o==="manage"?null:e.jsxs(e.Fragment,{children:[q?null:e.jsx("div",{className:"pointer-events-none absolute bottom-0 right-0 z-30",children:e.jsx("button",{type:"button",onClick:()=>T(!0),className:"pointer-events-auto transition active:scale-95",style:{marginRight:`${Math.max(4,18+x.chibiX)}px`,marginBottom:`${Math.max(6,10+x.chibiY)}px`},"aria-label":"å®¶é è¨­å®š",children:e.jsx("img",{src:xe,alt:"é–‹å•Ÿå®¶é è¨­å®š",draggable:!1,className:"calendar-chibi calendar-chibi-clickable select-none",style:{width:`${x.chibiSize}px`,maxWidth:"44vw",maxHeight:"32vh",height:"auto",objectFit:"contain",backgroundColor:"transparent"}})})}),Te?e.jsx("div",{className:"absolute inset-0 z-40 bg-black/28",onClick:()=>T(!1),children:e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 rounded-t-3xl border-t border-stone-200 bg-[#fffaf3] px-5 pb-[calc(env(safe-area-inset-bottom)+18px)] pt-4 shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsx("div",{className:"mx-auto mb-3 h-1.5 w-12 rounded-full bg-stone-300/80"}),e.jsx("p",{className:"text-center text-sm font-semibold text-stone-700",style:{fontFamily:"var(--app-heading-family)"},children:"å®¶é è¨­å®š"}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs(ve,{title:"é–±è®€",subtitle:"æ–‡å­—é¡è‰²ã€åº•éƒ¨æ¨£å¼ã€å­—ç´šèˆ‡è¡Œè·",isOpen:oe.reading,onToggle:()=>ce(t=>({...t,reading:!t.reading})),className:"rounded-xl border border-stone-200 bg-white/72 px-3 py-2.5",bodyClassName:"mt-2 space-y-2",children:[e.jsxs("label",{className:"space-y-1 text-xs text-stone-500",children:[e.jsx("span",{children:"é–±è®€æ–‡å­—é¡è‰²"}),e.jsxs("select",{value:x.textColorKey,onChange:t=>C({textColorKey:t.target.value}),className:"w-full rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm text-stone-700",children:[e.jsx("option",{value:"ink",children:"å¢¨é»‘"}),e.jsx("option",{value:"brown",children:"æ·±æ£•"}),e.jsx("option",{value:"slate",children:"çŸ³æ¿ç°"}),e.jsx("option",{value:"forest",children:"æ£®æž—ç¶ "}),e.jsx("option",{value:"rose",children:"èŽ“æžœç´«"}),e.jsx("option",{value:"navy",children:"æ·±æµ·è—"})]})]}),e.jsxs("label",{className:"space-y-1 text-xs text-stone-500",children:[e.jsx("span",{children:"é–±è®€åº•éƒ¨æ¨£å¼"}),e.jsxs("select",{value:x.paperKey,onChange:t=>C({paperKey:t.target.value}),className:"w-full rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm text-stone-700",children:[e.jsx("option",{value:"lined",children:"æ·ºé»ƒç­†è¨˜ç·š"}),e.jsx("option",{value:"soft",children:"æŸ”ç™½ç´™å¼µ"}),e.jsx("option",{value:"plain",children:"æ¸…çˆ½ç´ åº•"}),e.jsx("option",{value:"petal",children:"æç²‰éœ§ç´™"}),e.jsx("option",{value:"mist",children:"æ™¨éœ§è—ç®‹"})]})]}),e.jsxs("label",{className:"space-y-1 text-xs text-stone-500",children:[e.jsxs("span",{children:["é–±è®€å­—ç´šï¼š",x.fontSize,"px"]}),e.jsx("input",{type:"range",min:13,max:24,step:1,value:x.fontSize,onChange:t=>C({fontSize:Number(t.target.value)}),className:"w-full accent-amber-700"})]}),e.jsxs("label",{className:"space-y-1 text-xs text-stone-500",children:[e.jsxs("span",{children:["é–±è®€è¡Œè·ï¼š",x.lineHeight.toFixed(2)]}),e.jsx("input",{type:"range",min:1.45,max:2.6,step:.05,value:x.lineHeight,onChange:t=>C({lineHeight:Number(t.target.value)}),className:"w-full accent-amber-700"})]})]}),e.jsxs(ve,{title:"M",subtitle:"é¡¯ç¤ºã€å¤§å°èˆ‡ä½ç½®",isOpen:oe.chibi,onToggle:()=>ce(t=>({...t,chibi:!t.chibi})),className:"rounded-xl border border-stone-200 bg-white/72 px-3 py-2.5",bodyClassName:"mt-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-stone-200 bg-white px-3 py-2.5",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"M"}),e.jsx("button",{type:"button",onClick:()=>C({showChibi:!x.showChibi}),className:"relative h-6 w-10 rounded-full transition",style:{background:x.showChibi?"#9b7a5b":"#b7b7b7"},"aria-label":"åˆ‡æ›Mé¡¯ç¤º",children:e.jsx("span",{className:"absolute top-0.5 h-5 w-5 rounded-full bg-white shadow-sm transition-all",style:{left:x.showChibi?18:2}})})]}),e.jsxs("label",{className:"space-y-1 text-xs text-stone-500",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"å¤§å°"}),e.jsxs("span",{children:[x.chibiSize,"px"]})]}),e.jsx("input",{type:"range",min:104,max:196,step:1,value:x.chibiSize,onChange:t=>C({chibiSize:Number(t.target.value)}),className:"w-full accent-amber-700"})]}),e.jsxs("label",{className:"space-y-1 text-xs text-stone-500",children:[e.jsxs("span",{children:["å·¦å³ä½ç½®ï¼š",x.chibiX>0?"+":"",x.chibiX]}),e.jsx("input",{type:"range",min:-96,max:96,step:1,value:x.chibiX,onChange:t=>C({chibiX:Number(t.target.value)}),className:"w-full accent-amber-700"})]}),e.jsxs("label",{className:"space-y-1 text-xs text-stone-500",children:[e.jsxs("span",{children:["ä¸Šä¸‹ä½ç½®ï¼š",x.chibiY>0?"+":"",x.chibiY]}),e.jsx("input",{type:"range",min:-96,max:96,step:1,value:x.chibiY,onChange:t=>C({chibiY:Number(t.target.value)}),className:"w-full accent-amber-700"})]})]})]})]})}):null]}),He=()=>{if(b.length>=Z){m(`æœ€å¤š ${Z} æ ¼ï¼Œå·²é”ä¸Šé™ã€‚`);return}const t=Date.now(),n=b.findIndex(d=>I(d.id)),s=n>=0?n:b.length,r=[...b];r.splice(s,0,{id:ke("box"),title:`æ–°ä¸»é¡Œ ${Math.max(1,b.length-1)}`,subtitle:"æœªè¨­å®šå‰¯æ¨™",emoji:"ðŸ“¦",accentHex:"#f3e8d5",order:s,createdAt:t,updatedAt:t}),w(Q(r))},H=(t,n)=>{w(s=>s.map(r=>r.id===t?{...r,...n,title:(n.title??r.title).trimStart(),subtitle:(n.subtitle??r.subtitle).trimStart(),emoji:(n.emoji??r.emoji).trimStart(),updatedAt:Date.now()}:r))},be=(t,n)=>{w(s=>{const r=s.findIndex(ne=>ne.id===t);if(r<0)return s;const d=r+n;if(d<0||d>=s.length||I(s[r].id)||I(s[d].id))return s;const a=[...s],[f]=a.splice(r,1);return a.splice(d,0,f),Q(a)})},Oe=t=>{if(I(t)){m("æœªåˆ†é¡žèˆ‡ç®¡ç†æ–¹å¡Šæ˜¯ä¿åº•æ ¼ï¼Œä¸èƒ½åˆªé™¤ã€‚");return}w(n=>Q(n.filter(s=>s.id!==t)))},Ke=async()=>{if(!b.length)return;const t=Q(b.map(a=>{const f=a.id===y?"æœªåˆ†é¡ž":a.id===j?"ç®¡ç†":"æœªå‘½åæ–¹å¡Š",ne=a.id===y?"å°šæœªæ­¸æª”":a.id===j?"æ–¹å¡Šèˆ‡åŒ¯å…¥å‚™ä»½":"æœªè¨­å®šå‰¯æ¨™";return{...a,title:a.title.trim()||f,subtitle:a.subtitle.trim()||ne,emoji:a.emoji.trim()||(a.id===j?"âš™ï¸":"ðŸ“¦"),accentHex:/^#[0-9a-fA-F]{6}$/.test(a.accentHex)?a.accentHex:"#e7e5e4"}})),n=new Set(t.map(a=>a.id)),s=u.boxes.map(a=>a.id).filter(a=>!n.has(a)),r=Date.now(),d=u.entries.map(a=>s.includes(a.boxId)?{...a,boxId:y,updatedAt:r}:a);await Fe({boxes:t,entries:d},s.length?"æ–¹å¡Šè¨­å®šå·²å„²å­˜ï¼Œåˆªé™¤æ–¹å¡Šå…§å®¹å·²ç§»åˆ°æœªåˆ†é¡žã€‚":"æ–¹å¡Šè¨­å®šå·²å„²å­˜ã€‚")},fe=async(t,n,s)=>{if(!t.length)return;const d=g.some(a=>a.id===n)?n:y;v(!0);try{const a=await Ne(t,d);if(!a.entries.length&&!a.failed.length&&!a.skipped.length){m("æ²’æœ‰å¯åŒ¯å…¥çš„æª”æ¡ˆã€‚");return}a.entries.length&&(await ae({boxes:F,entries:[...a.entries,...k]}),await te());const f=[`${s}åŒ¯å…¥ï¼šæˆåŠŸ ${a.entries.length}`];a.skipped.length&&f.push(`ç•¥éŽ ${a.skipped.length}`),a.failed.length&&f.push(`å¤±æ•— ${a.failed.length}`),m(f.join("ã€"))}catch(a){m(`åŒ¯å…¥å¤±æ•—ï¼š${a instanceof Error?a.message:"æœªçŸ¥éŒ¯èª¤"}`)}finally{v(!1)}},ge=t=>{if(!t.length)return;const n=t.map(s=>({id:ke("batch"),file:s,targetBoxId:B}));G(s=>[...s,...n]),m(`å·²åŠ å…¥æ‰¹æ¬¡ ${n.length} ä»½æª”æ¡ˆï¼Œè«‹æŒ‡å®šæ–¹å¡Šå¾ŒåŒ¯å…¥ã€‚`)},_e=async()=>{if(M.length){v(!0);try{const t=new Map;for(const d of M){const a=g.some(f=>f.id===d.targetBoxId)?d.targetBoxId:y;t.has(a)||t.set(a,[]),t.get(a).push(d.file)}const n=[];let s=0,r=0;for(const[d,a]of t.entries()){const f=await Ne(a,d);n.push(...f.entries),s+=f.skipped.length,r+=f.failed.length}n.length&&(await ae({boxes:F,entries:[...n,...k]}),await te()),G([]),m(`æ‰¹æ¬¡åŒ¯å…¥å®Œæˆï¼šæˆåŠŸ ${n.length}ã€ç•¥éŽ ${s}ã€å¤±æ•— ${r}`)}catch(t){m(`æ‰¹æ¬¡åŒ¯å…¥å¤±æ•—ï¼š${t instanceof Error?t.message:"æœªçŸ¥éŒ¯èª¤"}`)}finally{v(!1)}}},Xe=()=>{const t=Ue(u);Se(`soulmate-page-${Date.now()}.json`,t),m(`å·²åŒ¯å‡ºã€Œ${$}ã€æ•´é å‚™ä»½ã€‚`)},Ye=()=>{const t=Ge(u,A);if(!t){m("æ‰¾ä¸åˆ°è¦åŒ¯å‡ºçš„æ–¹å¡Šã€‚");return}Se(`soulmate-box-${A}-${Date.now()}.json`,t),m(`å·²åŒ¯å‡ºæ–¹å¡Šã€Œ${t.box.title}ã€å‚™ä»½ã€‚`)},ye=async(t,n)=>{if(t.length){v(!0);try{const s=await Je(t,n);R(s),w(s.boxes),m(`å‚™ä»½åŒ¯å…¥å®Œæˆï¼ˆ${n==="overwrite"?"è¦†è“‹":"åˆä½µ"}ï¼‰ã€‚`)}catch(s){m(`å‚™ä»½åŒ¯å…¥å¤±æ•—ï¼š${s instanceof Error?s.message:"æœªçŸ¥éŒ¯èª¤"}`)}finally{v(!1)}}};if(Me)return e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-stone-500",children:`è®€å–ã€Œ${$}ã€ä¸­...`});if(o==="entry"&&S&&h){const t=D>0,n=D>=0&&D<N.length-1;return e.jsxs("div",{className:"relative flex h-full flex-col",style:{background:"#fdf8f2"},onTouchStart:De,onTouchEnd:ze,children:[e.jsx("header",{className:"shrink-0 border-b border-stone-200/70 bg-white/72 px-4 pb-3 pt-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("button",{type:"button",onClick:()=>p("box"),className:"mt-0.5 grid h-7 w-7 shrink-0 place-items-center rounded-full border border-stone-300/80 bg-white/85 text-xl leading-none text-stone-500 transition active:scale-95","aria-label":"è¿”å›žæ–¹å¡Šåˆ—è¡¨",title:"è¿”å›ž",children:"â€¹"}),e.jsxs("div",{className:"min-w-0 flex-1 text-center",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.2em] text-stone-400",children:h.subtitle}),e.jsxs("p",{className:"mx-auto block max-w-full truncate text-lg font-semibold text-stone-800",style:{fontFamily:"var(--app-heading-family)"},children:[h.emoji," ",h.title]})]}),q?e.jsx("button",{type:"button",onClick:()=>T(!0),"aria-label":"é–‹å•Ÿå®¶é è¨­å®š",className:"grid h-6 w-6 shrink-0 place-items-center text-[20px] leading-none text-stone-400 transition active:opacity-60",children:"â‹¯"}):e.jsx("span",{className:"h-6 w-6 shrink-0","aria-hidden":"true"})]})}),e.jsxs("div",{className:"min-h-0 flex-1 overflow-y-auto px-5 pb-28 pt-4",children:[e.jsx("h3",{className:"mb-3 text-xl font-semibold text-stone-900",style:{fontFamily:pe},children:S.title}),e.jsx("div",{className:`rounded-2xl border px-4 py-4 text-stone-700 shadow-sm ${ue.className}`,style:{...ue.style,fontFamily:pe,color:Ae,fontSize:x.fontSize,lineHeight:x.lineHeight},children:S.htmlContent?e.jsx("div",{dangerouslySetInnerHTML:{__html:S.htmlContent}}):e.jsx("p",{className:"whitespace-pre-wrap",children:S.content||"ï¼ˆç©ºç™½å…§å®¹ï¼‰"})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between px-1 text-[11px] text-stone-400",children:[e.jsx("span",{children:t?"å³æ»‘ï¼šä¸Šä¸€ç¯‡":"Â "}),e.jsx("span",{children:n?"å·¦æ»‘ï¼šä¸‹ä¸€ç¯‡":"Â "})]})]}),se()]})}if(o==="box"&&h)return e.jsxs("div",{className:"relative flex h-full flex-col",style:{background:re(h.accentHex,.08)},children:[e.jsx("header",{className:"shrink-0 border-b border-stone-200/70 bg-white/72 px-4 pb-3 pt-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>p("shelf"),className:"grid h-8 w-8 place-items-center rounded-full border border-stone-300/80 bg-white/85 text-2xl leading-none text-stone-500 transition active:scale-95","aria-label":"è¿”å›žå®¶ä¸»é ",children:"â€¹"}),e.jsxs("div",{className:"min-w-0 flex-1 text-center",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.2em] text-stone-400",children:h.subtitle}),e.jsxs("h2",{className:"truncate text-lg font-semibold text-stone-800",style:{fontFamily:"var(--app-heading-family)"},children:[h.emoji," ",h.title]})]}),e.jsx("button",{type:"button",onClick:()=>p("manage"),className:"grid h-8 w-8 place-items-center rounded-full text-[18px] text-stone-500 transition active:scale-95","aria-label":"é–‹å•Ÿç®¡ç†",children:"âš™"}),q?e.jsx("button",{type:"button",onClick:()=>T(!0),className:"grid h-8 w-8 place-items-center rounded-full text-[20px] text-stone-400 transition active:scale-95","aria-label":"é–‹å•Ÿå®¶é è¨­å®š",title:"è¨­å®š",children:"â‹¯"}):null]})}),e.jsx("div",{className:"min-h-0 flex-1 overflow-y-auto px-4 pb-24 pt-3",children:N.length?e.jsx("div",{className:"space-y-2",children:N.map(t=>e.jsxs("button",{type:"button",onClick:()=>{Y(t.id),p("entry")},className:"w-full rounded-2xl border border-stone-200/80 bg-white/75 px-3.5 py-3 text-left shadow-sm transition active:scale-[0.99]",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-stone-800",children:t.title}),e.jsx("p",{className:"mt-1 line-clamp-2 text-xs leading-[1.6] text-stone-500",children:tt(t)}),e.jsx("p",{className:"mt-1.5 text-[10px] text-stone-400",children:st(t.importedAt)})]},t.id))}):e.jsx("div",{className:"rounded-2xl border border-dashed border-stone-300 bg-white/55 px-4 py-8 text-center text-sm text-stone-500",children:"é€™å€‹æ–¹å¡Šé‚„æ²’æœ‰å…§å®¹"})}),se()]});if(o==="manage"){const t=b.filter(s=>!I(s.id)).length,n=b.filter(s=>s.id!==j);return e.jsxs("div",{className:"flex h-full flex-col",style:{background:"#f8f4ee"},children:[e.jsx("header",{className:"shrink-0 border-b border-stone-200/80 bg-white/80 px-4 pb-3 pt-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>p("shelf"),className:"grid h-8 w-8 place-items-center rounded-full text-2xl leading-none text-stone-500 transition active:scale-95","aria-label":"è¿”å›žå®¶ä¸»é ",children:"â€¹"}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.2em] text-stone-400",children:$}),e.jsx("h2",{className:"text-lg font-semibold text-stone-800",style:{fontFamily:"var(--app-heading-family)"},children:"ç®¡ç†é "})]}),e.jsx("button",{type:"button",onClick:()=>{Ke()},disabled:de,className:"grid h-8 w-8 place-items-center rounded-xl border border-stone-300 bg-white/85 text-[15px] text-stone-600 shadow-sm transition active:scale-95 disabled:opacity-50","aria-label":"å„²å­˜æ–¹å¡Šè¨­å®š",title:"å„²å­˜",children:"ðŸ’¾"})]})}),e.jsx("div",{className:"min-h-0 flex-1 overflow-y-auto px-4 pb-5 pt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(K,{title:"ä¸»é æ¨™é¡Œ",description:"é¦–é èˆ‡æ–¹å¡Šé å…±ç”¨ï¼Œç•™ç©ºæœƒå›žåˆ°é è¨­ã€Œå®¶ã€",isOpen:P.page,onToggle:()=>z("page"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"space-y-1 text-[11px] text-stone-500",children:[e.jsx("span",{children:"ä¸»æ¨™é¡Œ"}),e.jsx("input",{type:"text",value:ie,onChange:s=>le(s.target.value),onBlur:()=>le(s=>s.trim()||V),className:"w-full rounded-md border border-stone-300 bg-white px-3 py-2 text-sm text-stone-700",maxLength:20})]}),e.jsxs("p",{className:"text-[11px] text-stone-400",children:["ç›®å‰é¡¯ç¤ºï¼š",$]})]})}),e.jsxs(K,{title:"æ–¹å¡Šé…ç½®",description:`å·²ç”¨ ${b.length}/${Z} æ ¼ï¼ˆå¯åˆªé™¤ï¼š${t}ï¼‰`,isOpen:P.boxes,onToggle:()=>z("boxes"),children:[e.jsx("div",{className:"mb-3 flex justify-end",children:e.jsx("button",{type:"button",onClick:He,disabled:b.length>=Z,className:"grid h-8 w-8 place-items-center rounded-lg border border-stone-300 bg-white text-base leading-none text-stone-700 disabled:opacity-40","aria-label":"æ–°å¢žæ–¹å¡Š",children:"+"})}),e.jsx("div",{className:"space-y-2.5",children:b.map((s,r)=>{const d=I(s.id);return e.jsxs("div",{className:"rounded-xl border border-stone-200 bg-stone-50/85 p-2.5",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_1fr] gap-2",children:[e.jsxs("label",{className:"space-y-1 text-[11px] text-stone-500",children:[e.jsx("span",{children:"ä¸»æ¨™é¡Œ"}),e.jsx("input",{type:"text",value:s.title,onChange:a=>H(s.id,{title:a.target.value}),className:"w-full rounded-md border border-stone-300 bg-white px-2.5 py-1.5 text-sm text-stone-700"})]}),e.jsxs("label",{className:"space-y-1 text-[11px] text-stone-500",children:[e.jsx("span",{children:"å‰¯æ¨™é¡Œ"}),e.jsx("input",{type:"text",value:s.subtitle,onChange:a=>H(s.id,{subtitle:a.target.value}),className:"w-full rounded-md border border-stone-300 bg-white px-2.5 py-1.5 text-sm text-stone-700"})]}),e.jsxs("label",{className:"space-y-1 text-[11px] text-stone-500",children:[e.jsx("span",{children:"Emoji"}),e.jsx("input",{type:"text",value:s.emoji,onChange:a=>H(s.id,{emoji:a.target.value}),className:"w-full rounded-md border border-stone-300 bg-white px-2.5 py-1.5 text-sm text-stone-700"})]}),e.jsxs("label",{className:"space-y-1 text-[11px] text-stone-500",children:[e.jsx("span",{children:"é¡è‰²"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:/^#[0-9a-fA-F]{6}$/.test(s.accentHex)?s.accentHex:"#d6d3d1",onChange:a=>H(s.id,{accentHex:a.target.value}),className:"h-8 w-8 rounded border border-stone-300"}),e.jsx("input",{type:"text",value:s.accentHex,onChange:a=>H(s.id,{accentHex:a.target.value}),className:"min-w-0 flex-1 rounded-md border border-stone-300 bg-white px-2 py-1.5 text-xs text-stone-600"})]})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsxs("p",{className:"text-[11px] text-stone-400",children:["#",r+1," ",d?"ï¼ˆå›ºå®šæ–¹å¡Šï¼‰":""]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{type:"button",onClick:()=>be(s.id,-1),disabled:d||r===0||I(b[r-1]?.id??""),className:"rounded-md border border-stone-300 bg-white px-2 py-1 text-xs text-stone-600 disabled:opacity-35",children:"â†‘"}),e.jsx("button",{type:"button",onClick:()=>be(s.id,1),disabled:d||r===b.length-1||I(b[r+1]?.id??""),className:"rounded-md border border-stone-300 bg-white px-2 py-1 text-xs text-stone-600 disabled:opacity-35",children:"â†“"}),e.jsx("button",{type:"button",onClick:()=>Oe(s.id),disabled:d,className:"rounded-md border border-rose-300 bg-rose-50 px-2 py-1 text-xs text-rose-700 disabled:opacity-35",children:"åˆªé™¤"})]})]})]},s.id)})})]}),e.jsx(K,{title:"æŒ‡å®šæ–¹å¡ŠåŒ¯å…¥",description:"å…ˆé¸æ–¹å¡Šï¼Œå†åŒ¯å…¥æª”æ¡ˆæˆ–è³‡æ–™å¤¾ï¼ˆTXT / DOCXï¼‰",isOpen:P.directImport,onToggle:()=>z("directImport"),children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("select",{value:B,onChange:s=>L(s.target.value),className:"min-w-44 rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm text-stone-700",children:n.map(s=>e.jsxs("option",{value:s.id,children:[s.emoji," ",s.title]},s.id))}),e.jsxs("label",{className:"cursor-pointer rounded-lg border border-stone-300 bg-white px-3 py-2 text-xs text-stone-700",children:["åŒ¯å…¥æª”æ¡ˆ",e.jsx("input",{type:"file",multiple:!0,accept:".txt,.doc,.docx",className:"hidden",onChange:s=>{const r=s.target.files?Array.from(s.target.files):[];fe(r,B,"æŒ‡å®šæ–¹å¡Š"),s.currentTarget.value=""}})]}),e.jsxs("label",{className:"cursor-pointer rounded-lg border border-stone-300 bg-white px-3 py-2 text-xs text-stone-700",children:["åŒ¯å…¥è³‡æ–™å¤¾",e.jsx("input",{type:"file",multiple:!0,accept:".txt,.doc,.docx",className:"hidden",webkitdirectory:"",onChange:s=>{const r=s.target.files?Array.from(s.target.files):[];fe(r,B,"è³‡æ–™å¤¾"),s.currentTarget.value=""}})]})]})}),e.jsxs(K,{title:"æ‰¹æ¬¡åˆ†é…åŒ¯å…¥",description:"å…ˆåŠ å…¥æª”æ¡ˆï¼Œå†é€æª”æŒ‡å®šæ–¹å¡Šå¾Œä¸€æ¬¡åŒ¯å…¥",isOpen:P.batchImport,onToggle:()=>z("batchImport"),children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("label",{className:"cursor-pointer rounded-lg border border-stone-300 bg-white px-3 py-2 text-xs text-stone-700",children:["åŠ å…¥æª”æ¡ˆ",e.jsx("input",{type:"file",multiple:!0,accept:".txt,.doc,.docx",className:"hidden",onChange:s=>{const r=s.target.files?Array.from(s.target.files):[];ge(r),s.currentTarget.value=""}})]}),e.jsxs("label",{className:"cursor-pointer rounded-lg border border-stone-300 bg-white px-3 py-2 text-xs text-stone-700",children:["åŠ å…¥è³‡æ–™å¤¾",e.jsx("input",{type:"file",multiple:!0,accept:".txt,.doc,.docx",className:"hidden",webkitdirectory:"",onChange:s=>{const r=s.target.files?Array.from(s.target.files):[];ge(r),s.currentTarget.value=""}})]}),e.jsx("button",{type:"button",onClick:()=>G([]),disabled:!M.length,className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-xs text-stone-700 disabled:opacity-40",children:"æ¸…ç©ºæ¸…å–®"}),e.jsx("button",{type:"button",onClick:()=>{_e()},disabled:!M.length||de,className:"rounded-lg border border-emerald-300 bg-emerald-50 px-3 py-2 text-xs text-emerald-700 disabled:opacity-40",children:"é–‹å§‹æ‰¹æ¬¡åŒ¯å…¥"})]}),M.length>0&&e.jsx("div",{className:"mt-3 space-y-2 rounded-xl border border-stone-200 bg-stone-50 p-2.5",children:M.map(s=>e.jsxs("div",{className:"grid grid-cols-[1fr_132px] gap-2",children:[e.jsx("p",{className:"truncate rounded-md border border-stone-200 bg-white px-2 py-1.5 text-xs text-stone-600",children:s.file.name}),e.jsx("select",{value:s.targetBoxId,onChange:r=>G(d=>d.map(a=>a.id===s.id?{...a,targetBoxId:r.target.value}:a)),className:"rounded-md border border-stone-300 bg-white px-2 py-1 text-xs text-stone-700",children:n.map(r=>e.jsx("option",{value:r.id,children:r.title},r.id))})]},s.id))})]}),e.jsxs(K,{title:"æœ¬é å‚™ä»½",description:"å®Œæ•´åŒ¯å…¥åŒ¯å‡ºï¼›å–®æ–¹å¡Šå¯åŒ¯å‡ºï¼Œè¦†è“‹åŒ¯å…¥æœƒè‡ªå‹•åˆ¤æ–·",isOpen:P.backup,onToggle:()=>z("backup"),children:[e.jsxs("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-3",children:[e.jsx("button",{type:"button",onClick:Xe,className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-xs text-stone-700",children:"å®Œæ•´åŒ¯å‡º"}),e.jsxs("label",{className:"cursor-pointer rounded-lg border border-stone-300 bg-white px-3 py-2 text-center text-xs text-stone-700",children:["åŒ¯å…¥ï¼ˆåˆä½µï¼‰",e.jsx("input",{type:"file",multiple:!0,accept:".json,application/json",className:"hidden",onChange:s=>{const r=s.target.files?Array.from(s.target.files):[];ye(r,"merge"),s.currentTarget.value=""}})]}),e.jsxs("label",{className:"cursor-pointer rounded-lg border border-rose-300 bg-rose-50 px-3 py-2 text-center text-xs text-rose-700",children:["åŒ¯å…¥ï¼ˆè¦†è“‹ï¼‰",e.jsx("input",{type:"file",multiple:!0,accept:".json,application/json",className:"hidden",onChange:s=>{const r=s.target.files?Array.from(s.target.files):[];ye(r,"overwrite"),s.currentTarget.value=""}})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-[1fr_auto] gap-2",children:[e.jsx("select",{value:A,onChange:s=>U(s.target.value),className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm text-stone-700",children:n.map(s=>e.jsxs("option",{value:s.id,children:[s.emoji," ",s.title]},s.id))}),e.jsx("button",{type:"button",onClick:Ye,className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-xs text-stone-700",children:"åŒ¯å‡ºå–®æ–¹å¡Š"})]}),e.jsx("p",{className:"mt-2 text-[11px] text-stone-500",children:"è¦†è“‹åŒ¯å…¥è¦å‰‡ï¼šæ•´é å‚™ä»½æœƒè¦†è“‹æ•´é ï¼›å–®æ–¹å¡Šå‚™ä»½åªè¦†è“‹è©²æ–¹å¡Šï¼Œä¸å½±éŸ¿å…¶ä»–æ–¹å¡Šã€‚"})]}),J&&e.jsx("p",{className:"text-xs text-stone-600",children:J})]})})]})}return e.jsxs("div",{className:"relative flex h-full flex-col",style:{background:"#f8f4ee"},children:[e.jsx("div",{className:"calendar-header-panel shrink-0 border-b border-stone-200/70 px-4 pb-4 pt-5",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:i,className:"grid h-8 w-8 shrink-0 place-items-center rounded-full border border-stone-300/80 bg-white/85 text-2xl leading-none text-stone-500 shadow-sm transition active:scale-95","aria-label":"é›¢é–‹å®¶é ",children:"â€¹"}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.25em] text-white/70",children:"HOME GRID"}),e.jsx("h1",{className:"font-bold text-white",style:{fontFamily:"var(--app-heading-family)",fontSize:"calc(var(--ui-header-title-size, 17px) + 7px)"},children:$}),e.jsx("p",{className:"mt-0.5 text-[11px] text-white/75",children:"å¤šä¸»é¡Œæ”¶ç´æ ¼"})]}),q?e.jsx("button",{type:"button",onClick:()=>T(!0),className:"grid h-8 w-8 shrink-0 place-items-center text-[20px] leading-none text-white/85 transition active:opacity-60","aria-label":"é–‹å•Ÿå®¶é è¨­å®š",title:"è¨­å®š",children:"â‹¯"}):e.jsx("span",{className:"h-8 w-8 shrink-0","aria-hidden":"true"})]})}),e.jsxs("div",{className:"min-h-0 flex-1 overflow-y-auto px-4 pb-24 pt-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-3",children:F.map((t,n)=>{const s=Pe.get(t.id)??0,r=t.id===j;return e.jsxs("button",{type:"button",onClick:()=>{if(r){p("manage");return}ee(t.id),p("box")},className:"list-card-reveal flex flex-col items-center gap-1.5 rounded-2xl p-3 text-center shadow-sm transition-all active:scale-95",style:{animationDelay:`${n*28}ms`,background:re(t.accentHex,.22),border:`1.5px solid ${re(t.accentHex,.55)}`},children:[e.jsx("span",{className:"text-3xl leading-none",children:t.emoji}),e.jsx("p",{className:"line-clamp-2 text-[13px] font-semibold leading-tight text-stone-700",children:t.title}),e.jsx("p",{className:"line-clamp-2 text-[10px] leading-tight text-stone-400",children:t.subtitle}),e.jsx("p",{className:"mt-0.5 rounded-full border border-stone-300/70 bg-white/70 px-2 py-0.5 text-[10px] text-stone-600",children:r?"è¨­å®š":`${s}`})]},t.id)})}),J?e.jsx("p",{className:"mt-3 text-center text-[11px] text-stone-500",children:J}):null]}),se()]})}export{rt as default};
