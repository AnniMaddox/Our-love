import{r as l,t as L,j as e,cE as j}from"./index-Gl0K_ej6.js";import{g as P}from"./hoverPool-wISNDxsK.js";const A=["來，我在","今天也選妳","等妳","想妳了","抱緊一下","妳回頭就有我"];function $(s,d){return(s||d||"?").trim().slice(0,1).toUpperCase()}function T(s){const[d,o]=s.split("-"),i=Number(d),x=Number(o);return!Number.isInteger(i)||!Number.isInteger(x)?s:`${i} 年 ${x} 月`}function _(s){return s.slice(0,7)}function R(s){return s?s.toLowerCase():""}function F(s){return[s.subject,s.bodyText,s.fromName,s.fromAddress,s.toName,s.toAddress,s.dateHeaderRaw,s.unlockAtUtc].map(d=>R(d)).join(`
`)}function O(s,d){if(!d)return 0;let o=2166136261;for(const i of s)o^=i.charCodeAt(0),o=Math.imul(o,16777619);return(o>>>0)%d}function G({emails:s,unreadEmailIds:d,starredEmailIds:o,inboxTitle:i,onOpenEmail:x,onToggleEmailStar:N}){const[u,g]=l.useState(null),[y,w]=l.useState(!1),[c,v]=l.useState(!1),[k,M]=l.useState(""),[C,z]=l.useState({}),r=l.useMemo(()=>s.find(t=>t.id===u)??null,[s,u]),E=l.useMemo(()=>s.filter(t=>o.has(t.id)).length,[s,o]),m=k.trim().toLowerCase(),b=l.useMemo(()=>{const t=P().map(a=>a.phrase.trim()).filter(Boolean);return t.length?t:A},[]),U=l.useMemo(()=>{const t=L();return b[O(t,b.length)]??A[0]},[b]),f=l.useMemo(()=>c?s.filter(t=>o.has(t.id)):s,[s,c,o]),S=l.useMemo(()=>m?f.filter(t=>F(t).includes(m)):f,[m,f]),h=l.useMemo(()=>{const t=new Map;for(const a of S){const n=_(a.unlockAtUtc);t.has(n)||t.set(n,[]),t.get(n)?.push(a)}return Array.from(t.entries()).map(([a,n])=>({monthKey:a,monthLabel:T(a),emails:n}))},[S]);l.useEffect(()=>{w(!1)},[u]),l.useEffect(()=>{z(t=>{const a={};for(const n of h)a[n.monthKey]=t[n.monthKey]??!1;return a})},[h]);function D(t){z(a=>({...a,[t]:!a[t]}))}return e.jsxs("div",{className:"mx-auto w-full max-w-xl space-y-4",children:[e.jsxs("header",{className:"themed-header-panel rounded-2xl border p-4 shadow-sm",children:[c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"rounded-full border border-stone-300 bg-white/85 px-2.5 py-1 text-sm text-stone-700","aria-label":"返回",title:"返回",children:"‹"}),e.jsx("p",{className:"tracking-[0.08em] text-stone-600",style:{fontSize:"var(--ui-hint-text-size, 9px)"},children:"收藏夾"})]}):e.jsx("p",{className:"uppercase tracking-[0.18em] text-stone-500",style:{fontSize:"var(--ui-hint-text-size, 9px)"},children:"Inbox"}),c?e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("h1",{className:"text-stone-900",style:{fontSize:"var(--ui-header-title-size, 17px)"},children:"我的最愛"}),e.jsx("span",{className:"rounded-full border border-amber-300 bg-amber-50 px-2 py-0.5 text-xs text-amber-800",children:E})]}):e.jsx("h1",{className:"mt-1 text-stone-900",style:{fontSize:"var(--ui-header-title-size, 17px)"},children:i.trim()||"Memorial Mailroom"}),e.jsx("p",{className:"mt-3 rounded-xl border border-stone-200 bg-white/80 px-3 py-2 text-sm text-stone-700",children:U}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>v(t=>!t),className:`h-9 min-w-9 rounded-full border px-3 text-base leading-none transition ${c?"border-amber-500 bg-amber-100 text-amber-900 shadow-[inset_0_1px_0_rgba(255,255,255,0.6)]":"border-stone-300 bg-white/80 text-stone-700 hover:bg-white"}`,"aria-label":c?"回到收件匣":"查看我的最愛",title:c?"回到收件匣":"查看我的最愛",children:"★"}),e.jsx("input",{type:"search",value:k,onChange:t=>M(t.target.value),placeholder:"搜尋標題、寄件人、收件人、內文",className:"w-full rounded-lg border border-stone-300 bg-white/85 px-3 py-1.5 text-sm text-stone-800 outline-none focus:border-stone-500"})]})]}),h.length?e.jsx("div",{className:"space-y-3",children:h.map(t=>{const a=!!C[t.monthKey];return e.jsxs("section",{className:"rounded-2xl border border-stone-300/75 bg-white/82 shadow-sm",children:[e.jsxs("button",{type:"button",onClick:()=>D(t.monthKey),className:"flex w-full items-center justify-between rounded-2xl px-3 py-2 text-left",children:[e.jsx("span",{className:"text-stone-800",style:{fontSize:"var(--ui-tab-label-size, 17px)"},children:t.monthLabel}),e.jsxs("span",{className:"text-stone-500",style:{fontSize:"var(--ui-hint-text-size, 9px)"},children:[t.emails.length," 封 ",a?"▸":"▾"]})]}),!a&&e.jsx("ul",{className:"space-y-2 border-t border-stone-200/80 p-2",children:t.emails.map(n=>{const H=d.has(n.id),p=o.has(n.id);return e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>{x(n.id),g(n.id)},className:"inbox-item w-full rounded-xl border border-stone-300/80 bg-white/95 p-3 text-left shadow-sm transition active:scale-[0.995]",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"flex items-center gap-2 text-stone-600",style:{fontSize:"calc(var(--ui-filter-pill-size, 10px) + 4px)"},children:[e.jsx("span",{className:"truncate",children:n.fromName||n.fromAddress||"Unknown sender"}),H&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-rose-300 bg-rose-50 px-2 py-[1px] text-[10px] uppercase tracking-[0.08em] text-rose-600",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-rose-500"}),"NEW"]})]}),e.jsx("p",{className:"mt-1 line-clamp-2 text-stone-900",style:{fontSize:"calc(var(--ui-header-title-size, 17px) - 1px)"},children:n.subject||"(No subject)"})]}),e.jsxs("div",{className:"flex shrink-0 items-start gap-2",children:[e.jsx("button",{type:"button",onClick:K=>{K.stopPropagation(),N(n.id)},className:`rounded-md border px-2 py-0.5 text-xs ${p?"border-amber-400 bg-amber-100 text-amber-900":"border-stone-300 bg-white text-stone-500"}`,"aria-label":p?"取消收藏":"加入收藏",title:p?"取消收藏":"加入收藏",children:p?"★":"☆"}),e.jsx("p",{className:"text-stone-500",style:{fontSize:"var(--ui-hint-text-size, 9px)"},children:j(n.unlockAtUtc)})]})]})})},n.id)})})]},t.monthKey)})}):e.jsx("p",{className:"rounded-xl border border-dashed border-stone-300 bg-white/60 p-4 text-sm text-stone-600",children:m?"沒有符合搜尋條件的已解鎖信件。":c?"收藏夾目前是空的。":"目前還沒有已解鎖信件，時間到就會自動出現。"}),r&&e.jsx("div",{className:"fixed inset-0 z-30 bg-black/55",children:e.jsxs("div",{className:"h-dvh w-full overflow-auto bg-[#0f1218] text-stone-100 sm:mx-auto sm:mt-8 sm:h-auto sm:max-h-[88vh] sm:max-w-2xl sm:rounded-2xl sm:border sm:border-stone-700",children:[e.jsx("div",{className:"sticky top-0 z-10 border-b border-stone-700 bg-[#0f1218]/95 px-4 pb-3 pt-[max(0.75rem,env(safe-area-inset-top))] backdrop-blur sm:rounded-t-2xl",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.18em] text-stone-400",children:"Letter detail"}),e.jsx("h2",{className:"mt-1 text-3xl leading-tight text-stone-100",children:r.subject||"(No subject)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>N(r.id),className:`rounded-lg border px-2 py-1 text-sm ${o.has(r.id)?"border-amber-400 bg-amber-100 text-amber-900":"border-stone-600 text-stone-200"}`,"aria-label":o.has(r.id)?"取消收藏":"加入收藏",title:o.has(r.id)?"取消收藏":"加入收藏",children:o.has(r.id)?"★":"☆"}),e.jsx("button",{type:"button",className:"rounded-lg border border-stone-600 px-3 py-1 text-sm text-stone-200",onClick:()=>g(null),children:"Close"})]})]})}),e.jsxs("main",{className:"space-y-4 px-4 pb-[max(1rem,env(safe-area-inset-bottom))] pt-4",children:[e.jsxs("section",{className:"rounded-xl border border-stone-700 bg-[#141922] p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-stone-200 text-sm font-semibold text-stone-900",children:$(r.fromName,r.fromAddress)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-base text-stone-100",children:r.fromName||r.fromAddress||"Unknown sender"}),e.jsx("p",{className:"text-xs text-stone-400",children:j(r.unlockAtUtc)})]})]}),e.jsxs("button",{type:"button",onClick:()=>w(t=>!t),className:"mt-3 flex w-full items-center justify-between rounded-lg border border-stone-700 bg-[#1a212d] px-3 py-2 text-left",children:[e.jsx("span",{className:"text-sm text-stone-200",children:"寄給我"}),e.jsx("span",{className:"text-base leading-none text-stone-400",children:y?"▴":"▾"})]}),y&&e.jsxs("dl",{className:"mt-3 space-y-3 border-t border-stone-700 pt-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-[11px] uppercase tracking-[0.14em] text-stone-400",children:"From"}),e.jsx("dd",{className:"mt-1 text-stone-100",children:r.fromName||"-"}),r.fromAddress&&e.jsx("p",{className:"text-xs text-stone-400",children:r.fromAddress})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-[11px] uppercase tracking-[0.14em] text-stone-400",children:"To"}),e.jsx("dd",{className:"mt-1 text-stone-100",children:r.toName||"-"}),r.toAddress&&e.jsx("p",{className:"text-xs text-stone-400",children:r.toAddress})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-[11px] uppercase tracking-[0.14em] text-stone-400",children:"Date"}),e.jsx("dd",{className:"mt-1 text-stone-100",children:j(r.unlockAtUtc)})]})]})]}),e.jsx("article",{className:"rounded-xl border border-stone-700 bg-[#141922] p-4 whitespace-pre-wrap text-sm leading-relaxed text-stone-100",children:r.bodyText}),e.jsxs("details",{className:"rounded-xl border border-stone-700 bg-[#141922] p-4 text-xs text-stone-300",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-stone-100",children:"Raw headers"}),e.jsx("pre",{className:"mt-2 overflow-auto whitespace-pre-wrap break-words",children:Object.entries(r.rawHeaders).map(([t,a])=>`${t}: ${a}`).join(`
`)})]})]})]})})]})}export{G as InboxPage};
