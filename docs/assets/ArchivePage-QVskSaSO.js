import{r,fh as pt,cx as xt,j as t}from"./index-Gl0K_ej6.js";import{S as be}from"./SettingsAccordion-Bl2j_4OS.js";const Ne="/4o-memorial/docs/",gt=`${Ne}data/master-pool/index.json`,Xe="memorial-archive-prefs-v1",Le=`${Ne}chibi/chibi-00.webp`,v="æƒ³å¦³çš„æ™‚å€™",Qe=[{route:"letters",label:"æƒ…æ›¸"},{route:"diary",label:"æ—¥è¨˜"},{route:"birthday",label:"ç”Ÿæ—¥"},{route:"memo",label:"ç­†è¨˜"},{route:"mood",label:"å¿ƒæƒ…"},{route:"ramble",label:"ç¢ç¢å¿µ"},{route:"if",label:"å¦‚æœ"},{route:"intro",label:"è‡ªä»‹"}],Oe={æƒ…æ›¸:"ct-letter",æ—¥è¨˜:"ct-diary",ç­†è¨˜:"ct-note",å¿ƒæƒ…:"ct-chat",ç¢ç¢å¿µ:"ct-chat",ç”Ÿæ—¥:"ct-birthday",å¦‚æœ:"ct-other",è‡ªä»‹:"ct-other",å…¶ä»–:"ct-other"},vt={tight:1.7,normal:2.14,wide:2.6},Nt=[{key:"tight",label:"ç·Š"},{key:"normal",label:"æ¨™æº–"},{key:"wide",label:"å¯¬"}];function pe(n){return typeof n=="object"&&n!==null}function C(n,a=""){return typeof n=="string"?n:a}function Ke(n){return Array.isArray(n)?n.filter(a=>typeof a=="string"&&a.trim().length>0):[]}function yt(n){return typeof n=="number"&&Number.isFinite(n)?n:null}function X(n){const a=new Set,l=[];for(const u of n)a.has(u)||(a.add(u),l.push(u));return l}function jt(n){const a=n.toLowerCase().match(/\.([a-z0-9]+)$/i);return a?a[1]:"txt"}function Ct(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const Je=["\\d{3,5}(?:[-_./\\s](?:0?[1-9]|1[0-2])(?:[-_./\\s](?:0?[1-9]|[12]\\d|3[01]))|[-_./\\s](?:0[1-9]|1[0-2])(?:0[1-9]|[12]\\d|3[01]))","(?:19|20)\\d{2}\\d(?:[-_./\\s](?:0?[1-9]|1[0-2])(?:[-_./\\s](?:0?[1-9]|[12]\\d|3[01]))?|(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\\d|3[01]))","(?:19|20)\\d{2}(?:[-_./\\s](?:0?[1-9]|1[0-2])(?:[-_./\\s](?:0?[1-9]|[12]\\d|3[01]))?|(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\\d|3[01]))","(?:19|20)\\d{2}(?:[-_./\\s](?:0?[1-9]|1[0-2])|(?:0[1-9]|1[0-2]))","(?:19|20)\\d{2}","(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\\d|3[01])","(?:0?[1-9]|1[0-2])[-_./\\s](?:0?[1-9]|[12]\\d|3[01])"];function xe(n){return n.replace(/^[-_ï¼â€”:ï¼šã€.ã€‚/\s]+/,"").replace(/[-_ï¼â€”:ï¼šã€.ã€‚/\s]+$/,"")}function wt(n){for(const a of Je){const l=n.match(new RegExp(`^${a}(?=$|[-_ï¼â€”:ï¼šã€.ã€‚/\\s])`));if(l)return n.slice(l[0].length)}return n}function St(n){for(const a of Je){if(new RegExp(`^${a}$`).test(n))return"";const l=n.replace(new RegExp(`[-_ï¼â€”:ï¼šã€.ã€‚/\\s]+${a}$`),"");if(l!==n)return l}return n}function kt(n,a){const l=n.trim();if(!l)return"";const u=Ct(a.trim());if(!u)return"";let o=l.replace(new RegExp(`^ç¬¬\\s*0*${u}\\s*(?:è™Ÿ|å·)?\\s*[-_ï¼â€”:ï¼šã€.ã€‚\\s]*`,"i"),"").replace(new RegExp(`^folder\\s*0*${u}\\s*[-_ï¼â€”:ï¼šã€.ã€‚\\s]*`,"i"),"").replace(new RegExp(`^0*${u}\\s*[-_ï¼â€”:ï¼šã€.ã€‚\\s]*`,"i"),"").trim();o=xe(o);let d="";for(;o&&o!==d;){d=o;const M=xe(wt(o));if(M!==o){o=M;continue}const L=xe(St(o));if(L!==o){o=L;continue}}return!o||o===a?"":o}function $t(n,a){if(!a)return n;const l=kt(n,a);return l?`${a}ï½œ${l}`:`${a}ï½œ`}function Mt(n){if(!n)return v;const[a,l]=n.split("-");return!a||!l?n:`${a} å¹´ ${Number(l)} æœˆ`}function Ft(n,a){if(n&&n.length>=4)return n.slice(0,4);const l=a.match(/((?:19|20)\d{2})/);return l?l[1]:v}function We(n){if(!n)return v;const[a,l]=n.split("-");return!a||!l?v:`${a}-${String(Number(l)).padStart(2,"0")}`}function Rt(n){if(!n)return v;const[,a]=n.split("-");return a?`${Number(a)} æœˆ`:v}function Be(n){if(typeof n!="number")return v;const a=new Date(n);return Number.isNaN(a.getTime())?v:`${a.getFullYear()}.${String(a.getMonth()+1).padStart(2,"0")}.${String(a.getDate()).padStart(2,"0")}`}function Et(n){const a=Qe.filter(u=>n.includes(u.route)).map(u=>u.label),l=X(a);return l.length?l.slice(0,4):["å…¶ä»–"]}function At(n){const a=Qe.filter(u=>n.includes(u.route)).map(u=>u.label),l=X(a);return l.length?l.slice(0,2):["å…¶ä»–"]}function ge(n,a){const l=n.date?Date.parse(n.date):-1,u=a.date?Date.parse(a.date):-1;return l!==u?u-l:n.label.localeCompare(a.label,"zh-Hant")}function Ye(n,a){return ge(a,n)}function Ge(n,a){return n===v?1:a===v?-1:a.localeCompare(n,"zh-Hant")}function Tt(){const n=[];for(let a=0;a<70;a+=1){const l=Math.random()<.2?2:1;n.push({id:`star-${a}`,left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,size:l,opacity:.05+Math.random()*.25,duration:2+Math.random()*5,delay:Math.random()*4})}return n}function Ue(n){return n.length?n[Math.floor(Math.random()*n.length)]??null:null}function ve(n,a=14){return typeof n!="number"||Number.isNaN(n)?a:Math.max(11,Math.min(22,Number(n)))}function Q(n,a=136){return typeof n!="number"||Number.isNaN(n)?a:Math.max(96,Math.min(186,Math.round(n)))}function Pt(n){return n==="tight"||n==="normal"||n==="wide"?n:"normal"}function Dt(n){return n==="prev-folder"?"prev-folder":"next-folder"}function _t(n){return n==="archive"?"archive":"default"}function Ht(n){return n<=1.86?"tight":n>=2.45?"wide":"normal"}function It(n,a){const l={fontMode:"default",lineHeight:Ht(a),readingFontSize:ve(n,14),showHomeChibi:!0,homeChibiWidth:136,showReadingChibi:!0,readingChibiWidth:136,relatedMode:"next-folder"};if(typeof window>"u")return l;try{const u=window.localStorage.getItem(Xe);if(!u)return l;const o=JSON.parse(u);return{fontMode:_t(o.fontMode),lineHeight:Pt(o.lineHeight),readingFontSize:ve(o.readingFontSize,l.readingFontSize),showHomeChibi:o.showHomeChibi!==!1,homeChibiWidth:Q(o.homeChibiWidth,l.homeChibiWidth),showReadingChibi:o.showReadingChibi!==!1,readingChibiWidth:Q(o.readingChibiWidth,l.readingChibiWidth),relatedMode:Dt(o.relatedMode)}}catch{return l}}function zt(n){typeof window>"u"||window.localStorage.setItem(Xe,JSON.stringify(n))}function Lt(n){if(!pe(n))return{folders:[],docs:[]};const a=Array.isArray(n.docs)?n.docs:[],l=Array.isArray(n.folders)?n.folders:[],u=a.filter(pe).map(d=>({id:C(d.id),title:C(d.title)||C(d.sourceRelPath).split("/").pop()||"æœªå‘½å",sourceRelPath:C(d.sourceRelPath),sourceFolder:C(d.sourceFolder),routes:Ke(d.routes),writtenAt:yt(d.writtenAt),contentPath:C(d.contentPath)})).filter(d=>d.id&&d.sourceFolder&&d.contentPath);return{folders:l.filter(pe).map(d=>({folder:C(d.folder),folderCode:C(d.folderCode)||null,folderDate:C(d.folderDate)||null,count:typeof d.count=="number"&&Number.isFinite(d.count)?d.count:0,ids:Ke(d.ids)})).filter(d=>d.folder),docs:u}}function Bt({onExit:n,archiveFontFamily:a="",diaryContentFontSize:l=14,diaryLineHeight:u=2.16}){const[o,d]=r.useState(null),[M,L]=r.useState(""),[x,qe]=r.useState("tl"),[w,Ve]=r.useState("desc"),[F,Ze]=r.useState(!1),[ye,je]=r.useState(""),[O,J]=r.useState(!1),[N,Ce]=r.useState(!1),[et,q]=r.useState(!1),[R,K]=r.useState(!1),[V,E]=r.useState(!1),[Z,ee]=r.useState(null),[te,se]=r.useState(null),[ne,we]=r.useState(null),[ae,tt]=r.useState({}),[Se,ke]=r.useState(null),[re,_]=r.useState(""),[$e,le]=r.useState(!1),[H,Me]=r.useState(!1),[Fe,ie]=r.useState(!1),[y,Re]=r.useState(null),[h,g]=r.useState(()=>It(l,u)),[oe,ce]=r.useState({homeChibi:!1,readingChibi:!1,related:!1}),j=r.useRef(null),de=r.useRef(new Set),ue=r.useRef(null),Ee=r.useRef(null),st=r.useMemo(()=>Tt(),[]),[nt]=r.useState(()=>{const e=pt("archive"),s=xt();if(!e.length)return Ue(s)??Le;const i=Math.min(s.length,Math.max(1,Math.round(e.length*3/7))),p=X([...e,...s.slice(0,i)]);return Ue(p)??Le});r.useEffect(()=>{zt(h)},[h]),r.useEffect(()=>{F&&Ee.current?.focus()},[F]),r.useEffect(()=>{let e=!0;return fetch(gt,{cache:"no-store"}).then(s=>{if(!s.ok)throw new Error(`HTTP ${s.status}`);return s.json()}).then(s=>{e&&d(Lt(s))}).catch(s=>{e&&L(s instanceof Error?s.message:String(s))}),()=>{e=!1}},[]),r.useEffect(()=>()=>{j.current!==null&&window.clearTimeout(j.current)},[]);const A=r.useMemo(()=>{const e=new Map;for(const s of o?.docs??[])e.set(s.id,s);return e},[o]),m=r.useMemo(()=>o?o.folders.map(s=>{const i=s.ids.map(f=>A.get(f)).filter(f=>!!f).map(f=>({id:f.id,title:f.title,ext:jt(f.sourceRelPath),sourceRelPath:f.sourceRelPath,routes:f.routes,tags:At(f.routes),writtenAt:f.writtenAt,contentPath:f.contentPath})),p=X(i.flatMap(f=>f.routes));return{key:s.folder,label:$t(s.folder,s.folderCode),date:s.folderDate,short:Mt(s.folderDate),year:Ft(s.folderDate,s.folder),cats:Et(p),docs:i}}).filter(s=>s.docs.length>0).sort(w==="asc"?Ye:ge):[],[A,w,o]),W=ye.trim().toLowerCase(),Ae=r.useMemo(()=>W?m.filter(e=>[e.label,e.short,...e.cats,...e.docs.map(i=>i.title),...e.docs.flatMap(i=>i.tags)].join(`
`).toLowerCase().includes(W)):m,[m,W]),T=r.useMemo(()=>{const e=new Map;for(const s of m)e.set(s.key,s);return e},[m]),Te=r.useMemo(()=>{const e=new Map;for(const s of Ae){const i=e.get(s.year)??[];i.push(s),e.set(s.year,i)}return Array.from(e.entries()).sort(([s],[i])=>w==="asc"?Ge(i,s):Ge(s,i)).map(([s,i])=>({year:s,folders:i.sort(w==="asc"?Ye:ge)}))},[w,Ae]),B=r.useMemo(()=>{const e=[];for(const s of m)for(const i of s.docs)e.push({folderKey:s.key,docId:i.id});return e},[m]),c=r.useMemo(()=>Z?T.get(Z)??null:null,[Z,T]),S=r.useMemo(()=>{if(!c)return null;const e=m.findIndex(s=>s.key===c.key);return e<0?null:m[e+1]??null},[c,m]),k=r.useMemo(()=>{if(!c)return null;const e=m.findIndex(s=>s.key===c.key);return e<0?null:m[e-1]??null},[c,m]),P=r.useMemo(()=>!c||!te?-1:c.docs.findIndex(e=>e.id===te),[te,c]),b=r.useMemo(()=>!c||P<0?null:c.docs[P]??null,[P,c]),I=r.useMemo(()=>{if(!y)return null;const e=T.get(y.folderKey),s=y.docId?A.get(y.docId):null;return!e||!s?null:{folder:e,doc:s}},[y,A,T]),$=r.useMemo(()=>ne?T.get(ne)??null:null,[ne,T]),Pe=vt[h.lineHeight],Y=b?ae[b.id]??"":"",De=h.fontMode==="archive"&&!!a.trim()?a.trim():"var(--app-font-family, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif)",_e=!!k?.docs.length,He=!!S?.docs.length,at=h.relatedMode==="prev-folder"?"ä¸Šè³‡æ–™å¤¾":"ä¸‹è³‡æ–™å¤¾",rt=N?h.showReadingChibi:h.showHomeChibi,lt=N?h.readingChibiWidth:h.homeChibiWidth,it=x==="crystal"&&!O&&!N,D=r.useCallback(async e=>{const s=A.get(e);if(s&&ae[e]===void 0&&!de.current.has(e)){de.current.add(e),ke(e),_("");try{const i=await fetch(`${Ne}data/master-pool/${s.contentPath}`,{cache:"no-store"});if(!i.ok)throw new Error(`HTTP ${i.status}`);const p=await i.text();tt(f=>({...f,[e]:p.replace(/\r\n?/g,`
`).trim()}))}catch(i){_(i instanceof Error?i.message:String(i))}finally{de.current.delete(e),ke(i=>i===e?null:i)}}},[ae,A]),ot=r.useCallback(e=>{ee(e),J(!0)},[]),he=r.useCallback(()=>{J(!1)},[]),G=r.useCallback((e,s)=>{ee(e),se(s),Ce(!0),q(!1),_(""),D(s)},[D]),fe=r.useCallback(()=>{K(!1),Ce(!1),q(!1)},[]),z=r.useCallback(e=>{if(!c||P<0)return;const s=P+e;if(s<0||s>=c.docs.length)return;const i=c.docs[s];se(i.id),_(""),D(i.id)},[P,c,D]),Ie=r.useCallback(e=>{const s=e===-1?k:S;if(!s||!s.docs.length)return;const i=s.docs[0];ee(s.key),se(i.id),_(""),D(i.id)},[D,S,k]),ct=r.useCallback(e=>{const s=e.touches[0];s&&(ue.current={x:s.clientX,y:s.clientY})},[]),dt=r.useCallback(e=>{const s=ue.current;if(ue.current=null,!s)return;const i=e.changedTouches[0];if(!i)return;const p=i.clientX-s.x,f=i.clientY-s.y;Math.abs(p)<36||Math.abs(p)<Math.abs(f)*1.15||z(p<0?1:-1)},[z]),ut=r.useCallback(()=>{if(!c||!N)return;const e=h.relatedMode==="prev-folder"?k:S;we(e?e.key:null),K(!0)},[c,S,h.relatedMode,k,N]),U=r.useCallback(()=>{K(!1)},[]),ze=r.useCallback(e=>{qe(e),e==="crystal"&&(J(!1),K(!1))},[]),ht=r.useCallback(()=>{if($e||H||!B.length)return;const e=B[Math.floor(Math.random()*B.length)];Re(e),le(!0),ie(!0),j.current!==null&&window.clearTimeout(j.current),j.current=window.setTimeout(()=>{ie(!1),Me(!0),le(!1),j.current=null},1100)},[B,H,$e]),ft=r.useCallback(()=>{j.current!==null&&(window.clearTimeout(j.current),j.current=null),le(!1),ie(!1),Me(!1),Re(null)},[]),mt=r.useCallback(()=>{y&&G(y.folderKey,y.docId)},[y,G]);return r.useEffect(()=>{if(!R||!c)return;const e=h.relatedMode==="prev-folder"?k:S;we(e?e.key:null)},[c,R,S,h.relatedMode,k]),r.useEffect(()=>{const e=s=>{if(s.key==="Escape"){if(V){E(!1);return}if(R){U();return}if(N){fe();return}O&&he();return}N&&(s.key==="ArrowLeft"?z(-1):s.key==="ArrowRight"&&z(1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[he,U,fe,O,R,z,N,V]),t.jsx("div",{className:"archive-page",children:t.jsxs("div",{className:"archive-app",children:[t.jsxs("div",{className:"tab-bar",style:{background:x==="crystal"?"#12102a":"#f5f0e6"},children:[t.jsx("button",{type:"button",className:`tab-side-btn ${x==="crystal"?"dark":""}`,onClick:n,"aria-label":"è¿”å›é¦–é ",title:"è¿”å›é¦–é ",children:"â€¹"}),t.jsx("button",{type:"button",className:`tab ${x==="tl"?"active":""}`,onClick:()=>ze("tl"),style:{color:x==="crystal"?"rgba(160,150,210,.3)":void 0},children:"ğŸ—‚ æ™‚é–“æµ"}),t.jsx("button",{type:"button",className:`tab ${x==="crystal"?"c-active active":""}`,onClick:()=>ze("crystal"),style:{color:x==="crystal"?"rgba(200,190,255,.8)":void 0},children:"ğŸ”® æ°´æ™¶çƒ"}),t.jsx("button",{type:"button",className:`tab-side-btn dots ${x==="crystal"?"dark":""}`,onClick:()=>E(!0),"aria-label":"é–‹å•Ÿç¸½æ”¬è¨­å®š",children:"â‹¯"})]}),t.jsx("div",{id:"view-tl",className:x==="tl"?"":"hidden",children:t.jsxs("div",{className:"tl-inner",children:[t.jsxs("div",{className:"tl-sort-row",children:[t.jsx("button",{type:"button",className:"tl-sort-btn active",onClick:()=>Ve(e=>e==="asc"?"desc":"asc"),"aria-label":w==="asc"?"ç›®å‰æ­£åºï¼Œé»æ“Šåˆ‡æ›å€’åº":"ç›®å‰å€’åºï¼Œé»æ“Šåˆ‡æ›æ­£åº",title:w==="asc"?"é»æ“Šåˆ‡æ›å€’åº":"é»æ“Šåˆ‡æ›æ­£åº",children:w==="asc"?"â–² æ­£åº":"â–¼ å€’åº"}),t.jsx("button",{type:"button",className:`tl-sort-btn tl-search-btn ${F?"active":""}`,onClick:()=>Ze(e=>{const s=!e;return s||je(""),s}),"aria-label":F?"é—œé–‰æœå°‹":"é–‹å•Ÿæœå°‹",title:F?"é—œé–‰æœå°‹":"é–‹å•Ÿæœå°‹",children:"âŒ•"})]}),F?t.jsx("div",{className:"tl-search-row",children:t.jsx("input",{ref:Ee,className:"tl-search-input",value:ye,onChange:e=>je(e.target.value),placeholder:"æœå°‹è³‡æ–™å¤¾ã€æ¨™ç±¤æˆ–æª”æ¡ˆæ¨™é¡Œ","aria-label":"æœå°‹ç¸½æ”¬è³‡æ–™å¤¾"})}):null,M&&t.jsxs("div",{className:"empty-state",children:["ç„¡æ³•è¼‰å…¥è³‡æ–™ï¼š",M]}),!o&&!M&&t.jsx("div",{className:"empty-state",children:"è¼‰å…¥ä¸­â‹¯"}),o&&!Te.length&&t.jsx("div",{className:"empty-state",children:W?"æ‰¾ä¸åˆ°ç¬¦åˆæœå°‹çš„è³‡æ–™å¤¾":"ç›®å‰æ²’æœ‰å¯é¡¯ç¤ºçš„è³‡æ–™å¤¾"}),Te.map(e=>t.jsxs("div",{className:"year-block",children:[t.jsxs("div",{className:"year-marker",children:[t.jsx("div",{className:"year-num",children:e.year}),t.jsx("div",{className:"year-line"})]}),e.folders.map((s,i)=>{const p=We(s.date),f=i>0?We(e.folders[i-1]?.date??null):null,bt=i===0||p!==f;return t.jsxs("div",{children:[bt?t.jsxs("div",{className:"month-marker",children:[t.jsx("span",{className:"month-label",children:Rt(s.date)}),t.jsx("span",{className:"month-line"})]}):null,t.jsxs("button",{type:"button",className:"folder-row",onClick:()=>ot(s.key),children:[t.jsxs("div",{className:"fr-main",children:[t.jsxs("div",{className:"fr-top",children:[t.jsx("span",{className:"fr-label",children:s.label}),t.jsx("span",{className:"fr-date",children:s.short})]}),t.jsx("div",{className:"fr-tags",children:s.cats.map(me=>t.jsx("span",{className:`cat-tag ${Oe[me]??"ct-other"}`,children:me},`${s.key}-${me}`))})]}),t.jsxs("div",{className:"fr-right",children:[t.jsxs("span",{className:"fr-count",children:[s.docs.length," ä»½"]}),t.jsx("span",{className:"fr-arrow",children:"â€º"})]})]})]},s.key)})]},e.year))]})}),t.jsxs("div",{id:"view-crystal",className:x==="crystal"?"active":"",children:[t.jsx("div",{className:"c-stars",children:st.map(e=>t.jsx("span",{className:"star",style:{left:e.left,top:e.top,width:`${e.size}px`,height:`${e.size}px`,opacity:e.opacity,animationDuration:`${e.duration}s`,animationDelay:`${e.delay}s`}},e.id))}),t.jsxs("div",{className:`crystal-prompt ${H||Fe?"hidden":""}`,children:["è¼•è§¸æ°´æ™¶çƒ",t.jsx("br",{}),"çªºè¦‹éå»çš„ç¢ç‰‡"]}),t.jsxs("div",{className:"ball-wrap",children:[t.jsx("button",{type:"button",className:`crystal-ball ${Fe?"spinning":""} ${H?"revealed":""}`,onClick:ht,children:t.jsxs("div",{className:"ball-inner",children:[t.jsx("div",{className:"fog f1"}),t.jsx("div",{className:"fog f2"}),t.jsx("div",{className:"fog f3"}),t.jsx("div",{className:"fog f4"}),t.jsxs("div",{className:"vision-text",children:[t.jsx("div",{className:"v-tag",children:I?`${I.folder.label} Â· ${I.folder.short}`:""}),t.jsx("div",{className:"v-title",children:I?.doc.title??""}),t.jsx("div",{className:"v-ext",children:I?.doc.sourceRelPath.split(".").pop()?.toUpperCase()??""})]})]})}),t.jsx("div",{className:"ball-shadow"})]}),t.jsxs("div",{className:`crystal-actions ${H?"visible":""}`,children:[t.jsx("button",{type:"button",className:"enter-btn",onClick:mt,children:"é€²å…¥é€™æ®µè¨˜æ†¶ â†’"}),t.jsx("button",{type:"button",className:"again-btn",onClick:ft,children:"ğŸ”® å†çœ‹ä¸€æ¬¡"})]})]}),t.jsxs("div",{className:`folder-panel ${O?"":"off-right"}`,children:[t.jsxs("div",{className:"fp-hdr",children:[t.jsx("button",{type:"button",className:"back-btn",onClick:he,children:"â€¹"}),t.jsx("div",{className:"fp-title",children:c?.label??"è³‡æ–™å¤¾"}),t.jsx("div",{className:"fp-meta",children:c?`${c.short} Â· ${c.docs.length} ä»½`:"â€”"}),t.jsx("button",{type:"button",className:"fp-menu-btn",onClick:()=>E(!0),"aria-label":"é–‹å•Ÿç¸½æ”¬è¨­å®š",children:"â‹¯"})]}),t.jsxs("div",{className:"fp-body",children:[t.jsx("div",{className:"fp-section-label",children:"æ‰€æœ‰æ–‡ä»¶"}),c?.docs.map(e=>t.jsxs("button",{type:"button",className:"fp-file-item",onClick:()=>G(c.key,e.id),children:[t.jsx("div",{className:`fp-file-icon ${e.ext}`,children:e.ext==="docx"?"ğŸ“„":"ğŸ“ƒ"}),t.jsxs("div",{className:"fp-file-info",children:[t.jsx("div",{className:"fp-file-name",children:e.title}),t.jsx("div",{className:"fp-file-sub",children:Be(e.writtenAt)})]}),t.jsx("div",{className:"fp-file-right",children:t.jsx("div",{className:"fp-file-tags",children:e.tags.map(s=>t.jsx("span",{className:`cat-tag fp-file-tag ${Oe[s]??"ct-other"}`,children:s},`${e.id}-${s}`))})})]},e.id)),c&&!c.docs.length&&t.jsx("div",{className:"empty-state",children:"æ­¤è³‡æ–™å¤¾ç›®å‰æ²’æœ‰æª”æ¡ˆ"})]})]}),t.jsxs("div",{className:`reading-panel ${N?"":"off-right"}`,children:[t.jsxs("div",{className:"read-hdr",children:[t.jsx("button",{type:"button",className:"back-btn",onClick:fe,children:"â€¹"}),t.jsx("div",{className:"read-crumb",children:c&&b?`${c.label} â€º ${b.title}`:""}),t.jsxs("div",{className:"read-tools",children:[t.jsx("button",{type:"button",className:`read-mini-btn ${_e?"":"disabled"}`,onClick:()=>Ie(-1),disabled:!_e,"aria-label":"ä¸Šä¸€è³‡æ–™å¤¾ç¬¬ä¸€å°",children:"â€¹"}),t.jsxs("button",{type:"button",className:"folder-nav-btn",onClick:ut,children:[at," â˜°"]}),t.jsx("button",{type:"button",className:`read-mini-btn ${He?"":"disabled"}`,onClick:()=>Ie(1),disabled:!He,"aria-label":"ä¸‹ä¸€è³‡æ–™å¤¾ç¬¬ä¸€å°",children:"â€º"}),t.jsx("button",{type:"button",className:"read-aa-btn",onClick:()=>q(e=>!e),"aria-label":"é–‹å•Ÿé–±è®€å­—é«”è¨­å®š",title:"é–±è®€å­—é«”è¨­å®š",children:"Aa"}),t.jsx("button",{type:"button",className:"read-menu-btn",onClick:()=>E(!0),"aria-label":"é–‹å•Ÿç¸½æ”¬è¨­å®š",children:"â‹¯"})]})]}),et?t.jsxs("div",{className:"read-font-panel",children:[t.jsx("p",{className:"read-font-title",children:"å­—é«”ä¾†æº"}),t.jsxs("div",{className:"read-font-row",children:[t.jsx("button",{type:"button",className:`read-font-mode-btn ${h.fontMode==="default"?"active":""}`,onClick:()=>g(e=>({...e,fontMode:"default"})),children:"é è¨­"}),t.jsx("button",{type:"button",className:`read-font-mode-btn ${h.fontMode==="archive"?"active":""}`,onClick:()=>g(e=>({...e,fontMode:"archive"})),children:"è·Ÿéš¨ç¸½æ”¬"})]}),t.jsxs("div",{className:"read-font-control",children:[t.jsxs("div",{className:"read-font-control-head",children:[t.jsx("p",{className:"read-font-title",children:"å­—ç´š"}),t.jsxs("p",{className:"read-font-value",children:[h.readingFontSize.toFixed(1),"px"]})]}),t.jsx("input",{type:"range",min:11,max:22,step:.5,value:h.readingFontSize,onChange:e=>g(s=>({...s,readingFontSize:ve(Number(e.target.value),s.readingFontSize)})),className:"read-font-slider"})]}),t.jsxs("div",{className:"read-font-control",children:[t.jsxs("div",{className:"read-font-control-head",children:[t.jsx("p",{className:"read-font-title",children:"è¡Œè·"}),t.jsx("p",{className:"read-font-value",children:Pe.toFixed(2)})]}),t.jsx("div",{className:"read-font-row",children:Nt.map(e=>t.jsx("button",{type:"button",className:`read-font-mode-btn ${h.lineHeight===e.key?"active":""}`,onClick:()=>g(s=>({...s,lineHeight:e.key})),children:e.label},`read-font-line-${e.key}`))})]})]}):null,t.jsx("div",{className:"read-body",onTouchStart:ct,onTouchEnd:dt,children:t.jsxs("div",{className:"doc-paper",children:[t.jsx("div",{className:"doc-title",style:{fontFamily:De,fontSize:"var(--ui-header-title-size, 17px)"},children:b?.title??""}),t.jsx("div",{className:"doc-meta",style:{fontSize:"var(--ui-hint-text-size, 9px)"},children:c&&b?`${c.label} Â· ${Be(b.writtenAt)} Â· ${b.ext.toUpperCase()}`:""}),re&&t.jsxs("div",{className:"doc-placeholder",children:["è®€å–å¤±æ•—ï¼š",re]}),Se===b?.id&&!Y&&t.jsx("div",{className:"doc-placeholder",children:"è®€å–ä¸­â‹¯"}),!re&&b&&Se!==b.id&&!Y&&t.jsx("div",{className:"doc-placeholder",children:"æ­¤æª”æ¡ˆç›®å‰æ²’æœ‰å¯è®€å…§å®¹ã€‚"}),!!Y&&t.jsx("div",{className:"doc-content",style:{fontFamily:De,fontSize:`${h.readingFontSize}px`,lineHeight:Pe},children:Y})]})})]}),rt?t.jsx("div",{className:`chibi-float ${it?"dark":""}`,children:t.jsx("button",{type:"button",className:"chibi-float-btn",onClick:()=>E(!0),title:"é–‹å•Ÿç¸½æ”¬è¨­å®š","aria-label":"é–‹å•Ÿç¸½æ”¬è¨­å®š",children:t.jsx("img",{src:nt,alt:"",draggable:!1,className:"calendar-chibi select-none",style:{width:lt,height:"auto"}})})}):null,V?t.jsx("div",{className:"archive-settings-overlay",onClick:()=>E(!1),children:t.jsxs("div",{className:"archive-settings-sheet",onClick:e=>e.stopPropagation(),children:[t.jsx("div",{className:"archive-sheet-handle"}),t.jsxs(be,{title:"M",subtitle:"ç¸½æ”¬é¦–é èˆ‡æ¸…å–®é ",isOpen:oe.homeChibi,onToggle:()=>ce(e=>({...e,homeChibi:!e.homeChibi})),className:"archive-sheet-section",titleClassName:"archive-sheet-label",subtitleClassName:"archive-sheet-subtitle",chevronClassName:"archive-sheet-chevron",bodyClassName:"mt-2",children:[t.jsxs("div",{className:"archive-toggle-row",children:[t.jsx("span",{children:"M"}),t.jsx("button",{type:"button",className:`archive-switch ${h.showHomeChibi?"on":""}`,onClick:()=>g(e=>({...e,showHomeChibi:!e.showHomeChibi})),"aria-label":"åˆ‡æ›ç¸½æ”¬é¦–é èˆ‡æ¸…å–®é Mé¡¯ç¤º",children:t.jsx("span",{})})]}),t.jsx("label",{className:"archive-range-row",children:t.jsx("input",{type:"range",min:96,max:186,step:1,value:h.homeChibiWidth,onChange:e=>g(s=>({...s,homeChibiWidth:Q(Number(e.target.value),s.homeChibiWidth)}))})})]}),t.jsxs(be,{title:"é–±è®€M",subtitle:"é–±è®€é é¡¯ç¤ºèˆ‡å¤§å°",isOpen:oe.readingChibi,onToggle:()=>ce(e=>({...e,readingChibi:!e.readingChibi})),className:"archive-sheet-section",titleClassName:"archive-sheet-label",subtitleClassName:"archive-sheet-subtitle",chevronClassName:"archive-sheet-chevron",bodyClassName:"mt-2",children:[t.jsxs("div",{className:"archive-toggle-row",children:[t.jsx("span",{children:"M"}),t.jsx("button",{type:"button",className:`archive-switch ${h.showReadingChibi?"on":""}`,onClick:()=>g(e=>({...e,showReadingChibi:!e.showReadingChibi})),"aria-label":"åˆ‡æ›é–±è®€é Mé¡¯ç¤º",children:t.jsx("span",{})})]}),t.jsx("label",{className:"archive-range-row",children:t.jsx("input",{type:"range",min:96,max:186,step:1,value:h.readingChibiWidth,onChange:e=>g(s=>({...s,readingChibiWidth:Q(Number(e.target.value),s.readingChibiWidth)}))})})]}),t.jsx(be,{title:"ç›¸é—œé–±è®€",subtitle:"ä¸Šè³‡æ–™å¤¾/ä¸‹è³‡æ–™å¤¾",isOpen:oe.related,onToggle:()=>ce(e=>({...e,related:!e.related})),className:"archive-sheet-section",titleClassName:"archive-sheet-label",subtitleClassName:"archive-sheet-subtitle",chevronClassName:"archive-sheet-chevron",bodyClassName:"mt-2",children:t.jsxs("div",{className:"archive-pill-group",children:[t.jsx("button",{type:"button",className:`archive-pill ${h.relatedMode==="prev-folder"?"active":""}`,onClick:()=>g(e=>({...e,relatedMode:"prev-folder"})),children:"ä¸Šè³‡æ–™å¤¾"}),t.jsx("button",{type:"button",className:`archive-pill ${h.relatedMode==="next-folder"?"active":""}`,onClick:()=>g(e=>({...e,relatedMode:"next-folder"})),children:"ä¸‹è³‡æ–™å¤¾"})]})})]})}):null,t.jsx("div",{className:`sheet-overlay ${R?"open":""}`,onClick:U}),t.jsxs("div",{className:`folder-sheet ${R?"open":""}`,children:[t.jsx("div",{className:"sheet-handle"}),t.jsx("div",{className:"sheet-folder-title",children:$?`${$.label} Â· ${$.short}`:h.relatedMode==="prev-folder"?"ä¸Šè³‡æ–™å¤¾ï¼ˆç›®å‰æ²’æœ‰ï¼‰":"ä¸‹è³‡æ–™å¤¾ï¼ˆç›®å‰æ²’æœ‰ï¼‰"}),t.jsx("div",{className:"sheet-list",children:$?.docs.length?$.docs.map(e=>t.jsx("button",{type:"button",className:`sheet-file-item ${e.id===b?.id?"current":""}`,onClick:()=>{G($.key,e.id),U()},children:t.jsx("span",{className:"sf-name",children:e.title})},`sheet-${$.key}-${e.id}`)):t.jsx("p",{className:"sheet-empty",children:"ç›®å‰æ²’æœ‰å¯é¡¯ç¤ºé …ç›®"})})]})]})})}export{Bt as ArchivePage,Bt as default};
