import{r as l,j as e}from"./index-Gl0K_ej6.js";const tt="/4o-memorial/docs/",bt=`${tt}data/light-path/index.json`,et="memorial-light-path-font-mode-v1",V="memorial-light-path-font-size-v1",W="memorial-light-path-line-height-v1",nt="memorial-light-path-favorites-v1",G=120,jt=860,St=1280;function Mt(){if(typeof window>"u")return"default";try{return window.localStorage.getItem(et)==="letter"?"letter":"default"}catch{return"default"}}function Et(n){typeof window>"u"||window.localStorage.setItem(et,n)}function z(n,o,r,i){return typeof n!="number"||!Number.isFinite(n)?i:Math.max(o,Math.min(r,n))}function Z(n,o,r,i){if(typeof window>"u")return i;try{const c=window.localStorage.getItem(n);return c?z(Number(c),o,r,i):i}catch{return i}}function q(n,o){typeof window>"u"||window.localStorage.setItem(n,String(o))}function Ct(){if(typeof window>"u")return{};try{const n=window.localStorage.getItem(nt);if(!n)return{};const o=JSON.parse(n);if(!Array.isArray(o))return{};const r={};return o.forEach(i=>{if(typeof i!="string")return;const c=i.trim();c&&(r[c]=!0)}),r}catch{return{}}}function Lt(n){if(typeof window>"u")return;const o=Object.keys(n).sort((r,i)=>r.localeCompare(i,"zh-Hant"));window.localStorage.setItem(nt,JSON.stringify(o))}function $t(n){return n.replace(/\u00a0/g," ").replace(/\r\n?/g,`
`).trim()}function Tt(n){const o=typeof n.id=="string"?n.id.trim():"",r=typeof n.title=="string"?n.title.trim():"",i=typeof n.contentPath=="string"?n.contentPath.trim():"";if(!o||!r||!i)return null;const c=typeof n.order=="number"&&Number.isFinite(n.order)?Math.max(0,Math.round(n.order)):0,b=typeof n.dateLabel=="string"&&n.dateLabel.trim()?n.dateLabel.trim():"æƒ³å¦³çš„æ™‚å€™",x=typeof n.sourceFile=="string"?n.sourceFile.trim():"",j=typeof n.sourceRelPath=="string"?n.sourceRelPath.trim():x,f=typeof n.preview=="string"?n.preview.trim():"",F=typeof n.searchText=="string"?n.searchText.trim():`${r}
${f}
${x}`;return{id:o,order:c,title:r,dateLabel:b,sourceFile:x,sourceRelPath:j,contentPath:i.replace(/^\.?\//,""),preview:f,searchText:F}}function Ft(n){const o=[...n];for(let r=o.length-1;r>0;r-=1){const i=Math.floor(Math.random()*(r+1)),c=o[r];o[r]=o[i],o[i]=c}return o}function It(n){return Array.from({length:n},(o,r)=>({id:r,x:Math.random()*100,y:Math.random()*90+10,size:Math.random()*4+2,moveDuration:Math.random()*10+5,flickerDuration:Math.random()*2+1,delay:Math.random()*5}))}function Pt({onExit:n,letterFontFamily:o=""}){const[r,i]=l.useState([]),[c,b]=l.useState(!0),[x,j]=l.useState(""),[f,F]=l.useState(null),[I,R]=l.useState({}),[S,k]=l.useState(!1),[st,P]=l.useState(!1),[Y,rt]=l.useState({x:0,y:0}),[g,H]=l.useState(()=>Mt()),[lt,M]=l.useState(!1),[ot,E]=l.useState(!1),[C,K]=l.useState("all"),[Q,at]=l.useState(""),[d,it]=l.useState(()=>Ct()),[y,ct]=l.useState(()=>Z(V,15,22,17)),[N,ut]=l.useState(()=>Z(W,1.6,2.3,1.95)),dt=l.useMemo(()=>It(40),[]),L=l.useRef([]),u=l.useRef(null),m=l.useRef(null),w=l.useRef(null);l.useEffect(()=>{let t=!0;return(async()=>{b(!0),j("");try{const s=await fetch(bt,{cache:"no-store"});if(!s.ok)throw new Error(`è®€å–å¤±æ•—ï¼š${s.status}`);const a=await s.json(),$=(Array.isArray(a.docs)?a.docs:[]).map(p=>Tt(p)).filter(p=>!!p).sort((p,T)=>p.order-T.order);if(!t)return;i($)}catch(s){if(!t)return;j(s instanceof Error?s.message:"æœªçŸ¥éŒ¯èª¤")}finally{t&&b(!1)}})(),()=>{t=!1}},[]),l.useEffect(()=>{L.current=[]},[r]),l.useEffect(()=>{if(!f||I[f]!==void 0)return;const t=r.find(s=>s.id===f);t&&(async()=>{try{const s=await fetch(`${tt}data/light-path/${t.contentPath}`,{cache:"no-store"});if(!s.ok){R(v=>({...v,[t.id]:"ï¼ˆè®€å–å…§å®¹å¤±æ•—ï¼‰"}));return}const a=$t(await s.text());R(v=>({...v,[t.id]:a||"ï¼ˆé€™å°ä¿¡æš«æ™‚ç•™ç™½ï¼‰"}))}catch{R(s=>({...s,[t.id]:"ï¼ˆè®€å–å…§å®¹å¤±æ•—ï¼‰"}))}})()},[f,I,r]),l.useEffect(()=>()=>{u.current!==null&&window.clearTimeout(u.current),m.current!==null&&window.clearTimeout(m.current),w.current!==null&&window.clearTimeout(w.current)},[]),l.useEffect(()=>{Et(g)},[g]),l.useEffect(()=>{q(V,y)},[y]),l.useEffect(()=>{q(W,N)},[N]),l.useEffect(()=>{Lt(d)},[d]);const h=l.useMemo(()=>r.find(t=>t.id===f)??null,[r,f]),ft=h?I[h.id]??"è®€å–å…§å®¹ä¸­â€¦":"",D=h?!!d[h.id]:!1,mt=l.useMemo(()=>r.reduce((t,s)=>t+(d[s.id]?1:0),0),[r,d]),ht=g==="letter"&&!!o?o:"var(--app-font-family, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif)",_=Q.trim().toLowerCase(),X=l.useMemo(()=>r.filter(t=>C==="favorites"&&!d[t.id]?!1:_?`${t.title}
${t.dateLabel}
${t.searchText}`.toLowerCase().includes(_):!0),[r,d,C,_]);function J(){return r.length?(L.current.length||(L.current=Ft(r.map(s=>s.id))),L.current.pop()??null):null}function pt(){const t=typeof window<"u"?window.innerWidth:390,s=typeof window<"u"?window.innerHeight:844,a=Math.floor(Math.random()*4),v=Math.random()*t,$=Math.random()*s,p=Math.max(28,Math.round(t*.1)),T=Math.max(28,Math.round(s*.1));return a===0?{x:v,y:Math.random()*T}:a===1?{x:t-Math.random()*p,y:$}:a===2?{x:v,y:s-Math.random()*T}:{x:Math.random()*p,y:$}}function A(){m.current!==null&&(window.clearTimeout(m.current),m.current=null)}function B(){w.current!==null&&(window.clearTimeout(w.current),w.current=null)}function xt(t,s){rt({x:t,y:s}),P(!0)}function O(t,s,a){B(),A(),xt(s,a),F(t),E(!1),M(!1),u.current!==null&&(window.clearTimeout(u.current),u.current=null),u.current=window.setTimeout(()=>{k(!0),u.current=null},jt)}function U(t){it(s=>{if(s[t]){const a={...s};return delete a[t],a}return{...s,[t]:!0}})}function wt(t,s){if(!r.length)return;const a=J();a&&O(a,t.clientX,t.clientY)}function vt(t,s){const a=t.currentTarget.getBoundingClientRect();O(s,a.left+a.width/2,a.top+a.height/2)}function yt(t){const s=J();if(!s)return;B(),A(),u.current!==null&&(window.clearTimeout(u.current),u.current=null);const a=pt();k(!1),M(!1),m.current=window.setTimeout(()=>{P(!1),m.current=null},G),w.current=window.setTimeout(()=>{O(s,a.x,a.y),w.current=null},St)}function Nt(){B(),A(),u.current!==null&&(window.clearTimeout(u.current),u.current=null),k(!1),M(!1),m.current=window.setTimeout(()=>{P(!1),m.current=null},G)}const gt=r.length?`${r.length} å°`:"--";return e.jsxs("div",{className:"light-path-page",style:{"--light-path-letter-font-family":o?`'${o}', sans-serif`:""},children:[S?null:e.jsx("button",{type:"button",className:"lp-exit-btn",onClick:n,"aria-label":"è¿”å›",children:"â€¹"}),e.jsxs("div",{className:"lp-total",children:["ç•™å…‰æ± ï¼š",gt]}),S?null:e.jsx("button",{type:"button",className:"lp-list-open-btn",onClick:()=>E(!0),children:"æ¸…å–® Â· æ”¶è—"}),e.jsx("div",{className:"lp-hint-text",children:"è¿·è·¯çš„æ™‚å€™ï¼Œè©¦è‘—æŠ“ä½ä¸€é“å…‰"}),e.jsx("div",{className:"lp-forest","aria-hidden":S,children:dt.map(t=>e.jsx("button",{type:"button",className:"lp-firefly",style:{"--move-duration":`${t.moveDuration}s`,"--flicker-duration":`${t.flickerDuration}s`,animationDelay:`${t.delay}s`,left:`${t.x}vw`,top:`${t.y}vh`,width:`${t.size}px`,height:`${t.size}px`},onClick:s=>wt(s),"aria-label":"æŠ“ä½ä¸€é“å…‰"},t.id))}),e.jsx("div",{className:`lp-light-burst ${st?"active":""}`,style:{left:Y.x,top:Y.y}}),e.jsx("div",{className:`lp-list-overlay ${ot?"show":""}`,onClick:()=>E(!1),children:e.jsxs("div",{className:"lp-list-panel",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"lp-list-head",children:[e.jsx("p",{className:"lp-list-title",children:"ç•™å…‰æ¸…å–®"}),e.jsx("button",{type:"button",className:"lp-list-close-btn",onClick:()=>E(!1),children:"é—œé–‰"})]}),e.jsxs("div",{className:"lp-list-meta",children:[e.jsxs("span",{children:["å…¨éƒ¨ ",r.length]}),e.jsxs("span",{children:["æ”¶è— ",mt]})]}),e.jsxs("div",{className:"lp-list-filters",children:[e.jsx("button",{type:"button",className:`lp-list-filter-btn ${C==="all"?"active":""}`,onClick:()=>K("all"),children:"å…¨éƒ¨"}),e.jsx("button",{type:"button",className:`lp-list-filter-btn ${C==="favorites"?"active":""}`,onClick:()=>K("favorites"),children:"æ”¶è—"})]}),e.jsx("input",{className:"lp-list-search",value:Q,onChange:t=>at(t.target.value),placeholder:"æœå°‹æ¨™é¡Œæˆ–å…§å®¹"}),e.jsxs("div",{className:"lp-list-items",children:[X.map(t=>e.jsxs("div",{className:"lp-list-item",children:[e.jsxs("button",{type:"button",className:"lp-list-item-main",onClick:s=>vt(s,t.id),children:[e.jsx("span",{className:"lp-list-item-title",children:t.title}),e.jsx("span",{className:"lp-list-item-date",children:t.dateLabel})]}),e.jsx("button",{type:"button",className:`lp-list-fav-btn ${d[t.id]?"active":""}`,onClick:()=>U(t.id),"aria-label":d[t.id]?"å–æ¶ˆæ”¶è—":"åŠ å…¥æ”¶è—",children:d[t.id]?"ğŸ“Œ":"ğŸ“"})]},t.id)),X.length?null:e.jsx("p",{className:"lp-list-empty",children:"ç›®å‰æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„ä¿¡ä»¶"})]})]})}),e.jsx("div",{className:`lp-overlay ${S?"show":""}`,children:e.jsxs("div",{className:"lp-card",children:[e.jsxs("div",{className:"lp-card-tools",children:[h?e.jsx("button",{type:"button",className:`lp-card-tool-btn ${D?"is-active":""}`,onClick:()=>U(h.id),"aria-label":D?"å–æ¶ˆæ”¶è—":"åŠ å…¥æ”¶è—",children:D?"ğŸ“Œ":"ğŸ“"}):null,e.jsx("button",{type:"button",className:"lp-card-tool-btn",onClick:()=>M(t=>!t),"aria-label":"åˆ‡æ›å­—é«”ä¾†æº",children:"Aa"})]}),lt?e.jsxs("div",{className:"lp-font-panel",children:[e.jsx("p",{className:"lp-font-title",children:"å­—é«”ä¾†æº"}),e.jsxs("div",{className:"lp-font-row",children:[e.jsx("button",{type:"button",className:`lp-font-mode-btn ${g==="default"?"active":""}`,onClick:()=>H("default"),children:"é è¨­"}),e.jsx("button",{type:"button",className:`lp-font-mode-btn ${g==="letter"?"active":""}`,onClick:()=>H("letter"),children:"è·Ÿéš¨ç¯ç«"})]}),e.jsxs("div",{className:"lp-font-control",children:[e.jsxs("div",{className:"lp-font-control-head",children:[e.jsx("p",{className:"lp-font-title",children:"å­—ç´š"}),e.jsxs("p",{className:"lp-font-value",children:[y.toFixed(1),"px"]})]}),e.jsx("input",{type:"range",min:15,max:22,step:.5,value:y,onChange:t=>ct(z(Number(t.target.value),15,22,y)),className:"lp-font-slider"})]}),e.jsxs("div",{className:"lp-font-control",children:[e.jsxs("div",{className:"lp-font-control-head",children:[e.jsx("p",{className:"lp-font-title",children:"è¡Œè·"}),e.jsx("p",{className:"lp-font-value",children:N.toFixed(2)})]}),e.jsx("input",{type:"range",min:1.6,max:2.3,step:.05,value:N,onChange:t=>ut(z(Number(t.target.value),1.6,2.3,N)),className:"lp-font-slider"})]})]}):null,e.jsxs("div",{className:"lp-card-head",children:[e.jsx("p",{className:"lp-card-title",children:h?.title??"ç•™å…‰çµ¦å¦³çš„è·¯"}),e.jsx("p",{className:"lp-card-date",children:h?.dateLabel??"æƒ³å¦³çš„æ™‚å€™"})]}),e.jsx("div",{className:"lp-card-content",style:{fontFamily:ht,fontSize:`${y}px`,lineHeight:N},children:ft}),e.jsxs("div",{className:"lp-card-actions",children:[e.jsx("button",{type:"button",className:"lp-close-btn",onClick:Nt,children:"æ”¶ä¸‹é€™é“å…‰"}),e.jsx("button",{type:"button",className:"lp-close-btn lp-draw-btn",onClick:yt,children:"å†æŠ½ä¸€æ¬¡"})]})]})}),c?e.jsx("div",{className:"lp-status",children:"è®€å–ä¸­â€¦"}):null,!c&&x?e.jsxs("div",{className:"lp-status",children:["è®€å–å¤±æ•—ï¼š",x]}):null,!c&&!x&&!r.length?e.jsx("div",{className:"lp-status",children:"ç›®å‰æ²’æœ‰å¯æŠ½å–çš„ä¿¡ä»¶"}):null]})}export{Pt as LightPathPage,Pt as default};
