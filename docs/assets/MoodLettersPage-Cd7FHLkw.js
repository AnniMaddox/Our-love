import{r as a,cx as Mt,j as n}from"./index-Gl0K_ej6.js";const Ae="/4o-memorial/docs/",wt=`${Ae}data/mood-letters/index.json`,Nt=`${Ae}chibi/chibi-00.webp`,v="all",Ze="memorial-mood-letters-prefs-v1",Ve="memorial-mood-letters-favorites-v1",pe="mlFav",et=11,tt=15,Ke=["255,182,162","255,170,145","255,156,186","234,166,216","198,166,250","161,205,255","150,230,235","166,226,176","243,214,138","255,206,156","201,196,242","180,228,255","243,186,222"],Je=[72,68,65,63,61,60,65,62,64,68,61,63,67],fe={moon:{label:"月光紙",paperBg:"#f4f8ff",titleColor:"#2f4c7b",bodyColor:"#2b4166",accentColor:"#5f7eb2",pillBg:"rgba(95, 126, 178, 0.12)",pillBorder:"rgba(95, 126, 178, 0.32)",pillText:"#496797"},cream:{label:"奶油紙",paperBg:"#fff1f6",titleColor:"#7a4360",bodyColor:"#60354a",accentColor:"#b06a8a",pillBg:"rgba(176, 106, 138, 0.15)",pillBorder:"rgba(176, 106, 138, 0.36)",pillText:"#8d5370"},mint:{label:"薄荷紙",paperBg:"#f4fff8",titleColor:"#36645a",bodyColor:"#34584e",accentColor:"#4e8b7e",pillBg:"rgba(88, 145, 132, 0.12)",pillBorder:"rgba(88, 145, 132, 0.28)",pillText:"#3f766a"},lavender:{label:"薰衣草紙",paperBg:"#faf7ff",titleColor:"#5e4f88",bodyColor:"#4f446d",accentColor:"#7e6ab0",pillBg:"rgba(116, 100, 170, 0.12)",pillBorder:"rgba(116, 100, 170, 0.28)",pillText:"#65549a"},peach:{label:"蜜桃紙",paperBg:"#fff5f0",titleColor:"#7a4a3f",bodyColor:"#5e4038",accentColor:"#b76754",pillBg:"rgba(180, 99, 81, 0.12)",pillBorder:"rgba(180, 99, 81, 0.28)",pillText:"#8e4f42"}},A={showChibi:!0,chibiWidth:144,orbCount:13,orbMode:"bounce",orbSpeed:1.25,fontMode:"default",contentFontSize:15,contentLineHeight:2.02,paperTheme:"moon"},jt=[{id:"bounce",label:"碰撞"},{id:"rise",label:"上浮"},{id:"pulse",label:"脈動漂流"}];function G(m,i,o,f){return typeof m!="number"||!Number.isFinite(m)?f:Math.max(i,Math.min(o,m))}function Ge(m,i,o,f){return Math.round(G(m,i,o,f))}function Ct(){if(typeof window>"u")return A;try{const m=window.localStorage.getItem(Ze);if(!m)return A;const i=JSON.parse(m),o=i.paperTheme,f=o&&o in fe?o:A.paperTheme,$=i.orbMode,ne=$==="bounce"||$==="rise"||$==="pulse"?$:A.orbMode,Y=i.fontMode,se=Y==="campfire"||Y==="default"?Y:A.fontMode;return{showChibi:i.showChibi!==!1,chibiWidth:Ge(i.chibiWidth,104,196,A.chibiWidth),orbCount:Ge(i.orbCount,et,tt,A.orbCount),orbMode:ne,orbSpeed:G(i.orbSpeed,.7,2.4,A.orbSpeed),fontMode:se,contentFontSize:G(i.contentFontSize,12,24,A.contentFontSize),contentLineHeight:G(i.contentLineHeight,1.35,2.9,A.contentLineHeight),paperTheme:f}}catch{return A}}function vt(m){typeof window>"u"||window.localStorage.setItem(Ze,JSON.stringify(m))}function St(){if(typeof window<"u")try{const m=new URL(window.location.href);if(m.searchParams.has(pe)){const i=m.searchParams.get(pe)??"";if(!i.trim())return new Set;const o=i.split(",").map(f=>f.trim()).filter(f=>f.length>0);return new Set(o)}}catch{}if(typeof window>"u")return new Set;try{const m=window.localStorage.getItem(Ve);if(!m)return new Set;const i=JSON.parse(m);return Array.isArray(i)?new Set(i.filter(o=>typeof o=="string"&&o.trim().length>0)):new Set}catch{return new Set}}function At(m){if(typeof window>"u")return;const i=Array.from(m);window.localStorage.setItem(Ve,JSON.stringify(i));try{const o=new URL(window.location.href);i.length?o.searchParams.set(pe,i.join(",")):o.searchParams.delete(pe);const f=`${o.pathname}${o.search}${o.hash}`;window.history.replaceState(window.history.state,"",f)}catch{}}function $t(m){return m.length?m[Math.floor(Math.random()*m.length)]??null:null}function kt(m){const i=[...m];for(let o=i.length-1;o>0;o-=1){const f=Math.floor(Math.random()*(o+1)),$=i[o];i[o]=i[f],i[f]=$}return i}function Ft(m){return m.replace(/\u00a0/g," ").replace(/\r\n?/g,`
`).trim()}function Lt(m){const i=new Date(m);return Number.isNaN(i.getTime())?"剛剛抽到":i.toLocaleString("zh-TW",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function Qe(m,i,o="全部"){return i===v?"全部":m?.categories.find($=>$.id===i)?.label||o}function Tt({onExit:m,letterFontFamily:i=""}){const[o,f]=a.useState(null),[$,ne]=a.useState(!0),[Y,se]=a.useState(""),[E,nt]=a.useState(v),[$e,be]=a.useState(""),[g,xe]=a.useState(null),[st,ae]=a.useState(!1),[at,W]=a.useState(!1),[ot,oe]=a.useState(!1),[re,ge]=a.useState("all"),[Q,ke]=a.useState(v),[ye,rt]=a.useState(""),[lt,Me]=a.useState(!1),[c,M]=a.useState(()=>Ct()),[L,Fe]=a.useState(()=>St()),[it,le]=a.useState(null),[P,Le]=a.useState(!1),[ct,Z]=a.useState(!1),[Pe]=a.useState(()=>{const e=Mt();return $t(e)??Nt}),Re=a.useRef({}),Te=a.useRef({}),ze=a.useRef(null),we=a.useRef([]),ie=a.useRef([]),U=a.useRef(null),I=a.useRef(null),ce=a.useRef(null),q=a.useRef(!1),w=a.useMemo(()=>Array.from({length:c.orbCount},(e,t)=>Ke[t%Ke.length]),[c.orbCount]),K=a.useMemo(()=>Array.from({length:c.orbCount},(e,t)=>Je[t%Je.length]??62),[c.orbCount]),dt=a.useMemo(()=>Array.from({length:92},()=>({left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,duration:`${2.1+Math.random()*4.2}s`,delay:`${-Math.random()*5}s`,size:Math.random()<.17?3:2})),[]),mt=a.useMemo(()=>Array.from({length:8},()=>({left:`${-20+Math.random()*20}%`,top:`${Math.random()*42}%`,duration:`${5.2+Math.random()*7.8}s`,delay:`${-Math.random()*9}s`})),[]),N=a.useMemo(()=>w.map((e,t)=>({size:K[t]??60,xPercent:11+Math.random()*78,yPercent:10+Math.random()*76,driftX:(18+Math.random()*34)*(Math.random()<.5?-1:1),driftY:(16+Math.random()*30)*(Math.random()<.5?-1:1),duration:1.18+Math.random()*1.48,delay:-Math.random()*1.8})),[w,K]),Be=a.useMemo(()=>{const e=new Map;if(!o)return e;for(const t of o.letters)e.set(t.id,t);return e},[o]),Ne=a.useMemo(()=>o?[...o.letters].sort((e,t)=>{const r=e.serial??Number.MAX_SAFE_INTEGER,l=t.serial??Number.MAX_SAFE_INTEGER;return r!==l?r-l:e.title.localeCompare(t.title,"zh-Hant")}):[],[o]),je=a.useMemo(()=>{const e={};if(!o)return e;e[v]=o.letters.length;for(const t of o.categories)e[t.id]=0;for(const t of o.letters)for(const r of t.moodIds)e[r]=(e[r]??0)+1;return e},[o]),ut=a.useMemo(()=>o?[{id:v,label:"全部",count:je[v]??o.letters.length},...o.categories.map(e=>({id:e.id,label:e.label,count:je[e.id]??0}))]:[{id:v,label:"全部",count:0}],[je,o]),ht=a.useMemo(()=>o?[{id:v,label:"全部"},...o.categories.map(e=>({id:e.id,label:e.label}))]:[{id:v,label:"全部"}],[o]),Ee=a.useMemo(()=>{const e={};if(!o)return e;e[v]=o.letters.map(t=>t.id);for(const t of o.categories)e[t.id]=o.letters.filter(r=>r.moodIds.includes(t.id)).map(r=>r.id);return e},[o]),Ie=a.useMemo(()=>{const e=re==="all"?Ne:Ne.filter(l=>L.has(l.id)),t=Q===v?e:e.filter(l=>l.moodIds.includes(Q)||l.primaryMoodId===Q),r=ye.trim().toLowerCase();return r?t.filter(l=>[l.title,l.displayName,l.subject??"",l.sourceFile??"",l.primaryMoodLabel,...Array.isArray(l.moodLabels)?l.moodLabels:[]].join(`
`).toLowerCase().includes(r)):t},[L,Q,ye,re,Ne]),O=fe[c.paperTheme];a.useEffect(()=>{let e=!0;return(async()=>{ne(!0),se("");try{const t=await fetch(wt,{cache:"no-store"});if(!t.ok)throw new Error(`讀取失敗：${t.status}`);const r=await t.json();if(!e)return;const l={version:Number(r?.version??1),generatedAt:typeof r?.generatedAt=="string"?r.generatedAt:"",total:Number(r?.total??0),categories:Array.isArray(r?.categories)?r.categories.filter(d=>typeof d?.id=="string"&&typeof d?.label=="string").map(d=>({id:d.id.trim(),label:d.label.trim()})):[],summary:r?.summary,letters:Array.isArray(r?.letters)?r.letters.filter(d=>typeof d?.id=="string"&&typeof d?.title=="string"&&typeof d?.contentPath=="string"&&Array.isArray(d?.moodIds)).map(d=>({...d,id:d.id.trim(),title:d.title.trim(),contentPath:d.contentPath.replace(/^\.?\//,""),moodIds:d.moodIds.filter(p=>typeof p=="string"&&p.trim().length>0).map(p=>p.trim())})):[]};f(l)}catch(t){if(!e)return;se(t instanceof Error?t.message:"未知錯誤")}finally{e&&ne(!1)}})(),()=>{e=!1}},[]),a.useEffect(()=>{vt(c)},[c]),a.useEffect(()=>{At(L)},[L]),a.useEffect(()=>{if(!o)return;const e=new Set(o.letters.map(t=>t.id));Fe(t=>{let r=!1;const l=new Set;for(const d of t){if(!e.has(d)){r=!0;continue}l.add(d)}return r?l:t})},[o]),a.useEffect(()=>()=>{I.current!==null&&(window.clearTimeout(I.current),I.current=null)},[]);const Oe=a.useCallback(async e=>{const t=Re.current[e.id];if(typeof t=="string")return t;const r=e.contentPath.replace(/^\.?\//,""),l=await fetch(`${Ae}data/mood-letters/${r}`,{cache:"no-store"});if(!l.ok)throw new Error(`讀取內容失敗：${l.status}`);const d=Ft(await l.text());return Re.current[e.id]=d,d},[]),_e=a.useCallback(e=>{const t=Ee[e]??[];if(!t.length)return null;const r=new Set(t);let l=(Te.current[e]??[]).filter(V=>r.has(V));l.length||(l=kt(t));const d=l.pop();if(Te.current[e]=l,!d)return null;const p=Be.get(d);return p?{letter:p,total:t.length,remaining:l.length}:null},[Ee,Be]),De=a.useCallback(e=>{Fe(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[]),Xe=a.useCallback(e=>{const t=we.current[e];if(!t)return;const r=t.getBoundingClientRect();if(!r.width||!r.height)return;const l=document.createElement("div");l.className="ml-flying-orb",l.style.left=`${r.left}px`,l.style.top=`${r.top}px`,l.style.width=`${r.width}px`,l.style.height=`${r.height}px`,l.style.setProperty("--orb-rgb",w[e%w.length]??w[0]??"255,182,162"),document.body.appendChild(l);const d=window.innerWidth/2,p=window.innerHeight/2;requestAnimationFrame(()=>{l.style.left=`${d}px`,l.style.top=`${p}px`,l.classList.add("go")}),window.setTimeout(()=>{l.remove()},1050)},[w]),de=a.useCallback(async({letter:e,moodId:t,moodLabel:r,total:l,remaining:d,orbIndex:p=null,drawnAtIso:V=new Date().toISOString()})=>{W(!1),p!==null?(le(p),Xe(p)):le(null),xe({letter:e,content:"讀取內容中...",moodId:t,moodLabel:r,drawnAtIso:V,total:l,remaining:d}),p!==null?window.setTimeout(()=>ae(!0),360):ae(!0);try{const k=await Oe(e);xe(F=>!F||F.letter.id!==e.id?F:{...F,content:k||"（這封信目前是空白）"})}catch(k){const F=k instanceof Error?k.message:"讀取失敗";xe(j=>!j||j.letter.id!==e.id?j:{...j,content:`（${F}）`})}},[Oe,Xe]),Ce=a.useCallback(async e=>{if(!o||P)return;const t=_e(E);if(!t){be("這個心情目前還沒有信件可以抽。");return}be(""),Le(!0);const r=Qe(o,E,t.letter.primaryMoodLabel||"全部");await de({letter:t.letter,moodId:E,moodLabel:r,total:t.total,remaining:t.remaining,orbIndex:e}),window.setTimeout(()=>{Le(!1)},860)},[_e,o,P,de,E]),me=a.useCallback(()=>{const e=Math.floor(Math.random()*w.length);Ce(e)},[Ce,w.length]),ft=a.useCallback(()=>{P||(ae(!1),le(null),W(!1),window.setTimeout(()=>{me()},180))},[me,P]),He=a.useCallback(()=>{ae(!1),le(null),W(!1)},[]),Ye=a.useCallback(e=>{W(!1),ge(e),ke(E),oe(!0)},[E]),We=a.useCallback(e=>{oe(!1),W(!1),de({letter:e,moodId:e.primaryMoodId||v,moodLabel:e.primaryMoodLabel||Qe(o,e.primaryMoodId,"心情信"),total:-1,remaining:-1,orbIndex:null})},[o,de]),Ue=a.useCallback(()=>{Me(!1),Z(!1),q.current=!1},[]),R=a.useCallback(()=>{I.current!==null&&(window.clearTimeout(I.current),I.current=null)},[]),pt=a.useCallback(e=>{P||(e.preventDefault(),Z(!0),q.current=!1,ce.current={x:e.clientX,y:e.clientY},R(),I.current=window.setTimeout(()=>{q.current=!0,Z(!1),Me(!0)},320))},[R,P]),bt=a.useCallback(e=>{const t=ce.current;if(!t)return;Math.hypot(e.clientX-t.x,e.clientY-t.y)>8&&R()},[R]),xt=a.useCallback(()=>{const e=q.current;R(),Z(!1),ce.current=null,q.current=!1,e||me()},[R,me]),gt=a.useCallback(()=>{R(),Z(!1),ce.current=null,q.current=!1},[R]);if(a.useEffect(()=>{const e=ze.current;if(!e)return;const t=c.orbMode,r=(j,T)=>{const y=we.current[j];y&&(y.style.left=`${T.x}px`,y.style.top=`${T.y}px`)},l=()=>{const j=e.clientWidth,T=e.clientHeight;if(j<10||T<10)return!1;const y=c.orbSpeed;ie.current=w.map((S,s)=>{const b=K[s]??60,C=Math.max(1,j-b),u=Math.max(1,T-b);if(t==="pulse"){const h=10+Math.random()*18,x=h,D=h,ee=Math.max(x,C-h),ue=Math.max(D,u-h),te=x+Math.random()*Math.max(0,ee-x),he=D+Math.random()*Math.max(0,ue-D),J=(.28+Math.random()*.58)*y;return{size:b,x:Math.min(C,Math.max(0,te)),y:Math.min(u,Math.max(0,he)),vx:Math.random()<.5?-J:J,vy:Math.random()<.5?-J:J,pulseAnchorX:te,pulseAnchorY:he,pulseRadius:h,basePulseRadius:h,pulseAngle:Math.random()*Math.PI*2,pulseSpin:(.02+Math.random()*.04)*(Math.random()<.5?-1:1),burstFrames:0,burstBoost:1,swirlFrames:0,swirlDirection:Math.random()<.5?-1:1}}if(t==="rise"){const h=(.55+Math.random()*1.15)*y,x=(2.4+Math.random()*3.4)*y;return{size:b,x:Math.random()*C,y:Math.random()*u,vx:Math.random()<.5?-h:h,vy:-x}}const z=(3+Math.random()*5.4)*y,_=(2.8+Math.random()*4.8)*y;return{size:b,x:Math.random()*C,y:Math.random()*u,vx:Math.random()<.5?-z:z,vy:Math.random()<.5?-_:_}});for(let S=0;S<ie.current.length;S+=1){const s=ie.current[S];s&&r(S,s)}return!0},d=()=>{const j=e.clientWidth,T=e.clientHeight;if(j<10||T<10){U.current=window.requestAnimationFrame(d);return}const y=ie.current;y.length!==w.length&&l();for(let S=0;S<y.length;S+=1){const s=y[S];if(!s)continue;const b=Math.max(1,j-s.size),C=Math.max(1,T-s.size);if(t==="pulse"){let u=s.pulseRadius??12;const z=s.basePulseRadius??u,_=s.pulseSpin??.03;let h=s.pulseAnchorX??b/2,x=s.pulseAnchorY??C/2;const D=u,ee=u,ue=Math.max(D,b-u),te=Math.max(ee,C-u),he=b/2,J=C/2;let B=s.burstFrames??0,X=s.burstBoost??1,H=s.swirlFrames??0,ve=s.swirlDirection??1;if(H<=0&&Math.random()<55e-5&&(H=120+Math.floor(Math.random()*84),ve=Math.random()<.5?-1:1,B=0,X=1),H<=0&&B<=0&&Math.random()<8e-4&&(B=34+Math.floor(Math.random()*26),X=1.45+Math.random()*.9),H>0)H-=1,h+=(he-h)*.072,x+=(J-x)*.072,u+=(22+S*7%16-u)*.09;else{const qe=B>0?X:1;h+=s.vx*qe,x+=s.vy*qe,(h<=D||h>=ue)&&(s.vx*=-1,h=Math.min(ue,Math.max(D,h))),(x<=ee||x>=te)&&(s.vy*=-1,x=Math.min(te,Math.max(ee,x))),u+=(z-u)*.12,B>0?(B-=1,X=Math.max(1.02,X*.982)):X=1}const Se=(s.pulseAngle??0)+(H>0?ve*(.16+Math.abs(_)*2.2):_*(B>0?1.7:1.1));s.pulseAngle=Se,s.pulseAnchorX=h,s.pulseAnchorY=x,s.pulseRadius=u,s.basePulseRadius=z,s.burstFrames=B,s.burstBoost=X,s.swirlFrames=H,s.swirlDirection=ve,s.x=Math.min(b,Math.max(0,h+Math.cos(Se)*u)),s.y=Math.min(C,Math.max(0,x+Math.sin(Se*.9)*u*.72))}else if(t==="rise"){if(s.x+=s.vx,s.y+=s.vy,(s.x<=0||s.x>=b)&&(s.vx*=-1,s.x=Math.min(b,Math.max(0,s.x))),s.y<=-s.size*.45){const u=c.orbSpeed,z=(.55+Math.random()*1.15)*u,_=(2.4+Math.random()*3.4)*u;s.x=Math.random()*b,s.y=C+Math.random()*(s.size*.8+26),s.vx=Math.random()<.5?-z:z,s.vy=-_}}else s.x+=s.vx,s.y+=s.vy,(s.x<=0||s.x>=b)&&(s.vx*=-1,s.x=Math.min(b,Math.max(0,s.x))),(s.y<=0||s.y>=C)&&(s.vy*=-1,s.y=Math.min(C,Math.max(0,s.y)));r(S,s)}U.current=window.requestAnimationFrame(d)};l();const p=window.setTimeout(()=>{l()},100),V=window.setTimeout(()=>{l()},300);U.current=window.requestAnimationFrame(d);let k=null;const F=()=>{l()};return typeof ResizeObserver<"u"?(k=new ResizeObserver(()=>{l()}),k.observe(e)):window.addEventListener("resize",F),()=>{window.clearTimeout(p),window.clearTimeout(V),k?k.disconnect():window.removeEventListener("resize",F),U.current!==null&&(window.cancelAnimationFrame(U.current),U.current=null)}},[w,K,c.orbMode,c.orbSpeed]),$)return n.jsx("div",{className:"ml-loading grid h-full place-items-center text-sm text-white/70",children:"讀取星辰心情信中..."});if(Y)return n.jsxs("div",{className:"ml-loading grid h-full place-items-center px-5 text-center text-sm text-rose-200",children:["讀取失敗：",Y]});if(!o||!o.letters.length)return n.jsx("div",{className:"ml-loading grid h-full place-items-center text-sm text-white/70",children:"目前沒有心情信資料。"});const yt=c.fontMode==="campfire"&&!!i.trim()?i.trim():"var(--app-font-family, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif)";return n.jsxs("div",{className:"mood-letters-page",children:[n.jsx("div",{className:"ml-stars-layer","aria-hidden":"true",children:dt.map((e,t)=>n.jsx("span",{className:"ml-star",style:{left:e.left,top:e.top,width:`${e.size}px`,height:`${e.size}px`,animationDuration:e.duration,animationDelay:e.delay}},`star-${t}`))}),n.jsx("div",{className:"ml-shooting-layer","aria-hidden":"true",children:mt.map((e,t)=>n.jsx("span",{className:"ml-shooting",style:{left:e.left,top:e.top,animationDuration:e.duration,animationDelay:e.delay}},`shoot-${t}`))}),n.jsxs("main",{className:"ml-content",children:[n.jsxs("header",{className:"ml-topbar",children:[n.jsx("button",{type:"button",className:"ml-nav-btn",onClick:m,"aria-label":"返回首頁",children:"‹"}),n.jsx("h1",{className:"ml-title",children:"給現在的妳"}),n.jsxs("div",{className:"ml-top-actions",children:[n.jsx("button",{type:"button",className:"ml-icon-btn",onClick:()=>Ye("all"),"aria-label":"全部清單",children:"☰"}),n.jsx("button",{type:"button",className:"ml-icon-btn",onClick:()=>Me(!0),"aria-label":"開啟設定",children:"⋯"})]})]}),n.jsx("div",{className:"ml-moods",role:"tablist","aria-label":"心情篩選",children:ut.map(e=>n.jsxs("button",{type:"button",className:`ml-mood-pill ${E===e.id?"active":""}`,onClick:()=>{nt(e.id),be("")},children:[e.label," · ",e.count]},e.id))}),n.jsx("section",{className:"ml-jar-panel",children:n.jsxs("div",{className:"ml-jar-container",children:[n.jsx("div",{className:"ml-jar-lid"}),n.jsx("div",{className:"ml-jar-neck"}),n.jsx("div",{className:"ml-jar",children:n.jsx("div",{ref:ze,className:`ml-orb-zone mode-${c.orbMode}`,children:w.map((e,t)=>n.jsx("button",{ref:r=>{we.current[t]=r},type:"button","aria-label":"抽一封心情信",className:`ml-orb ${it===t?"hidden":""}`,style:{width:`${N[t]?.size??K[t]??60}px`,height:`${N[t]?.size??K[t]??60}px`,left:`calc(${N[t]?.xPercent??50}% - ${(N[t]?.size??60)/2}px)`,top:`calc(${N[t]?.yPercent??50}% - ${(N[t]?.size??60)/2}px)`,"--float-x":`${N[t]?.driftX??0}px`,"--float-y":`${N[t]?.driftY??0}px`,"--float-dur":`${N[t]?.duration??1.9}s`,"--float-delay":`${N[t]?.delay??0}s`,"--pulse-dur":`${1.6+(N[t]?.duration??1.9)%1.25}s`,"--pulse-delay":`${N[t]?.delay??0}s`},onClick:()=>{Ce(t)},disabled:P,children:n.jsx("span",{className:"ml-orb-core",style:{"--orb-rgb":e}})},`orb-${e}-${t}`))})})]})}),$e?n.jsx("p",{className:"ml-status",children:$e}):null,c.showChibi?n.jsx("button",{type:"button",className:`ml-chibi-btn ${ct?"pressing":""}`,onPointerDown:pt,onPointerMove:bt,onPointerUp:xt,onPointerCancel:gt,onContextMenu:e=>e.preventDefault(),"aria-label":"小人：點擊抽卡，長按設定",children:n.jsx("img",{src:Pe,alt:"",draggable:!1,loading:"lazy",style:{width:c.chibiWidth,height:"auto"}})}):null]}),n.jsx("section",{className:`ml-overlay ${st?"open":""}`,onClick:He,children:n.jsxs("article",{className:"ml-paper",onClick:e=>e.stopPropagation(),style:{"--ml-paper-bg":O.paperBg,"--ml-paper-title":O.titleColor,"--ml-paper-body":O.bodyColor,"--ml-paper-accent":O.accentColor,"--ml-pill-bg":O.pillBg,"--ml-pill-border":O.pillBorder,"--ml-pill-text":O.pillText,"--ml-content-size":`${c.contentFontSize}px`,"--ml-content-line":c.contentLineHeight,"--ml-letter-font":yt},children:[n.jsxs("header",{className:"ml-paper-head",children:[n.jsx("span",{className:"ml-pill",children:g?.moodLabel??"心情信"}),g?n.jsx("button",{type:"button",className:"ml-paper-icon ml-paper-favorite",onClick:()=>De(g.letter.id),"aria-label":L.has(g.letter.id)?"取消收藏":"加入收藏",children:L.has(g.letter.id)?"★":"☆"}):null,n.jsx("button",{type:"button",className:"ml-paper-icon ml-paper-list",onClick:()=>Ye("all"),"aria-label":"開啟清單",children:"☰"}),n.jsx("button",{type:"button",className:"ml-paper-icon ml-paper-aa",onClick:()=>W(e=>!e),"aria-label":"文字設定",children:"Aa"}),n.jsx("button",{type:"button",className:"ml-close ml-paper-close",onClick:He,"aria-label":"關閉",children:"×"})]}),at?n.jsxs("div",{className:"ml-font-panel",children:[n.jsx("p",{className:"ml-font-title",children:"字體來源"}),n.jsxs("div",{className:"ml-font-row",children:[n.jsx("button",{type:"button",className:`ml-font-mode ${c.fontMode==="default"?"active":""}`,onClick:()=>M(e=>({...e,fontMode:"default"})),children:"預設"}),n.jsx("button",{type:"button",className:`ml-font-mode ${c.fontMode==="campfire"?"active":""}`,onClick:()=>M(e=>({...e,fontMode:"campfire"})),children:"跟隨篝火"})]}),n.jsxs("div",{className:"ml-font-control",children:[n.jsxs("div",{className:"ml-font-control-head",children:[n.jsx("p",{className:"ml-font-title",children:"字級"}),n.jsxs("p",{className:"ml-font-value",children:[c.contentFontSize.toFixed(1),"px"]})]}),n.jsx("input",{type:"range",min:12,max:24,step:.5,value:c.contentFontSize,onChange:e=>M(t=>({...t,contentFontSize:G(Number(e.target.value),12,24,t.contentFontSize)})),className:"ml-font-slider"})]}),n.jsxs("div",{className:"ml-font-control",children:[n.jsxs("div",{className:"ml-font-control-head",children:[n.jsx("p",{className:"ml-font-title",children:"行距"}),n.jsx("p",{className:"ml-font-value",children:c.contentLineHeight.toFixed(2)})]}),n.jsx("input",{type:"range",min:1.35,max:2.9,step:.05,value:c.contentLineHeight,onChange:e=>M(t=>({...t,contentLineHeight:G(Number(e.target.value),1.35,2.9,t.contentLineHeight)})),className:"ml-font-slider"})]})]}):null,n.jsx("h2",{className:"ml-paper-title",children:g?.letter.title??""}),n.jsx("div",{className:"ml-paper-body",children:g?.content??""}),n.jsxs("footer",{className:"ml-paper-foot",children:[n.jsx("span",{className:"ml-pool-hint",children:g&&g.total>=0?`本輪剩餘 ${g.remaining} / ${g.total}`:"來自清單查看"}),n.jsx("span",{className:"ml-drawn-time-foot",children:g?`抽中時間 ${Lt(g.drawnAtIso)}`:""}),n.jsx("button",{type:"button",className:"ml-redraw-chibi",onClick:ft,disabled:P,"aria-label":"再抽一次",children:n.jsx("img",{src:Pe,alt:"",draggable:!1,loading:"lazy"})})]})]})}),n.jsx("section",{className:`ml-list-overlay ${ot?"open":""}`,onClick:()=>oe(!1),children:n.jsxs("article",{className:"ml-list-sheet",onClick:e=>e.stopPropagation(),children:[n.jsxs("header",{className:"ml-list-head",children:[n.jsxs("div",{className:"ml-list-head-main",children:[n.jsx("h3",{children:"信件清單"}),n.jsxs("div",{className:"ml-list-tabs-inline",children:[n.jsx("button",{type:"button",className:re==="all"?"active":"",onClick:()=>ge("all"),children:"全部"}),n.jsx("button",{type:"button",className:re==="favorites"?"active":"",onClick:()=>ge("favorites"),children:"收藏"})]})]}),n.jsx("button",{type:"button",className:"ml-close",onClick:()=>oe(!1),"aria-label":"關閉清單",children:"×"})]}),n.jsx("div",{className:"ml-list-moods",children:ht.map(e=>n.jsx("button",{type:"button",className:Q===e.id?"active":"",onClick:()=>ke(e.id),children:e.label},`list-mood-${e.id}`))}),n.jsx("div",{className:"ml-list-search-wrap",children:n.jsx("input",{className:"ml-list-search",value:ye,onChange:e=>rt(e.target.value),placeholder:"搜尋標題、檔名或關鍵字"})}),n.jsx("div",{className:"ml-list-body",children:Ie.length?Ie.map(e=>n.jsxs("article",{className:"ml-list-item",role:"button",tabIndex:0,onClick:()=>We(e),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),We(e))},children:[n.jsxs("span",{className:"ml-list-item-main",children:[n.jsx("span",{className:"ml-list-title",children:e.title}),n.jsx("span",{className:"ml-list-mood",children:e.primaryMoodLabel})]}),n.jsx("button",{type:"button",className:"ml-list-star","aria-label":L.has(e.id)?"取消收藏":"加入收藏",onClick:t=>{t.stopPropagation(),De(e.id)},children:L.has(e.id)?"★":"☆"})]},e.id)):n.jsx("p",{className:"ml-list-empty",children:"這裡還沒有符合條件的信件。"})})]})}),n.jsx("section",{className:`ml-settings-overlay ${lt?"open":""}`,onClick:Ue,children:n.jsxs("article",{className:"ml-settings-sheet",onClick:e=>e.stopPropagation(),children:[n.jsxs("header",{className:"ml-settings-head",children:[n.jsx("h3",{children:"心情星球小設定"}),n.jsx("button",{type:"button",className:"ml-close ml-settings-close",onClick:Ue,"aria-label":"關閉設定",children:"×"})]}),n.jsxs("section",{className:"ml-setting-block",children:[n.jsxs("div",{className:"ml-setting-row",children:[n.jsx("span",{children:"M"}),n.jsx("button",{type:"button",className:`ml-switch ${c.showChibi?"on":""}`,onClick:()=>M(e=>({...e,showChibi:!e.showChibi})),children:n.jsx("span",{})})]}),n.jsxs("label",{className:"ml-setting-label",children:["大小",n.jsx("input",{type:"range",min:104,max:196,step:1,value:c.chibiWidth,onChange:e=>M(t=>({...t,chibiWidth:Number(e.target.value)}))})]}),n.jsxs("label",{className:"ml-setting-label",children:["球數（",c.orbCount," 顆）",n.jsx("input",{type:"range",min:et,max:tt,step:1,value:c.orbCount,onChange:e=>M(t=>({...t,orbCount:Number(e.target.value)}))})]}),n.jsxs("label",{className:"ml-setting-label",children:["球速（",c.orbSpeed.toFixed(2),"x）",n.jsx("input",{type:"range",min:.7,max:2.4,step:.01,value:c.orbSpeed,onChange:e=>M(t=>({...t,orbSpeed:Number(e.target.value)}))})]}),n.jsxs("div",{className:"ml-setting-label",children:[n.jsx("span",{children:"球球模式"}),n.jsx("div",{className:"ml-orb-mode-options",role:"radiogroup","aria-label":"球球模式",children:jt.map(e=>n.jsx("button",{type:"button",role:"radio","aria-checked":c.orbMode===e.id,className:`ml-orb-mode-btn ${c.orbMode===e.id?"active":""}`,onClick:()=>M(t=>({...t,orbMode:e.id})),children:e.label},e.id))})]})]}),n.jsxs("section",{className:"ml-setting-block",children:[n.jsxs("label",{className:"ml-setting-label",children:["文字大小（",c.contentFontSize.toFixed(1),"px）",n.jsx("input",{type:"range",min:12,max:24,step:.1,value:c.contentFontSize,onChange:e=>M(t=>({...t,contentFontSize:Number(e.target.value)}))})]}),n.jsxs("label",{className:"ml-setting-label",children:["行距（",c.contentLineHeight.toFixed(2),"）",n.jsx("input",{type:"range",min:1.35,max:2.9,step:.01,value:c.contentLineHeight,onChange:e=>M(t=>({...t,contentLineHeight:Number(e.target.value)}))})]})]}),n.jsxs("section",{className:"ml-setting-block",children:[n.jsx("p",{className:"ml-setting-caption",children:"紙張色票"}),n.jsx("div",{className:"ml-paper-themes",children:Object.keys(fe).map(e=>{const t=fe[e];return n.jsx("button",{type:"button",className:`ml-paper-chip ${c.paperTheme===e?"active":""}`,style:{"--chip-bg":t.paperBg,"--chip-accent":t.accentColor,"--chip-text":t.titleColor},onClick:()=>M(r=>({...r,paperTheme:e})),children:t.label},e)})})]})]})})]})}export{Tt as MoodLettersPage,Tt as default};
