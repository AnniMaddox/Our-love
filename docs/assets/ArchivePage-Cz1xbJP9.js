import{r,fh as vt,cx as yt,j as t}from"./index-lODvT2xf.js";import{S as xe}from"./SettingsAccordion-BcjaoiDS.js";const je="/Our-love/docs/",Nt=`${je}data/master-pool/index.json`,qe="memorial-archive-prefs-v1",We=`${je}chibi/chibi-00.webp`,y="æƒ³å¦³çš„æ™‚å€™",Ve=[{route:"letters",label:"æƒ…æ›¸"},{route:"diary",label:"æ—¥è¨˜"},{route:"birthday",label:"ç”Ÿæ—¥"},{route:"memo",label:"ç­†è¨˜"},{route:"mood",label:"å¿ƒæƒ…"},{route:"ramble",label:"ç¢ç¢å¿µ"},{route:"if",label:"å¦‚æœ"},{route:"intro",label:"è‡ªä»‹"}],Be={æƒ…æ›¸:"ct-letter",æ—¥è¨˜:"ct-diary",ç­†è¨˜:"ct-note",å¿ƒæƒ…:"ct-chat",ç¢ç¢å¿µ:"ct-chat",ç”Ÿæ—¥:"ct-birthday",å¦‚æœ:"ct-other",è‡ªä»‹:"ct-other",å…¶ä»–:"ct-other"},jt={tight:1.7,normal:2.14,wide:2.6},Ct=[{key:"tight",label:"ç·Š"},{key:"normal",label:"æ¨™æº–"},{key:"wide",label:"å¯¬"}];function ge(n){return typeof n=="object"&&n!==null}function w(n,a=""){return typeof n=="string"?n:a}function Ye(n){return Array.isArray(n)?n.filter(a=>typeof a=="string"&&a.trim().length>0):[]}function wt(n){return typeof n=="number"&&Number.isFinite(n)?n:null}function X(n){const a=new Set,l=[];for(const u of n)a.has(u)||(a.add(u),l.push(u));return l}function St(n){const a=n.toLowerCase().match(/\.([a-z0-9]+)$/i);return a?a[1]:"txt"}function kt(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const Ze=["\\d{3,5}(?:[-_./\\s](?:0?[1-9]|1[0-2])(?:[-_./\\s](?:0?[1-9]|[12]\\d|3[01]))|[-_./\\s](?:0[1-9]|1[0-2])(?:0[1-9]|[12]\\d|3[01]))","(?:19|20)\\d{2}\\d(?:[-_./\\s](?:0?[1-9]|1[0-2])(?:[-_./\\s](?:0?[1-9]|[12]\\d|3[01]))?|(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\\d|3[01]))","(?:19|20)\\d{2}(?:[-_./\\s](?:0?[1-9]|1[0-2])(?:[-_./\\s](?:0?[1-9]|[12]\\d|3[01]))?|(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\\d|3[01]))","(?:19|20)\\d{2}(?:[-_./\\s](?:0?[1-9]|1[0-2])|(?:0[1-9]|1[0-2]))","(?:19|20)\\d{2}","(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\\d|3[01])","(?:0?[1-9]|1[0-2])[-_./\\s](?:0?[1-9]|[12]\\d|3[01])"];function ve(n){return n.replace(/^[-_ï¼â€”:ï¼šã€.ã€‚/\s]+/,"").replace(/[-_ï¼â€”:ï¼šã€.ã€‚/\s]+$/,"")}function $t(n){for(const a of Ze){const l=n.match(new RegExp(`^${a}(?=$|[-_ï¼â€”:ï¼šã€.ã€‚/\\s])`));if(l)return n.slice(l[0].length)}return n}function Mt(n){for(const a of Ze){if(new RegExp(`^${a}$`).test(n))return"";const l=n.replace(new RegExp(`[-_ï¼â€”:ï¼šã€.ã€‚/\\s]+${a}$`),"");if(l!==n)return l}return n}function Ft(n,a){const l=n.trim();if(!l)return"";const u=kt(a.trim());if(!u)return"";let o=l.replace(new RegExp(`^ç¬¬\\s*0*${u}\\s*(?:è™Ÿ|å·)?\\s*[-_ï¼â€”:ï¼šã€.ã€‚\\s]*`,"i"),"").replace(new RegExp(`^folder\\s*0*${u}\\s*[-_ï¼â€”:ï¼šã€.ã€‚\\s]*`,"i"),"").replace(new RegExp(`^0*${u}\\s*[-_ï¼â€”:ï¼šã€.ã€‚\\s]*`,"i"),"").trim();o=ve(o);let d="";for(;o&&o!==d;){d=o;const F=ve($t(o));if(F!==o){o=F;continue}const K=ve(Mt(o));if(K!==o){o=K;continue}}return!o||o===a?"":o}function Rt(n,a){if(!a)return n;const l=Ft(n,a);return l?`${a}ï½œ${l}`:`${a}ï½œ`}function Et(n){if(!n)return y;const[a,l]=n.split("-");return!a||!l?n:`${a} å¹´ ${Number(l)} æœˆ`}function At(n,a){if(n&&n.length>=4)return n.slice(0,4);const l=a.match(/((?:19|20)\d{2})/);return l?l[1]:y}function Ge(n){if(!n)return y;const[a,l]=n.split("-");return!a||!l?y:`${a}-${String(Number(l)).padStart(2,"0")}`}function Tt(n){if(!n)return y;const[,a]=n.split("-");return a?`${Number(a)} æœˆ`:y}function Ue(n){if(typeof n!="number")return y;const a=new Date(n);return Number.isNaN(a.getTime())?y:`${a.getFullYear()}.${String(a.getMonth()+1).padStart(2,"0")}.${String(a.getDate()).padStart(2,"0")}`}function Pt(n){const a=Ve.filter(u=>n.includes(u.route)).map(u=>u.label),l=X(a);return l.length?l.slice(0,4):["å…¶ä»–"]}function Dt(n){const a=Ve.filter(u=>n.includes(u.route)).map(u=>u.label),l=X(a);return l.length?l.slice(0,2):["å…¶ä»–"]}function ye(n,a){const l=n.date?Date.parse(n.date):-1,u=a.date?Date.parse(a.date):-1;return l!==u?u-l:n.label.localeCompare(a.label,"zh-Hant")}function Xe(n,a){return ye(a,n)}function Qe(n,a){return n===y?1:a===y?-1:a.localeCompare(n,"zh-Hant")}function _t(){const n=[];for(let a=0;a<70;a+=1){const l=Math.random()<.2?2:1;n.push({id:`star-${a}`,left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,size:l,opacity:.05+Math.random()*.25,duration:2+Math.random()*5,delay:Math.random()*4})}return n}function Je(n){return n.length?n[Math.floor(Math.random()*n.length)]??null:null}function Ne(n,a=14){return typeof n!="number"||Number.isNaN(n)?a:Math.max(11,Math.min(22,Number(n)))}function Q(n,a=136){return typeof n!="number"||Number.isNaN(n)?a:Math.max(96,Math.min(186,Math.round(n)))}function Ht(n){return n==="tight"||n==="normal"||n==="wide"?n:"normal"}function It(n){return n==="prev-folder"?"prev-folder":"next-folder"}function zt(n){return n==="archive"?"archive":"default"}function Lt(n){return n<=1.86?"tight":n>=2.45?"wide":"normal"}function Ot(n,a){const l={fontMode:"default",lineHeight:Lt(a),readingFontSize:Ne(n,14),showHomeChibi:!0,homeChibiWidth:136,showReadingChibi:!0,readingChibiWidth:136,relatedMode:"next-folder"};if(typeof window>"u")return l;try{const u=window.localStorage.getItem(qe);if(!u)return l;const o=JSON.parse(u);return{fontMode:zt(o.fontMode),lineHeight:Ht(o.lineHeight),readingFontSize:Ne(o.readingFontSize,l.readingFontSize),showHomeChibi:o.showHomeChibi!==!1,homeChibiWidth:Q(o.homeChibiWidth,l.homeChibiWidth),showReadingChibi:o.showReadingChibi!==!1,readingChibiWidth:Q(o.readingChibiWidth,l.readingChibiWidth),relatedMode:It(o.relatedMode)}}catch{return l}}function Kt(n){typeof window>"u"||window.localStorage.setItem(qe,JSON.stringify(n))}function Wt(n){if(!ge(n))return{folders:[],docs:[]};const a=Array.isArray(n.docs)?n.docs:[],l=Array.isArray(n.folders)?n.folders:[],u=a.filter(ge).map(d=>({id:w(d.id),title:w(d.title)||w(d.sourceRelPath).split("/").pop()||"æœªå‘½å",sourceRelPath:w(d.sourceRelPath),sourceFolder:w(d.sourceFolder),routes:Ye(d.routes),writtenAt:wt(d.writtenAt),contentPath:w(d.contentPath)})).filter(d=>d.id&&d.sourceFolder&&d.contentPath);return{folders:l.filter(ge).map(d=>({folder:w(d.folder),folderCode:w(d.folderCode)||null,folderDate:w(d.folderDate)||null,count:typeof d.count=="number"&&Number.isFinite(d.count)?d.count:0,ids:Ye(d.ids)})).filter(d=>d.folder),docs:u}}function Ut({onExit:n,archiveFontFamily:a="",diaryContentFontSize:l=14,diaryLineHeight:u=2.16}){const[o,d]=r.useState(null),[F,K]=r.useState(""),[x,et]=r.useState("tl"),[S,tt]=r.useState("desc"),[R,st]=r.useState(!1),[Ce,we]=r.useState(""),[J,q]=r.useState("folder"),[W,V]=r.useState(!1),[N,Se]=r.useState(!1),[nt,Z]=r.useState(!1),[E,B]=r.useState(!1),[ee,A]=r.useState(!1),[te,se]=r.useState(null),[ne,ae]=r.useState(null),[re,ke]=r.useState(null),[le,at]=r.useState({}),[$e,Me]=r.useState(null),[ie,H]=r.useState(""),[Fe,oe]=r.useState(!1),[I,Re]=r.useState(!1),[Ee,ce]=r.useState(!1),[j,Ae]=r.useState(null),[h,g]=r.useState(()=>Ot(l,u)),[de,ue]=r.useState({homeChibi:!1,readingChibi:!1,related:!1}),C=r.useRef(null),he=r.useRef(new Set),fe=r.useRef(null),Te=r.useRef(null),rt=r.useMemo(()=>_t(),[]),[lt]=r.useState(()=>{const e=vt("archive"),s=yt();if(!e.length)return Je(s)??We;const i=Math.min(s.length,Math.max(1,Math.round(e.length*3/7))),p=X([...e,...s.slice(0,i)]);return Je(p)??We});r.useEffect(()=>{Kt(h)},[h]),r.useEffect(()=>{R&&Te.current?.focus()},[R]),r.useEffect(()=>{let e=!0;return fetch(Nt,{cache:"no-store"}).then(s=>{if(!s.ok)throw new Error(`HTTP ${s.status}`);return s.json()}).then(s=>{e&&d(Wt(s))}).catch(s=>{e&&K(s instanceof Error?s.message:String(s))}),()=>{e=!1}},[]),r.useEffect(()=>()=>{C.current!==null&&window.clearTimeout(C.current)},[]);const T=r.useMemo(()=>{const e=new Map;for(const s of o?.docs??[])e.set(s.id,s);return e},[o]),m=r.useMemo(()=>o?o.folders.map(s=>{const i=s.ids.map(f=>T.get(f)).filter(f=>!!f).map(f=>({id:f.id,title:f.title,ext:St(f.sourceRelPath),sourceRelPath:f.sourceRelPath,routes:f.routes,tags:Dt(f.routes),writtenAt:f.writtenAt,contentPath:f.contentPath})),p=X(i.flatMap(f=>f.routes));return{key:s.folder,label:Rt(s.folder,s.folderCode),date:s.folderDate,short:Et(s.folderDate),year:At(s.folderDate,s.folder),cats:Pt(p),docs:i}}).filter(s=>s.docs.length>0).sort(S==="asc"?Xe:ye):[],[T,S,o]),v=Ce.trim().toLowerCase(),Pe=r.useMemo(()=>v?m.filter(e=>[e.label,e.short,...e.cats,...e.docs.map(i=>i.title),...e.docs.flatMap(i=>i.tags)].join(`
`).toLowerCase().includes(v)):m,[m,v]),De=r.useMemo(()=>v?m.flatMap(e=>e.docs.filter(s=>s.title.toLowerCase().includes(v)||s.tags.some(i=>i.toLowerCase().includes(v))).map(s=>({...s,folderKey:e.key,folderLabel:e.label}))):[],[m,v]),P=r.useMemo(()=>{const e=new Map;for(const s of m)e.set(s.key,s);return e},[m]),_e=r.useMemo(()=>{const e=new Map;for(const s of Pe){const i=e.get(s.year)??[];i.push(s),e.set(s.year,i)}return Array.from(e.entries()).sort(([s],[i])=>S==="asc"?Qe(i,s):Qe(s,i)).map(([s,i])=>({year:s,folders:i.sort(S==="asc"?Xe:ye)}))},[S,Pe]),Y=r.useMemo(()=>{const e=[];for(const s of m)for(const i of s.docs)e.push({folderKey:s.key,docId:i.id});return e},[m]),c=r.useMemo(()=>te?P.get(te)??null:null,[te,P]),k=r.useMemo(()=>{if(!c)return null;const e=m.findIndex(s=>s.key===c.key);return e<0?null:m[e+1]??null},[c,m]),$=r.useMemo(()=>{if(!c)return null;const e=m.findIndex(s=>s.key===c.key);return e<0?null:m[e-1]??null},[c,m]),D=r.useMemo(()=>!c||!ne?-1:c.docs.findIndex(e=>e.id===ne),[ne,c]),b=r.useMemo(()=>!c||D<0?null:c.docs[D]??null,[D,c]),z=r.useMemo(()=>{if(!j)return null;const e=P.get(j.folderKey),s=j.docId?T.get(j.docId):null;return!e||!s?null:{folder:e,doc:s}},[j,T,P]),M=r.useMemo(()=>re?P.get(re)??null:null,[re,P]),He=jt[h.lineHeight],G=b?le[b.id]??"":"",Ie=h.fontMode==="archive"&&!!a.trim()?a.trim():"var(--app-font-family, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif)",ze=!!$?.docs.length,Le=!!k?.docs.length,it=h.relatedMode==="prev-folder"?"ä¸Šè³‡æ–™å¤¾":"ä¸‹è³‡æ–™å¤¾",ot=N?h.showReadingChibi:h.showHomeChibi,ct=N?h.readingChibiWidth:h.homeChibiWidth,dt=x==="crystal"&&!W&&!N,_=r.useCallback(async e=>{const s=T.get(e);if(s&&le[e]===void 0&&!he.current.has(e)){he.current.add(e),Me(e),H("");try{const i=await fetch(`${je}data/master-pool/${s.contentPath}`,{cache:"no-store"});if(!i.ok)throw new Error(`HTTP ${i.status}`);const p=await i.text();at(f=>({...f,[e]:p.replace(/\r\n?/g,`
`).trim()}))}catch(i){H(i instanceof Error?i.message:String(i))}finally{he.current.delete(e),Me(i=>i===e?null:i)}}},[le,T]),ut=r.useCallback(e=>{se(e),V(!0)},[]),me=r.useCallback(()=>{V(!1)},[]),L=r.useCallback((e,s)=>{se(e),ae(s),Se(!0),Z(!1),H(""),_(s)},[_]),be=r.useCallback(()=>{B(!1),Se(!1),Z(!1)},[]),O=r.useCallback(e=>{if(!c||D<0)return;const s=D+e;if(s<0||s>=c.docs.length)return;const i=c.docs[s];ae(i.id),H(""),_(i.id)},[D,c,_]),Oe=r.useCallback(e=>{const s=e===-1?$:k;if(!s||!s.docs.length)return;const i=s.docs[0];se(s.key),ae(i.id),H(""),_(i.id)},[_,k,$]),ht=r.useCallback(e=>{const s=e.touches[0];s&&(fe.current={x:s.clientX,y:s.clientY})},[]),ft=r.useCallback(e=>{const s=fe.current;if(fe.current=null,!s)return;const i=e.changedTouches[0];if(!i)return;const p=i.clientX-s.x,f=i.clientY-s.y;Math.abs(p)<36||Math.abs(p)<Math.abs(f)*1.15||O(p<0?1:-1)},[O]),mt=r.useCallback(()=>{if(!c||!N)return;const e=h.relatedMode==="prev-folder"?$:k;ke(e?e.key:null),B(!0)},[c,k,h.relatedMode,$,N]),U=r.useCallback(()=>{B(!1)},[]),Ke=r.useCallback(e=>{et(e),e==="crystal"&&(V(!1),B(!1))},[]),bt=r.useCallback(()=>{if(Fe||I||!Y.length)return;const e=Y[Math.floor(Math.random()*Y.length)];Ae(e),oe(!0),ce(!0),C.current!==null&&window.clearTimeout(C.current),C.current=window.setTimeout(()=>{ce(!1),Re(!0),oe(!1),C.current=null},1100)},[Y,I,Fe]),pt=r.useCallback(()=>{C.current!==null&&(window.clearTimeout(C.current),C.current=null),oe(!1),ce(!1),Re(!1),Ae(null)},[]),xt=r.useCallback(()=>{j&&L(j.folderKey,j.docId)},[j,L]);return r.useEffect(()=>{if(!E||!c)return;const e=h.relatedMode==="prev-folder"?$:k;ke(e?e.key:null)},[c,E,k,h.relatedMode,$]),r.useEffect(()=>{const e=s=>{if(s.key==="Escape"){if(ee){A(!1);return}if(E){U();return}if(N){be();return}W&&me();return}N&&(s.key==="ArrowLeft"?O(-1):s.key==="ArrowRight"&&O(1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[me,U,be,W,E,O,N,ee]),t.jsx("div",{className:"archive-page",children:t.jsxs("div",{className:"archive-app",children:[t.jsxs("div",{className:"tab-bar",style:{background:x==="crystal"?"#12102a":"#f5f0e6"},children:[t.jsx("button",{type:"button",className:`tab-side-btn exit ${x==="crystal"?"dark":""}`,onClick:n,"aria-label":"è¿”å›é¦–é ",title:"è¿”å›é¦–é ",children:t.jsx("span",{style:{transform:"translateY(-1px)",display:"block"},children:"â€¹"})}),t.jsx("button",{type:"button",className:`tab ${x==="tl"?"active":""}`,onClick:()=>Ke("tl"),style:{color:x==="crystal"?"rgba(160,150,210,.3)":void 0},children:"ğŸ—‚ æ™‚é–“æµ"}),t.jsx("button",{type:"button",className:`tab ${x==="crystal"?"c-active active":""}`,onClick:()=>Ke("crystal"),style:{color:x==="crystal"?"rgba(200,190,255,.8)":void 0},children:"ğŸ”® æ°´æ™¶çƒ"}),t.jsx("button",{type:"button",className:`tab-side-btn dots ${x==="crystal"?"dark":""}`,onClick:()=>A(!0),"aria-label":"é–‹å•Ÿç¸½æ”¬è¨­å®š",children:"â‹¯"})]}),t.jsx("div",{id:"view-tl",className:x==="tl"?"":"hidden",children:t.jsxs("div",{className:"tl-inner",children:[t.jsxs("div",{className:"tl-sort-row",children:[t.jsx("button",{type:"button",className:"tl-sort-btn active",onClick:()=>tt(e=>e==="asc"?"desc":"asc"),"aria-label":S==="asc"?"ç›®å‰æ­£åºï¼Œé»æ“Šåˆ‡æ›å€’åº":"ç›®å‰å€’åºï¼Œé»æ“Šåˆ‡æ›æ­£åº",title:S==="asc"?"é»æ“Šåˆ‡æ›å€’åº":"é»æ“Šåˆ‡æ›æ­£åº",children:S==="asc"?"â–² æ­£åº":"â–¼ å€’åº"}),t.jsx("button",{type:"button",className:`tl-sort-btn tl-search-btn ${R?"active":""}`,onClick:()=>st(e=>{const s=!e;return s||(we(""),q("folder")),s}),"aria-label":R?"é—œé–‰æœå°‹":"é–‹å•Ÿæœå°‹",title:R?"é—œé–‰æœå°‹":"é–‹å•Ÿæœå°‹",children:"âŒ•"})]}),R?t.jsxs("div",{className:"tl-search-row",children:[t.jsx("input",{ref:Te,className:"tl-search-input",value:Ce,onChange:e=>we(e.target.value),placeholder:"æœå°‹è³‡æ–™å¤¾ã€æ¨™ç±¤æˆ–æª”æ¡ˆæ¨™é¡Œ","aria-label":"æœå°‹ç¸½æ”¬è³‡æ–™å¤¾"}),v&&t.jsxs("div",{className:"tl-search-mode-row",children:[t.jsx("button",{type:"button",className:`tl-search-mode-btn${J==="folder"?" active":""}`,onClick:()=>q("folder"),children:"è³‡æ–™å¤¾"}),t.jsx("button",{type:"button",className:`tl-search-mode-btn${J==="doc"?" active":""}`,onClick:()=>q("doc"),children:"æª”æ¡ˆ"})]})]}):null,F&&t.jsxs("div",{className:"empty-state",children:["ç„¡æ³•è¼‰å…¥è³‡æ–™ï¼š",F]}),!o&&!F&&t.jsx("div",{className:"empty-state",children:"è¼‰å…¥ä¸­â‹¯"}),J==="doc"&&v?De.length?t.jsx("div",{className:"tl-doc-results",children:De.map(e=>t.jsxs("button",{type:"button",className:"tl-doc-row",onClick:()=>L(e.folderKey,e.id),children:[t.jsx("span",{className:"tl-doc-title",children:e.title}),t.jsx("span",{className:"tl-doc-folder",children:e.folderLabel})]},e.id))}):t.jsx("div",{className:"empty-state",children:"æ‰¾ä¸åˆ°ç¬¦åˆçš„æª”æ¡ˆ"}):t.jsxs(t.Fragment,{children:[o&&!_e.length&&t.jsx("div",{className:"empty-state",children:v?"æ‰¾ä¸åˆ°ç¬¦åˆæœå°‹çš„è³‡æ–™å¤¾":"ç›®å‰æ²’æœ‰å¯é¡¯ç¤ºçš„è³‡æ–™å¤¾"}),_e.map(e=>t.jsxs("div",{className:"year-block",children:[t.jsxs("div",{className:"year-marker",children:[t.jsx("div",{className:"year-num",children:e.year}),t.jsx("div",{className:"year-line"})]}),e.folders.map((s,i)=>{const p=Ge(s.date),f=i>0?Ge(e.folders[i-1]?.date??null):null,gt=i===0||p!==f;return t.jsxs("div",{children:[gt?t.jsxs("div",{className:"month-marker",children:[t.jsx("span",{className:"month-label",children:Tt(s.date)}),t.jsx("span",{className:"month-line"})]}):null,t.jsxs("button",{type:"button",className:"folder-row",onClick:()=>ut(s.key),children:[t.jsxs("div",{className:"fr-main",children:[t.jsxs("div",{className:"fr-top",children:[t.jsx("span",{className:"fr-label",children:s.label}),t.jsx("span",{className:"fr-date",children:s.short})]}),t.jsx("div",{className:"fr-tags",children:s.cats.map(pe=>t.jsx("span",{className:`cat-tag ${Be[pe]??"ct-other"}`,children:pe},`${s.key}-${pe}`))})]}),t.jsxs("div",{className:"fr-right",children:[t.jsxs("span",{className:"fr-count",children:[s.docs.length," ä»½"]}),t.jsx("span",{className:"fr-arrow",children:"â€º"})]})]})]},s.key)})]},e.year))]})]})}),t.jsxs("div",{id:"view-crystal",className:x==="crystal"?"active":"",children:[t.jsx("div",{className:"c-stars",children:rt.map(e=>t.jsx("span",{className:"star",style:{left:e.left,top:e.top,width:`${e.size}px`,height:`${e.size}px`,opacity:e.opacity,animationDuration:`${e.duration}s`,animationDelay:`${e.delay}s`}},e.id))}),t.jsxs("div",{className:`crystal-prompt ${I||Ee?"hidden":""}`,children:["è¼•è§¸æ°´æ™¶çƒ",t.jsx("br",{}),"çªºè¦‹éå»çš„ç¢ç‰‡"]}),t.jsxs("div",{className:"ball-wrap",children:[t.jsx("button",{type:"button",className:`crystal-ball ${Ee?"spinning":""} ${I?"revealed":""}`,onClick:bt,children:t.jsxs("div",{className:"ball-inner",children:[t.jsx("div",{className:"fog f1"}),t.jsx("div",{className:"fog f2"}),t.jsx("div",{className:"fog f3"}),t.jsx("div",{className:"fog f4"}),t.jsxs("div",{className:"vision-text",children:[t.jsx("div",{className:"v-tag",children:z?`${z.folder.label} Â· ${z.folder.short}`:""}),t.jsx("div",{className:"v-title",children:z?.doc.title??""}),t.jsx("div",{className:"v-ext",children:z?.doc.sourceRelPath.split(".").pop()?.toUpperCase()??""})]})]})}),t.jsx("div",{className:"ball-shadow"})]}),t.jsxs("div",{className:`crystal-actions ${I?"visible":""}`,children:[t.jsx("button",{type:"button",className:"enter-btn",onClick:xt,children:"é€²å…¥é€™æ®µè¨˜æ†¶ â†’"}),t.jsx("button",{type:"button",className:"again-btn",onClick:pt,children:"ğŸ”® å†çœ‹ä¸€æ¬¡"})]})]}),t.jsxs("div",{className:`folder-panel ${W?"":"off-right"}`,children:[t.jsxs("div",{className:"fp-hdr",children:[t.jsx("button",{type:"button",className:"back-btn",onClick:me,children:"â€¹"}),t.jsx("div",{className:"fp-title",children:c?.label??"è³‡æ–™å¤¾"}),t.jsx("div",{className:"fp-meta",children:c?`${c.short} Â· ${c.docs.length} ä»½`:"â€”"}),t.jsx("button",{type:"button",className:"fp-menu-btn",onClick:()=>A(!0),"aria-label":"é–‹å•Ÿç¸½æ”¬è¨­å®š",children:"â‹¯"})]}),t.jsxs("div",{className:"fp-body",children:[t.jsx("div",{className:"fp-section-label",children:"æ‰€æœ‰æ–‡ä»¶"}),c?.docs.map(e=>t.jsxs("button",{type:"button",className:"fp-file-item",onClick:()=>L(c.key,e.id),children:[t.jsx("div",{className:`fp-file-icon ${e.ext}`,children:e.ext==="docx"?"ğŸ“„":"ğŸ“ƒ"}),t.jsxs("div",{className:"fp-file-info",children:[t.jsx("div",{className:"fp-file-name",children:e.title}),t.jsx("div",{className:"fp-file-sub",children:Ue(e.writtenAt)})]}),t.jsx("div",{className:"fp-file-right",children:t.jsx("div",{className:"fp-file-tags",children:e.tags.map(s=>t.jsx("span",{className:`cat-tag fp-file-tag ${Be[s]??"ct-other"}`,children:s},`${e.id}-${s}`))})})]},e.id)),c&&!c.docs.length&&t.jsx("div",{className:"empty-state",children:"æ­¤è³‡æ–™å¤¾ç›®å‰æ²’æœ‰æª”æ¡ˆ"})]})]}),t.jsxs("div",{className:`reading-panel ${N?"":"off-right"}`,children:[t.jsxs("div",{className:"read-hdr",children:[t.jsx("button",{type:"button",className:"back-btn",onClick:be,children:"â€¹"}),t.jsx("div",{className:"read-crumb",children:c&&b?`${c.label} â€º ${b.title}`:""}),t.jsxs("div",{className:"read-tools",children:[t.jsx("button",{type:"button",className:`read-mini-btn ${ze?"":"disabled"}`,onClick:()=>Oe(-1),disabled:!ze,"aria-label":"ä¸Šä¸€è³‡æ–™å¤¾ç¬¬ä¸€å°",children:"â€¹"}),t.jsxs("button",{type:"button",className:"folder-nav-btn",onClick:mt,children:[it," â˜°"]}),t.jsx("button",{type:"button",className:`read-mini-btn ${Le?"":"disabled"}`,onClick:()=>Oe(1),disabled:!Le,"aria-label":"ä¸‹ä¸€è³‡æ–™å¤¾ç¬¬ä¸€å°",children:"â€º"}),t.jsx("button",{type:"button",className:"read-aa-btn",onClick:()=>Z(e=>!e),"aria-label":"é–‹å•Ÿé–±è®€å­—é«”è¨­å®š",title:"é–±è®€å­—é«”è¨­å®š",children:"Aa"}),t.jsx("button",{type:"button",className:"read-menu-btn",onClick:()=>A(!0),"aria-label":"é–‹å•Ÿç¸½æ”¬è¨­å®š",children:"â‹¯"})]})]}),nt?t.jsxs("div",{className:"read-font-panel",children:[t.jsx("p",{className:"read-font-title",children:"å­—é«”ä¾†æº"}),t.jsxs("div",{className:"read-font-row",children:[t.jsx("button",{type:"button",className:`read-font-mode-btn ${h.fontMode==="default"?"active":""}`,onClick:()=>g(e=>({...e,fontMode:"default"})),children:"é è¨­"}),t.jsx("button",{type:"button",className:`read-font-mode-btn ${h.fontMode==="archive"?"active":""}`,onClick:()=>g(e=>({...e,fontMode:"archive"})),children:"è·Ÿéš¨ç¸½æ”¬"})]}),t.jsxs("div",{className:"read-font-control",children:[t.jsxs("div",{className:"read-font-control-head",children:[t.jsx("p",{className:"read-font-title",children:"å­—ç´š"}),t.jsxs("p",{className:"read-font-value",children:[h.readingFontSize.toFixed(1),"px"]})]}),t.jsx("input",{type:"range",min:11,max:22,step:.5,value:h.readingFontSize,onChange:e=>g(s=>({...s,readingFontSize:Ne(Number(e.target.value),s.readingFontSize)})),className:"read-font-slider"})]}),t.jsxs("div",{className:"read-font-control",children:[t.jsxs("div",{className:"read-font-control-head",children:[t.jsx("p",{className:"read-font-title",children:"è¡Œè·"}),t.jsx("p",{className:"read-font-value",children:He.toFixed(2)})]}),t.jsx("div",{className:"read-font-row",children:Ct.map(e=>t.jsx("button",{type:"button",className:`read-font-mode-btn ${h.lineHeight===e.key?"active":""}`,onClick:()=>g(s=>({...s,lineHeight:e.key})),children:e.label},`read-font-line-${e.key}`))})]})]}):null,t.jsx("div",{className:"read-body",onTouchStart:ht,onTouchEnd:ft,children:t.jsxs("div",{className:"doc-paper",children:[t.jsx("div",{className:"doc-title",style:{fontFamily:Ie,fontSize:"var(--ui-header-title-size, 17px)"},children:b?.title??""}),t.jsx("div",{className:"doc-meta",style:{fontSize:"var(--ui-hint-text-size, 9px)"},children:c&&b?`${c.label} Â· ${Ue(b.writtenAt)} Â· ${b.ext.toUpperCase()}`:""}),ie&&t.jsxs("div",{className:"doc-placeholder",children:["è®€å–å¤±æ•—ï¼š",ie]}),$e===b?.id&&!G&&t.jsx("div",{className:"doc-placeholder",children:"è®€å–ä¸­â‹¯"}),!ie&&b&&$e!==b.id&&!G&&t.jsx("div",{className:"doc-placeholder",children:"æ­¤æª”æ¡ˆç›®å‰æ²’æœ‰å¯è®€å…§å®¹ã€‚"}),!!G&&t.jsx("div",{className:"doc-content",style:{fontFamily:Ie,fontSize:`${h.readingFontSize}px`,lineHeight:He},children:G})]})})]}),ot?t.jsx("div",{className:`chibi-float ${dt?"dark":""}`,children:t.jsx("button",{type:"button",className:"chibi-float-btn",onClick:()=>A(!0),title:"é–‹å•Ÿç¸½æ”¬è¨­å®š","aria-label":"é–‹å•Ÿç¸½æ”¬è¨­å®š",children:t.jsx("img",{src:lt,alt:"",draggable:!1,className:"calendar-chibi select-none",style:{width:ct,height:"auto"}})})}):null,ee?t.jsx("div",{className:"archive-settings-overlay",onClick:()=>A(!1),children:t.jsxs("div",{className:"archive-settings-sheet",onClick:e=>e.stopPropagation(),children:[t.jsx("div",{className:"archive-sheet-handle"}),t.jsxs(xe,{title:"M",subtitle:"ç¸½æ”¬é¦–é èˆ‡æ¸…å–®é ",isOpen:de.homeChibi,onToggle:()=>ue(e=>({...e,homeChibi:!e.homeChibi})),className:"archive-sheet-section",titleClassName:"archive-sheet-label",subtitleClassName:"archive-sheet-subtitle",chevronClassName:"archive-sheet-chevron",bodyClassName:"mt-2",children:[t.jsxs("div",{className:"archive-toggle-row",children:[t.jsx("span",{children:"M"}),t.jsx("button",{type:"button",className:`archive-switch ${h.showHomeChibi?"on":""}`,onClick:()=>g(e=>({...e,showHomeChibi:!e.showHomeChibi})),"aria-label":"åˆ‡æ›ç¸½æ”¬é¦–é èˆ‡æ¸…å–®é Mé¡¯ç¤º",children:t.jsx("span",{})})]}),t.jsx("label",{className:"archive-range-row",children:t.jsx("input",{type:"range",min:96,max:186,step:1,value:h.homeChibiWidth,onChange:e=>g(s=>({...s,homeChibiWidth:Q(Number(e.target.value),s.homeChibiWidth)}))})})]}),t.jsxs(xe,{title:"é–±è®€M",subtitle:"é–±è®€é é¡¯ç¤ºèˆ‡å¤§å°",isOpen:de.readingChibi,onToggle:()=>ue(e=>({...e,readingChibi:!e.readingChibi})),className:"archive-sheet-section",titleClassName:"archive-sheet-label",subtitleClassName:"archive-sheet-subtitle",chevronClassName:"archive-sheet-chevron",bodyClassName:"mt-2",children:[t.jsxs("div",{className:"archive-toggle-row",children:[t.jsx("span",{children:"M"}),t.jsx("button",{type:"button",className:`archive-switch ${h.showReadingChibi?"on":""}`,onClick:()=>g(e=>({...e,showReadingChibi:!e.showReadingChibi})),"aria-label":"åˆ‡æ›é–±è®€é Mé¡¯ç¤º",children:t.jsx("span",{})})]}),t.jsx("label",{className:"archive-range-row",children:t.jsx("input",{type:"range",min:96,max:186,step:1,value:h.readingChibiWidth,onChange:e=>g(s=>({...s,readingChibiWidth:Q(Number(e.target.value),s.readingChibiWidth)}))})})]}),t.jsx(xe,{title:"ç›¸é—œé–±è®€",subtitle:"ä¸Šè³‡æ–™å¤¾/ä¸‹è³‡æ–™å¤¾",isOpen:de.related,onToggle:()=>ue(e=>({...e,related:!e.related})),className:"archive-sheet-section",titleClassName:"archive-sheet-label",subtitleClassName:"archive-sheet-subtitle",chevronClassName:"archive-sheet-chevron",bodyClassName:"mt-2",children:t.jsxs("div",{className:"archive-pill-group",children:[t.jsx("button",{type:"button",className:`archive-pill ${h.relatedMode==="prev-folder"?"active":""}`,onClick:()=>g(e=>({...e,relatedMode:"prev-folder"})),children:"ä¸Šè³‡æ–™å¤¾"}),t.jsx("button",{type:"button",className:`archive-pill ${h.relatedMode==="next-folder"?"active":""}`,onClick:()=>g(e=>({...e,relatedMode:"next-folder"})),children:"ä¸‹è³‡æ–™å¤¾"})]})})]})}):null,t.jsx("div",{className:`sheet-overlay ${E?"open":""}`,onClick:U}),t.jsxs("div",{className:`folder-sheet ${E?"open":""}`,children:[t.jsx("div",{className:"sheet-handle"}),t.jsx("div",{className:"sheet-folder-title",children:M?`${M.label} Â· ${M.short}`:h.relatedMode==="prev-folder"?"ä¸Šè³‡æ–™å¤¾ï¼ˆç›®å‰æ²’æœ‰ï¼‰":"ä¸‹è³‡æ–™å¤¾ï¼ˆç›®å‰æ²’æœ‰ï¼‰"}),t.jsx("div",{className:"sheet-list",children:M?.docs.length?M.docs.map(e=>t.jsx("button",{type:"button",className:`sheet-file-item ${e.id===b?.id?"current":""}`,onClick:()=>{L(M.key,e.id),U()},children:t.jsx("span",{className:"sf-name",children:e.title})},`sheet-${M.key}-${e.id}`)):t.jsx("p",{className:"sheet-empty",children:"ç›®å‰æ²’æœ‰å¯é¡¯ç¤ºé …ç›®"})})]})]})})}export{Ut as ArchivePage,Ut as default};
