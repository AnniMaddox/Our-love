import{r as i,j as e,cy as ee,cz as te}from"./index-N5d2m6sw.js";function pe(s){return`chat-bookmarks-v1-${s}`}function oe(s){try{const l=localStorage.getItem(pe(s));return l?JSON.parse(l):[]}catch{return[]}}function ce(s,l){localStorage.setItem(pe(s),JSON.stringify(l))}function X(){return{name:"",leftNick:"M",rightNick:"ä½ ",leftAvatarDataUrl:"",rightAvatarDataUrl:""}}function Z(s){return s.trim().toLowerCase()}function ke(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ie(s,l,r){if(!s)return null;const n=Z(s);return n?l.some(d=>Z(d)===n)?"user":r.some(d=>Z(d)===n)?"assistant":null:null}function Be(s){const l=["content","message","text","body"];for(const r of l){const n=s[r];if(typeof n=="string"&&n.trim())return n.trim()}return""}function Ce(s){const l=["timestamp","time","datetime","date"];for(const r of l){const n=s[r];if(typeof n!="string")continue;const d=n.trim();if(!d)continue;const u=new Date(d);return Number.isNaN(u.getTime())?d.replace("T"," ").slice(0,16):`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")} ${String(u.getHours()).padStart(2,"0")}:${String(u.getMinutes()).padStart(2,"0")}`}}function de(s,l){for(const r of l){const n=s.match(new RegExp(`^${ke(r)}\\s*[ï¼š:]\\s*(.*)$`,"i"));if(n)return(n[1]??"").trim()}return null}function Ae(s,l){const r=ee(l?.leftNick,"M"),n=ee(l?.rightNick,"ä½ "),d=s.trim();if(d.startsWith("[")||d.startsWith("{"))try{const A=JSON.parse(d),B=Array.isArray(A)?A:[A],T=[];for(const j of B){if(!j||typeof j!="object")continue;const x=j,N=Be(x);if(!N)continue;let g=null;const y=x.role;if(y==="user"||y==="assistant")g=y;else{const z=(typeof x.speaker=="string"?x.speaker:void 0)??(typeof x.name=="string"?x.name:void 0)??(typeof x.author=="string"?x.author:void 0)??(typeof x.from=="string"?x.from:void 0);g=ie(z,n,r)}g&&T.push({role:g,content:N,time:Ce(x)})}if(T.length>0)return T}catch{}const u=s.split(`
`),a=[];let v=null,f="",w;function k(){v&&f.trim()&&a.push({role:v,content:f.trim(),time:w}),f="",w=void 0}for(const A of u){const B=A.trim();if(!B)continue;const T=B.match(/^\[(\d{4}-\d{2}-\d{2}[\sT]\d{2}:\d{2}(?::\d{2})?)\]/);if(T){w=T[1].replace("T"," ").slice(0,16);continue}const j=B.match(/^ã€(user|assistant)ã€‘\s*(?:\[([^\]]+)\])?(.*)$/i);if(j){k(),v=j[1].toLowerCase()==="user"?"user":"assistant",j[2]&&(w=j[2].replace("T"," ").slice(0,16));const y=(j[3]??"").trim();y&&(f=y);continue}const x=de(B,n);if(x!==null){k(),v="user",f=x;continue}const N=de(B,r);if(N!==null){k(),v="assistant",f=N;continue}const g=B.match(/^ã€([^ã€‘]+)ã€‘\s*(.*)$/);if(g){const y=ie(g[1],n,r);y&&(k(),v=y,f=(g[2]??"").trim());continue}f&&(f+=`
`),f+=B}return k(),a}function ue(s){return s.trim().toLowerCase()}function _(s){return s.replace(/\.(txt|md|docx|json)$/i,"")}function xe(s,l){return ee(s,l)[0]??l}function Te(s){const l=s.replace("#",""),r=parseInt(l.length===3?l.split("").map(n=>n+n).join(""):l,16);return[r>>16&255,r>>8&255,r&255]}function Y(s,l=.45){try{const[r,n,d]=Te(s),u=a=>Math.max(0,Math.round(a*(1-l)));return`#${[u(r),u(n),u(d)].map(a=>a.toString(16).padStart(2,"0")).join("")}`}catch{return s}}function $e(s,l){if(s)return{night:!0,bg:"#1c1c1e",barBg:"#1c1c1e",barBorder:"rgba(255,255,255,0.1)",titleColor:"#f2f2f7",subtitleColor:"#8e8e93",btnBg:"#2c2c2e",btnBorder:"rgba(255,255,255,0.12)",btnColor:"#ebebf5",inputBg:"#2c2c2e",inputBorder:"rgba(255,255,255,0.12)",inputText:"#f2f2f7",dividerColor:"rgba(255,255,255,0.08)",listItemHover:"rgba(255,255,255,0.06)",dateLabelColor:"rgba(255,255,255,0.35)",floatBtnBg:"#2c2c2e",floatBtnBorder:"rgba(255,255,255,0.12)",floatBtnColor:"#ebebf5",drawerBg:"#2c2c2e",drawerBorder:"rgba(255,255,255,0.08)",drawerTitleColor:"#f2f2f7",drawerSubColor:"#8e8e93",drawerDivider:"rgba(255,255,255,0.07)",bubbleVarStyle:{"--user-bubble-bg":Y(l.chatUserBubbleColor),"--user-bubble-border":Y(l.chatUserBubbleBorderColor,.35),"--ai-bubble-bg":Y(l.chatAiBubbleColor),"--ai-bubble-border":Y(l.chatAiBubbleBorderColor,.35)}};const r=l.chatBackgroundColor||"#efeff4";return{night:!1,bg:r,barBg:r,barBorder:"rgba(0,0,0,0.1)",titleColor:"#1c1c1e",subtitleColor:"#6b7280",btnBg:"rgba(255,255,255,0.85)",btnBorder:"rgba(0,0,0,0.12)",btnColor:"#374151",inputBg:"rgba(255,255,255,0.85)",inputBorder:"rgba(0,0,0,0.14)",inputText:"#374151",dividerColor:"rgba(0,0,0,0.07)",listItemHover:"rgba(0,0,0,0.04)",dateLabelColor:"rgba(0,0,0,0.35)",floatBtnBg:"rgba(255,255,255,0.92)",floatBtnBorder:"rgba(0,0,0,0.1)",floatBtnColor:"#374151",drawerBg:"#ffffff",drawerBorder:"rgba(0,0,0,0.06)",drawerTitleColor:"#1c1c1e",drawerSubColor:"#6b7280",drawerDivider:"rgba(0,0,0,0.06)",bubbleVarStyle:{}}}const De=["#efeff4","#f6f1e7","#eaf1f6","#f4e9ef","#eef3e6"];function Se(s,l,r){const n=l.trim();if(!n)return{backgroundColor:s};const d=Math.max(0,Math.min(.9,r/100));return{backgroundColor:s,backgroundImage:`linear-gradient(rgba(255,255,255,${d}), rgba(255,255,255,${d})), url("${n}")`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}function Ie(s,l){return s.trim()||l}function Re(s){const l=s.trim();return l?l.startsWith("data:image/")||l.startsWith("http://")||l.startsWith("https://")||l.startsWith("/")||l.startsWith("./")||l.startsWith("../")||/\.(png|jpe?g|gif|webp|avif|svg)$/i.test(l):!1}function be({icon:s,fallback:l,imageClassName:r="h-6 w-6",textClassName:n="text-2xl leading-none"}){const d=Ie(s,l);return Re(d)?e.jsx("img",{src:d,alt:"",className:`${r} object-contain`}):e.jsx("span",{className:n,children:d})}function F({panelKey:s,openPanel:l,onToggle:r,title:n,subtitle:d,children:u}){const a=l===s;return e.jsxs("section",{className:"overflow-hidden rounded-2xl border border-stone-200 bg-white shadow-sm",children:[e.jsxs("button",{type:"button",onClick:()=>r(s),className:"flex w-full items-center gap-3 px-4 py-3 text-left transition hover:bg-stone-50",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm text-stone-800",children:n}),e.jsx("p",{className:"truncate text-xs text-stone-500",children:d})]}),e.jsx("span",{className:`text-xl leading-none text-stone-400 transition-transform ${a?"rotate-90":""}`,"aria-hidden":"true",children:"â€º"})]}),a&&e.jsx("div",{className:"border-t border-stone-200 p-4",children:u})]})}function Oe({logs:s,chatProfiles:l,settings:r,onSettingChange:n,onImportChatLogFiles:d,onImportChatLogFolderFiles:u,onClearAllChatLogs:a,onDeleteChatLog:v,onSaveChatProfile:f,onDeleteChatProfile:w,onBindLogProfile:k,onExit:A}){const[B,T]=i.useState(""),[j,x]=i.useState(""),[N,g]=i.useState(r.chatAppDefaultProfileId),[y,z]=i.useState(""),[U,J]=i.useState("messages"),[D,q]=i.useState("data"),[H,E]=i.useState(r.chatReadBgImageUrl),[Q,O]=i.useState(!1),[P,S]=i.useState(X),[L,K]=i.useState(""),[M,o]=i.useState(null),m=i.useMemo(()=>s.find(t=>t.name===B)??null,[s,B]),C=i.useMemo(()=>{const t=ue(y);return t?s.filter(c=>ue(c.name).includes(t)):s},[s,y]),I=i.useMemo(()=>l.find(t=>t.id===N)??l[0]??null,[l,N]),re=i.useMemo(()=>l.find(t=>t.id===j)??I,[l,j,I]);i.useEffect(()=>{g(r.chatAppDefaultProfileId)},[r.chatAppDefaultProfileId]),i.useEffect(()=>{E(r.chatReadBgImageUrl)},[r.chatReadBgImageUrl]),i.useEffect(()=>{if(m){x(m.profileId??N);return}x("")},[m?.name,m?.profileId,N]),i.useEffect(()=>{!N||l.some(c=>c.id===N)||(g(""),n({chatAppDefaultProfileId:""}))},[l,N,n]),i.useEffect(()=>{if(!L)return;const t=l.find(c=>c.id===L);if(!t){K(""),o(null);return}o({name:t.name,leftNick:t.leftNick,rightNick:t.rightNick,leftAvatarDataUrl:t.leftAvatarDataUrl,rightAvatarDataUrl:t.rightAvatarDataUrl})},[l,L]);const me=i.useCallback(t=>{T(t)},[]),se=i.useCallback(()=>{if(!s.length)return;const t=s[Math.floor(Math.random()*s.length)];T(t.name)},[s]),ae=r.chatAppShowLabels,he=xe(I?.leftNick,"Michael"),fe=I?`${xe(I.rightNick,"ä½ ")} â™¡`:"ðŸ¥º â¤ï¸",le=I?.leftAvatarDataUrl||I?.rightAvatarDataUrl,R=r.chatNightMode,b=i.useMemo(()=>$e(R,r),[R,r.chatBackgroundColor,r.chatUserBubbleColor,r.chatUserBubbleBorderColor,r.chatAiBubbleColor,r.chatAiBubbleBorderColor]),ne=i.useMemo(()=>R?{backgroundColor:b.bg}:Se(r.chatReadBgColor,r.chatReadBgImageUrl,r.chatReadBgOverlay),[R,b.bg,r.chatReadBgColor,r.chatReadBgImageUrl,r.chatReadBgOverlay]);function ge(t){g(t),n({chatAppDefaultProfileId:t})}function G(t,c){n({[t]:c})}function ye(t,c){if(!c)return;const h=new FileReader;h.onload=()=>{const p=typeof h.result=="string"?h.result:"";p&&G(t,p)},h.readAsDataURL(c)}function je(t){if(!t)return;const c=new FileReader;c.onload=()=>{const h=typeof c.result=="string"?c.result:"";h&&(E(h),n({chatReadBgImageUrl:h}))},c.readAsDataURL(t)}function W(t){q(c=>c===t?null:t)}function V(t,c,h){if(!c)return;const p=new FileReader;p.onload=()=>{const $=typeof p.result=="string"?p.result:"";$&&h(we=>({...we,[t]:$}))},p.readAsDataURL(c)}async function Ne(){!P.name.trim()||!await f({...P,id:`profile-${Date.now()}`})||(O(!1),S(X()),te({kind:"success",message:"è§’è‰²è¨­å®šå·²å„²å­˜"}))}async function ve(){!L||!M||!M.name.trim()||!await f({...M,id:L})||(K(""),o(null),te({kind:"success",message:"è§’è‰²è¨­å®šå·²å„²å­˜"}))}return m?e.jsx(Ue,{log:m,chatProfiles:l,selectedProfileId:j,selectedProfile:re,onSelectProfile:t=>{x(t),k?.(m.name,t)},backgroundStyle:ne,theme:b,onBack:()=>T(""),onExit:A}):e.jsxs("div",{className:"mx-auto flex h-full w-full max-w-xl flex-col overflow-hidden",style:ne,children:[e.jsx("header",{className:"shrink-0 px-4 pb-3 pt-[max(0.75rem,env(safe-area-inset-top))]",style:{backgroundColor:b.barBg,borderBottom:`1px solid ${b.barBorder}`},children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[A?e.jsx("button",{type:"button",onClick:A,className:"h-9 w-9 rounded-full text-xl leading-none transition active:scale-95",style:{background:b.btnBg,border:`1px solid ${b.btnBorder}`,color:b.btnColor},"aria-label":"è¿”å›ž",title:"è¿”å›ž",children:e.jsx("span",{style:{transform:"translateY(-1px)",display:"block"},children:"â€¹"})}):e.jsx("span",{className:"h-9 w-9"}),e.jsx("h1",{className:"font-normal tracking-wide",style:{fontSize:"var(--ui-header-title-size, 17px)",color:b.titleColor},children:U==="messages"?"æ¶ˆæ¯":U==="discover"?"ç™¼ç¾":"æˆ‘"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{type:"button",onClick:()=>n({chatNightMode:!R}),className:"h-9 w-9 rounded-full text-lg leading-none transition active:scale-95",style:{background:R?"#3a3a3c":b.btnBg,border:`1px solid ${b.btnBorder}`,color:R?"#ffd60a":b.btnColor},"aria-label":R?"åˆ‡æ›æ—¥é–“æ¨¡å¼":"åˆ‡æ›å¤œé–“æ¨¡å¼",title:R?"æ—¥é–“æ¨¡å¼":"å¤œé–“æ¨¡å¼",children:R?"â˜€":"â˜½"}),e.jsx("button",{type:"button",onClick:se,disabled:!s.length,className:"h-9 w-9 rounded-full text-xl leading-none transition active:scale-95 disabled:opacity-40",style:{background:b.btnBg,border:`1px solid ${b.btnBorder}`,color:b.btnColor},"aria-label":"éš¨æ©Ÿæ‰“é–‹",title:"éš¨æ©Ÿæ‰“é–‹",children:"ï¼‹"})]})]})}),e.jsxs("main",{className:"min-h-0 flex-1 overflow-y-auto",children:[U==="messages"&&e.jsxs("div",{style:{backgroundColor:b.barBg},children:[e.jsxs("button",{type:"button",onClick:se,disabled:!s.length,className:"flex w-full items-center gap-3 px-4 py-3 text-left transition disabled:opacity-40",style:{backgroundColor:"transparent"},children:[le?e.jsx("img",{src:le,alt:"",className:"h-14 w-14 rounded-xl object-cover"}):e.jsx("div",{className:"grid h-14 w-14 place-items-center rounded-xl text-2xl",style:{backgroundColor:b.btnBg,color:b.subtitleColor},children:"ðŸ’¬"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate",style:{fontSize:"var(--chat-contact-title-size, 15px)",lineHeight:1.3,color:b.titleColor},children:he}),e.jsx("p",{className:"mt-0.5 truncate",style:{fontSize:"var(--chat-contact-subtitle-size, 14px)",lineHeight:1.3,color:b.subtitleColor},children:fe})]}),e.jsx("span",{style:{color:b.subtitleColor},className:"text-lg",children:"â€º"})]}),e.jsx("div",{className:"mx-4 h-px",style:{backgroundColor:b.dividerColor}}),!s.length&&e.jsx("p",{className:"px-4 py-8 text-center text-sm",style:{color:b.subtitleColor},children:"è«‹å…ˆåˆ°ã€Œæˆ‘ã€åˆ†é åŒ¯å…¥å°è©±ç´€éŒ„"})]}),U==="discover"&&e.jsxs("div",{className:"space-y-3 px-3 py-3",children:[e.jsx("div",{className:"rounded-2xl border border-stone-200 bg-white p-3 shadow-sm",children:e.jsx("input",{type:"search",value:y,onChange:t=>z(t.target.value),placeholder:"æœå°‹æª”å",className:"w-full rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm text-stone-800 outline-none focus:border-stone-500"})}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-stone-200 bg-white shadow-sm",children:[e.jsx("ul",{className:"divide-y divide-stone-100",children:C.map(t=>e.jsx("li",{children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[e.jsxs("button",{type:"button",onClick:()=>me(t.name),className:"flex min-w-0 flex-1 items-center justify-between gap-3 rounded-xl px-2 py-2 text-left transition active:bg-stone-100",children:[e.jsx("span",{className:"min-w-0 flex-1 truncate text-sm text-stone-800",children:_(t.name)}),e.jsx("span",{className:"text-xs text-stone-400",children:"â€º"})]}),e.jsx("button",{type:"button",onClick:()=>{window.confirm(`è¦åˆªé™¤é€™ä»½å°è©±ç´€éŒ„å—Žï¼Ÿ

${_(t.name)}`)&&v(t.name)},className:"inline-flex h-8 w-8 items-center justify-center rounded-full border border-rose-200 bg-rose-50 text-sm text-rose-600 transition active:scale-95","aria-label":`åˆªé™¤ ${_(t.name)}`,title:"åˆªé™¤",children:"âœ•"})]})},t.name))}),!C.length&&e.jsx("p",{className:"px-4 py-6 text-center text-sm text-stone-400",children:"æ²’æœ‰ç¬¦åˆçš„ç´€éŒ„"})]})]}),U==="me"&&e.jsxs("div",{className:"space-y-3 px-3 py-3",children:[e.jsxs(F,{panelKey:"nav",openPanel:D,onToggle:W,title:"åº•éƒ¨åˆ†é åœ–ç¤º",subtitle:"å¯è¼¸å…¥ç¬¦è™Ÿ / è²¼åœ–ç‰‡ç¶²å€ / ç›´æŽ¥ä¸Šå‚³åœ–ç‰‡",children:[e.jsx("div",{className:"space-y-2",children:[{label:"æ¶ˆæ¯",field:"chatAppMessagesIcon",value:r.chatAppMessagesIcon,fallback:"ðŸ’¬"},{label:"ç™¼ç¾",field:"chatAppDiscoverIcon",value:r.chatAppDiscoverIcon,fallback:"âœ¨"},{label:"æˆ‘",field:"chatAppMeIcon",value:r.chatAppMeIcon,fallback:"ðŸ‘¤"}].map(t=>e.jsxs("div",{className:"space-y-1.5 rounded-xl border border-stone-200 bg-stone-50 p-2.5",children:[e.jsx("p",{className:"text-xs text-stone-600",children:t.label}),e.jsxs("div",{className:"grid grid-cols-[2.5rem_1fr_auto_auto] items-center gap-2",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl border border-stone-300 bg-white",children:e.jsx(be,{icon:t.value,fallback:t.fallback,imageClassName:"h-6 w-6"})}),e.jsx("input",{type:"text",value:t.value,onChange:c=>G(t.field,c.target.value),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-2 text-sm",placeholder:t.fallback}),e.jsxs("label",{className:"inline-flex h-10 w-10 cursor-pointer items-center justify-center rounded-lg border border-stone-300 bg-white text-sm text-stone-700 transition active:scale-95",children:["â¤´",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:c=>{ye(t.field,c.target.files?.[0]),c.currentTarget.value=""}})]}),e.jsx("button",{type:"button",onClick:()=>G(t.field,""),className:"inline-flex h-10 w-10 items-center justify-center rounded-lg border border-stone-300 bg-white text-sm text-stone-700 transition active:scale-95","aria-label":"é‚„åŽŸ",title:"é‚„åŽŸ",children:"â†º"})]})]},t.field))}),e.jsxs("label",{className:"mt-3 flex items-center justify-between rounded-xl border border-stone-200 bg-stone-50 px-3 py-2 text-sm text-stone-700",children:[e.jsx("span",{children:"é¡¯ç¤ºæ–‡å­—"}),e.jsx("input",{type:"checkbox",checked:r.chatAppShowLabels,onChange:t=>n({chatAppShowLabels:t.target.checked}),className:"h-4 w-4 accent-stone-900"})]}),e.jsxs("label",{className:"mt-2 block space-y-1 rounded-xl border border-stone-200 bg-stone-50 px-3 py-2",children:[e.jsxs("span",{className:"flex items-center justify-between text-xs text-stone-600",children:[e.jsx("span",{children:"è¯çµ¡äººåç¨±å¤§å°"}),e.jsxs("span",{children:[r.chatContactNameSize,"px"]})]}),e.jsx("input",{type:"range",min:11,max:24,step:1,value:r.chatContactNameSize,onChange:t=>n({chatContactNameSize:Number(t.target.value)}),className:"w-full accent-stone-800"})]})]}),e.jsxs(F,{panelKey:"data",openPanel:D,onToggle:W,title:"å°è©±è³‡æ–™",subtitle:`ç›®å‰ ${s.length} ä»½`,children:[e.jsxs("div",{className:"mb-3 flex items-end justify-between gap-3",children:[e.jsx("p",{className:"text-xs text-stone-500",children:"æ”¯æ´ txt / md / json / docx"}),e.jsx("button",{type:"button",onClick:a,disabled:!s.length,className:"rounded-lg border border-rose-200 bg-rose-50 px-2.5 py-1.5 text-xs text-rose-700 disabled:opacity-50",children:"æ¸…ç©º"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"cursor-pointer rounded-xl bg-stone-900 py-2.5 text-center text-sm text-white transition active:opacity-80",children:["åŒ¯å…¥æª”æ¡ˆ",e.jsx("input",{type:"file",multiple:!0,accept:".txt,.md,.json,.docx",className:"hidden",onChange:t=>{const c=t.target.files?Array.from(t.target.files):[];c.length&&d(c),t.currentTarget.value=""}})]}),e.jsxs("label",{className:"cursor-pointer rounded-xl bg-stone-900 py-2.5 text-center text-sm text-white transition active:opacity-80",children:["åŒ¯å…¥è³‡æ–™å¤¾",e.jsx("input",{type:"file",webkitdirectory:"",multiple:!0,accept:".txt,.md,.json,.docx",className:"hidden",onChange:t=>{const c=t.target.files?Array.from(t.target.files):[];c.length&&u(c),t.currentTarget.value=""}})]})]})]}),e.jsx(F,{panelKey:"defaultProfile",openPanel:D,onToggle:W,title:"é è¨­è§’è‰²",subtitle:"æ¶ˆæ¯é é ­åƒ / åç¨±æœƒè·Ÿéš¨é€™çµ„",children:e.jsxs("select",{value:N,onChange:t=>ge(t.target.value),className:"w-full rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm text-stone-700",children:[e.jsx("option",{value:"",children:"é è¨­ï¼ˆä½  / Mï¼‰"}),l.map(t=>e.jsxs("option",{value:t.id,children:[t.name,"ï¼ˆ",t.rightNick," / ",t.leftNick,"ï¼‰"]},t.id))]})}),e.jsx(F,{panelKey:"bubble",openPanel:D,onToggle:W,title:"æ³¡æ³¡å¤–è§€",subtitle:"æ¨£å¼ / åœ“è§’ / é¡è‰²",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n({chatBubbleStyle:"jelly"}),className:`rounded-lg border px-3 py-2 text-sm ${r.chatBubbleStyle==="jelly"?"border-stone-900 bg-stone-900 text-white":"border-stone-300 bg-white text-stone-700"}`,children:"QQ æžœå‡"}),e.jsx("button",{type:"button",onClick:()=>n({chatBubbleStyle:"imessage"}),className:`rounded-lg border px-3 py-2 text-sm ${r.chatBubbleStyle==="imessage"?"border-stone-900 bg-stone-900 text-white":"border-stone-300 bg-white text-stone-700"}`,children:"iMessage"}),e.jsx("button",{type:"button",onClick:()=>n({chatBubbleStyle:"imessageClassic"}),className:`rounded-lg border px-3 py-2 text-sm ${r.chatBubbleStyle==="imessageClassic"?"border-stone-900 bg-stone-900 text-white":"border-stone-300 bg-white text-stone-700"}`,children:"iMessage+"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsxs("span",{className:"flex items-center justify-between text-xs text-stone-600",children:[e.jsx("span",{children:"æ³¡æ³¡åœ“è§’"}),e.jsxs("span",{children:[r.chatBubbleRadius,"px"]})]}),e.jsx("input",{type:"range",min:10,max:36,step:1,value:r.chatBubbleRadius,onChange:t=>n({chatBubbleRadius:Number(t.target.value)}),className:"w-full accent-stone-800"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"æˆ‘æ–¹åº•è‰²"}),e.jsx("input",{type:"color",value:r.chatUserBubbleColor,onChange:t=>n({chatUserBubbleColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"å°æ–¹åº•è‰²"}),e.jsx("input",{type:"color",value:r.chatAiBubbleColor,onChange:t=>n({chatAiBubbleColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"æˆ‘æ–¹é‚Šæ¡†"}),e.jsx("input",{type:"color",value:r.chatUserBubbleBorderColor,onChange:t=>n({chatUserBubbleBorderColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"å°æ–¹é‚Šæ¡†"}),e.jsx("input",{type:"color",value:r.chatAiBubbleBorderColor,onChange:t=>n({chatAiBubbleBorderColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"æˆ‘æ–¹æ–‡å­—"}),e.jsx("input",{type:"color",value:r.chatUserBubbleTextColor,onChange:t=>n({chatUserBubbleTextColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"å°æ–¹æ–‡å­—"}),e.jsx("input",{type:"color",value:r.chatAiBubbleTextColor,onChange:t=>n({chatAiBubbleTextColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]})]})]})}),e.jsx(F,{panelKey:"background",openPanel:D,onToggle:W,title:"é–±è®€èƒŒæ™¯",subtitle:"å°è©±è¦–çª—å°ˆå±¬èƒŒæ™¯ï¼Œä¸å½±éŸ¿é¦–é ",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:De.map(t=>{const c=r.chatReadBgColor.toLowerCase()===t.toLowerCase();return e.jsx("button",{type:"button",onClick:()=>n({chatReadBgColor:t}),className:`h-7 w-7 rounded-full border transition active:scale-95 ${c?"border-stone-900 ring-2 ring-stone-300":"border-stone-300"}`,style:{background:t},"aria-label":`èƒŒæ™¯è‰² ${t}`,title:t},t)})}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"è‡ªè¨‚åº•è‰²"}),e.jsx("input",{type:"color",value:r.chatReadBgColor,onChange:t=>n({chatReadBgColor:t.target.value}),className:"h-10 w-full rounded-md border border-stone-300"})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-600",children:"èƒŒæ™¯åœ–ç‰‡ URL"}),e.jsx("input",{type:"url",value:H,onChange:t=>E(t.target.value),placeholder:"https://.../chat-bg.jpg",className:"w-full rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm text-stone-700"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n({chatReadBgImageUrl:H.trim()}),className:"rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-700 transition active:scale-[0.99]",children:"å¥—ç”¨åœ–ç‰‡ URL"}),e.jsxs("label",{className:"cursor-pointer rounded-xl border border-stone-300 bg-white py-2 text-center text-sm text-stone-700 transition active:opacity-80",children:["ä¸Šå‚³åœ–ç‰‡",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{je(t.target.files?.[0]),t.currentTarget.value=""}})]})]}),e.jsxs("label",{className:"block space-y-1",children:[e.jsxs("span",{className:"flex items-center justify-between text-xs text-stone-600",children:[e.jsx("span",{children:"åœ–ç‰‡é®ç½©"}),e.jsxs("span",{children:[r.chatReadBgOverlay,"%"]})]}),e.jsx("input",{type:"range",min:0,max:90,step:1,value:r.chatReadBgOverlay,onChange:t=>n({chatReadBgOverlay:Number(t.target.value)}),className:"w-full accent-stone-800"})]}),e.jsx("button",{type:"button",onClick:()=>{E(""),n({chatReadBgImageUrl:"",chatReadBgOverlay:0})},className:"w-full rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-700 transition active:scale-[0.99]",children:"ç§»é™¤èƒŒæ™¯åœ–ç‰‡"})]})}),e.jsx(F,{panelKey:"profiles",openPanel:D,onToggle:W,title:"èŠå¤©è§’è‰²è¨­å®šï¼ˆæ´—è§’è‰²åç¨±ï¼‰",subtitle:`å…± ${l.length} çµ„`,children:e.jsxs("div",{className:"space-y-3",children:[l.length===0&&e.jsx("p",{className:"text-xs text-stone-400",children:"å°šæœªå»ºç«‹è§’è‰²è¨­å®šï¼Œé è¨­ç‚ºã€Œä½ ã€/ã€ŒMã€ã€‚"}),e.jsx("div",{className:"space-y-2",children:l.map(t=>{const c=L===t.id&&!!M;return e.jsx("div",{className:"rounded-lg border border-stone-200 bg-stone-50 p-3",children:c?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:M.name,onChange:h=>o(p=>p&&{...p,name:h.target.value}),placeholder:"è¨­å®šåç¨±",className:"w-full rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{type:"text",value:M.rightNick,onChange:h=>o(p=>p&&{...p,rightNick:h.target.value}),placeholder:"å³å´æš±ç¨±ï¼ˆå¯ / åˆ†éš”ï¼‰",className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"}),e.jsx("input",{type:"text",value:M.leftNick,onChange:h=>o(p=>p&&{...p,leftNick:h.target.value}),placeholder:"å·¦å´æš±ç¨±ï¼ˆå¯ / åˆ†éš”ï¼‰",className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"å³å´é ­åƒ"}),e.jsx("input",{type:"file",accept:"image/*",onChange:h=>V("rightAvatarDataUrl",h.target.files?.[0],p=>o($=>$&&p($))),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs"})]}),e.jsxs("label",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"å·¦å´é ­åƒ"}),e.jsx("input",{type:"file",accept:"image/*",onChange:h=>V("leftAvatarDataUrl",h.target.files?.[0],p=>o($=>$&&p($))),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{ve()},className:"flex-1 rounded-xl bg-stone-900 py-2 text-sm text-white",children:"å„²å­˜"}),e.jsx("button",{type:"button",onClick:()=>{K(""),o(null)},className:"flex-1 rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-600",children:"å–æ¶ˆ"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm text-stone-800",children:t.name}),e.jsxs("p",{className:"text-xs text-stone-400",children:["å³ï¼š",t.rightNick," ï¼ å·¦ï¼š",t.leftNick]})]}),e.jsx("button",{type:"button",onClick:()=>{K(t.id),o({name:t.name,leftNick:t.leftNick,rightNick:t.rightNick,leftAvatarDataUrl:t.leftAvatarDataUrl,rightAvatarDataUrl:t.rightAvatarDataUrl})},className:"rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs text-stone-700",children:"ç·¨è¼¯"}),e.jsx("button",{type:"button",onClick:()=>w(t.id),className:"rounded-lg border border-rose-200 bg-rose-50 px-2 py-1 text-xs text-rose-600",children:"åˆªé™¤"})]})},t.id)})}),Q?e.jsxs("div",{className:"space-y-2 rounded-lg border border-violet-200 bg-violet-50 p-3",children:[e.jsx("input",{type:"text",placeholder:"è¨­å®šåç¨±ï¼Œä¾‹ï¼šå’Œ4oçš„å°è©±",value:P.name,onChange:t=>S(c=>({...c,name:t.target.value})),className:"w-full rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{type:"text",placeholder:"å³å´æš±ç¨±ï¼ˆå¯ / åˆ†éš”ï¼‰",value:P.rightNick,onChange:t=>S(c=>({...c,rightNick:t.target.value})),className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"}),e.jsx("input",{type:"text",placeholder:"å·¦å´æš±ç¨±ï¼ˆå¯ / åˆ†éš”ï¼‰",value:P.leftNick,onChange:t=>S(c=>({...c,leftNick:t.target.value})),className:"rounded-lg border border-stone-300 bg-white px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"å³å´é ­åƒ"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>V("rightAvatarDataUrl",t.target.files?.[0],S),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs"})]}),e.jsxs("label",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"å·¦å´é ­åƒ"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>V("leftAvatarDataUrl",t.target.files?.[0],S),className:"w-full rounded-lg border border-stone-300 bg-white px-2 py-1 text-xs"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{Ne()},className:"flex-1 rounded-xl bg-stone-900 py-2 text-sm text-white",children:"å„²å­˜"}),e.jsx("button",{type:"button",onClick:()=>{O(!1),S(X())},className:"flex-1 rounded-xl border border-stone-300 bg-white py-2 text-sm text-stone-600",children:"å–æ¶ˆ"})]})]}):e.jsx("button",{type:"button",onClick:()=>O(!0),className:"w-full rounded-xl border border-violet-200 bg-violet-50 py-2 text-sm text-violet-700",children:"ï¼‹ æ–°å¢žè§’è‰²è¨­å®š"})]})})]})]}),e.jsx("nav",{className:"shrink-0 px-5 pb-[max(1.25rem,env(safe-area-inset-bottom))] pt-2.5",style:{backgroundColor:b.barBg,borderTop:`1px solid ${b.barBorder}`},children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{tab:"messages",icon:r.chatAppMessagesIcon,fallback:"ðŸ’¬",label:"æ¶ˆæ¯"},{tab:"discover",icon:r.chatAppDiscoverIcon,fallback:"âœ¨",label:"ç™¼ç¾"},{tab:"me",icon:r.chatAppMeIcon,fallback:"ðŸ‘¤",label:"æˆ‘"}].map(({tab:t,icon:c,fallback:h,label:p})=>{const $=U===t;return e.jsxs("button",{type:"button",onClick:()=>J(t),className:`flex flex-col items-center rounded-xl px-2 py-1.5 transition ${ae?"gap-1 text-xs":"gap-0 text-base"}`,style:{color:$?b.titleColor:b.subtitleColor},"aria-label":p,children:[e.jsx(be,{icon:c,fallback:h,imageClassName:"h-6 w-6",textClassName:"text-2xl leading-none"}),ae&&e.jsx("span",{children:p})]},t)})})})]})}function Ue({log:s,chatProfiles:l,selectedProfileId:r,selectedProfile:n,onSelectProfile:d,backgroundStyle:u,theme:a,onBack:v,onExit:f}){const w=i.useRef(null),k=i.useRef(null),[A,B]=i.useState(!1),[T,j]=i.useState(!1),[x,N]=i.useState(()=>oe(s.name)),[g,y]=i.useState(null),[z,U]=i.useState(""),J=_(s.name),D=i.useMemo(()=>Ae(s.content,n),[s.content,n]);i.useEffect(()=>{const o=w.current;o&&o.scrollTo({top:o.scrollHeight})},[s.name,r]),i.useEffect(()=>{N(oe(s.name))},[s.name]);function q(){w.current?.scrollTo({top:0,behavior:"smooth"})}function H(){const o=w.current;o&&o.scrollTo({top:o.scrollHeight,behavior:"smooth"})}function E(o){const m=w.current;if(!m)return;const C=m.querySelector(`[data-msg-index="${o}"]`);C&&C.scrollIntoView({behavior:"smooth",block:"center"})}function Q(){const o=w.current;if(!o)return 0;const m=o.getBoundingClientRect().top,C=o.querySelectorAll("[data-msg-index]");for(const I of C)if(I.getBoundingClientRect().bottom>m+60)return Number(I.getAttribute("data-msg-index")??"0");return 0}function O(o,m){y({index:o,preview:m}),U("")}function P(){const o=Q(),m=D[o],C=m?m.content.slice(0,50):"";O(o,C)}function S(){if(!g)return;const o=z.trim()||g.preview.slice(0,20)||`æ›¸ç±¤ ${x.length+1}`,m={id:`bm-${Date.now()}`,messageIndex:g.index,label:o,preview:g.preview,createdAt:new Date().toISOString()},C=[...x,m];N(C),ce(s.name,C),y(null),te({kind:"success",message:"æ›¸ç±¤å·²æ–°å¢ž"})}function L(o){const m=x.filter(C=>C.id!==o);N(m),ce(s.name,m)}function K(o,m){k.current=setTimeout(()=>{O(o,m)},500)}function M(){k.current&&(clearTimeout(k.current),k.current=null)}return e.jsxs("div",{className:"relative mx-auto flex h-full w-full max-w-xl flex-col overflow-hidden",style:u,children:[e.jsx("div",{className:"shrink-0 px-3 pb-2 pt-[max(0.75rem,env(safe-area-inset-top))]",style:{backgroundColor:a.barBg,borderBottom:`1px solid ${a.barBorder}`},children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("button",{type:"button",onClick:v,className:"h-9 w-9 rounded-full text-xl leading-none transition active:scale-95",style:{background:a.btnBg,border:`1px solid ${a.btnBorder}`,color:a.btnColor},"aria-label":"è¿”å›ž",children:e.jsx("span",{style:{transform:"translateY(-1px)",display:"block"},children:"â€¹"})}),e.jsx("p",{className:"min-w-0 flex-1 truncate text-center text-sm font-medium",style:{color:a.titleColor},children:J}),f?e.jsx("button",{type:"button",onClick:f,className:"h-9 w-9 rounded-full text-xl leading-none transition active:scale-95",style:{background:a.btnBg,border:`1px solid ${a.btnBorder}`,color:a.btnColor},"aria-label":"é›¢é–‹",children:e.jsx("span",{style:{transform:"translateY(-1px)",display:"block"},children:"Ã—"})}):e.jsx("span",{className:"h-9 w-9"})]})}),e.jsx("div",{ref:w,id:"chat-messages",className:"min-h-0 flex-1 overflow-y-auto px-3 py-3",style:a.bubbleVarStyle,children:D.length>0?e.jsx(ze,{messages:D,profile:n,dateLabelColor:a.dateLabelColor,onPressStart:K,onPressEnd:M}):e.jsxs("p",{className:"rounded-2xl px-3 py-4 text-sm",style:{border:`1px solid ${a.barBorder}`,backgroundColor:a.btnBg,color:a.subtitleColor},children:["ç„¡æ³•è§£æžç‚ºèŠå¤©æ ¼å¼ï¼Œä»¥ä¸‹æ˜¯åŽŸæ–‡ï¼š",e.jsx("span",{className:"mt-2 block whitespace-pre-wrap rounded-xl p-3 text-left text-xs",style:{border:`1px solid ${a.barBorder}`,backgroundColor:a.inputBg,color:a.inputText},children:s.content})]})}),A&&e.jsxs("div",{className:"pointer-events-none absolute bottom-24 right-4 z-10 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:q,className:"pointer-events-auto flex h-11 w-11 items-center justify-center rounded-full shadow-md transition active:scale-95",style:{background:a.floatBtnBg,border:`1px solid ${a.floatBtnBorder}`,color:a.floatBtnColor},"aria-label":"å›žåˆ°é ‚éƒ¨",children:e.jsx(Me,{})}),e.jsx("button",{type:"button",onClick:H,className:"pointer-events-auto flex h-11 w-11 items-center justify-center rounded-full shadow-md transition active:scale-95",style:{background:a.floatBtnBg,border:`1px solid ${a.floatBtnBorder}`,color:a.floatBtnColor},"aria-label":"å›žåˆ°åº•éƒ¨",children:e.jsx(Le,{})})]}),e.jsx("div",{className:"shrink-0 px-5 pb-[max(1.25rem,env(safe-area-inset-bottom))] pt-3",style:{backgroundColor:a.barBg,borderTop:`1px solid ${a.barBorder}`},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:P,className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-xl transition active:scale-95",style:{background:a.btnBg,border:`1px solid ${a.btnBorder}`,color:a.btnColor},"aria-label":"æ–°å¢žæ›¸ç±¤",title:"æ–°å¢žæ›¸ç±¤ï¼ˆç•¶å‰ä½ç½®ï¼‰",children:e.jsx("span",{style:{transform:"translateY(-1px)",display:"block"},children:"+"})}),e.jsxs("button",{type:"button",onClick:()=>j(!0),className:"relative flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-xl transition active:scale-95",style:{background:a.btnBg,border:`1px solid ${a.btnBorder}`},"aria-label":"æ›¸ç±¤æ¸…å–®",children:["ðŸ”–",x.length>0&&e.jsx("span",{className:"absolute -right-0.5 -top-0.5 flex h-4 w-4 items-center justify-center rounded-full bg-rose-500 text-[10px] font-bold text-white",children:x.length>9?"9+":x.length})]}),e.jsx("div",{className:"relative min-w-0 flex-1",children:l.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:r,onChange:o=>d(o.target.value),className:"h-10 w-full appearance-none rounded-full pl-4 pr-8 text-sm",style:{background:a.inputBg,border:`1px solid ${a.inputBorder}`,color:a.inputText},children:[e.jsx("option",{value:"",children:"è§’è‰²é è¨­"}),l.map(o=>e.jsxs("option",{value:o.id,children:[o.name,"ï¼ˆ",o.rightNick," / ",o.leftNick,"ï¼‰"]},o.id))]}),e.jsx("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-xs",style:{color:a.subtitleColor},children:"â–¾"})]}):e.jsx("div",{className:"h-10 rounded-full px-4 text-sm leading-10",style:{background:a.inputBg,border:`1px solid ${a.inputBorder}`,color:a.subtitleColor},children:"å°šæœªå»ºç«‹è§’è‰²è¨­å®š"})}),e.jsx("button",{type:"button",onClick:()=>B(o=>!o),className:`flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-white shadow-sm transition active:scale-95 ${A?"bg-blue-600":"bg-blue-500"}`,"aria-label":"å¿«é€Ÿå°Žèˆªé–‹é—œ",children:e.jsx(Pe,{})})]})}),T&&e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col justify-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>j(!1)}),e.jsxs("div",{className:"relative z-10 flex max-h-[70%] flex-col rounded-t-3xl shadow-xl",style:{background:a.drawerBg},children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between px-5 pb-3 pt-4",style:{borderBottom:`1px solid ${a.drawerDivider}`},children:[e.jsx("h2",{className:"text-base font-medium",style:{color:a.drawerTitleColor},children:"æ›¸ç±¤"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"flex h-7 w-7 items-center justify-center rounded-full text-sm",style:{background:a.btnBg,color:a.btnColor},children:e.jsx("span",{style:{transform:"translateY(-1px)",display:"block"},children:"Ã—"})})]}),e.jsx("div",{className:"min-h-0 flex-1 overflow-y-auto pb-[max(1.25rem,env(safe-area-inset-bottom))]",children:x.length===0?e.jsxs("p",{className:"px-5 py-10 text-center text-sm",style:{color:a.drawerSubColor},children:["é‚„æ²’æœ‰æ›¸ç±¤",e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"é•·æŒ‰è¨Šæ¯æ³¡æ³¡ æˆ– é»ž + å¯æ–°å¢ž"})]}):e.jsx("ul",{children:x.map(o=>e.jsxs("li",{className:"flex items-center gap-3 px-5 py-3",style:{borderBottom:`1px solid ${a.drawerDivider}`},children:[e.jsxs("button",{type:"button",onClick:()=>{E(o.messageIndex),j(!1)},className:"min-w-0 flex-1 text-left",children:[e.jsx("p",{className:"truncate text-sm",style:{color:a.drawerTitleColor},children:o.label}),e.jsx("p",{className:"mt-0.5 truncate text-xs",style:{color:a.drawerSubColor},children:o.preview})]}),e.jsx("button",{type:"button",onClick:()=>L(o.id),className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full border border-rose-200 bg-rose-50 text-xs text-rose-500","aria-label":"åˆªé™¤æ›¸ç±¤",children:"âœ•"})]},o.id))})})]})]}),g&&e.jsxs("div",{className:"absolute inset-0 z-30 flex items-center justify-center px-6",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>y(null)}),e.jsxs("div",{className:"relative z-10 w-full max-w-sm rounded-2xl p-5 shadow-xl",style:{background:a.drawerBg},children:[e.jsx("h2",{className:"mb-1 text-base font-medium",style:{color:a.drawerTitleColor},children:"æ–°å¢žæ›¸ç±¤"}),e.jsx("p",{className:"mb-3 truncate text-xs",style:{color:a.drawerSubColor},children:g.preview}),e.jsx("input",{type:"text",value:z,onChange:o=>U(o.target.value),onKeyDown:o=>{o.key==="Enter"&&S(),o.key==="Escape"&&y(null)},placeholder:"æ›¸ç±¤åç¨±ï¼ˆå¯ç•™ç©ºï¼‰",className:"mb-3 w-full rounded-xl px-4 py-2.5 text-sm outline-none",style:{background:a.inputBg,border:`1px solid ${a.inputBorder}`,color:a.inputText},autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:S,className:"flex-1 rounded-xl py-2.5 text-sm text-white transition active:opacity-80",style:{background:a.night?"#3a3a3c":"#1c1c1e"},children:"æ–°å¢ž"}),e.jsx("button",{type:"button",onClick:()=>y(null),className:"flex-1 rounded-xl py-2.5 text-sm transition active:opacity-80",style:{background:a.btnBg,border:`1px solid ${a.btnBorder}`,color:a.btnColor},children:"å–æ¶ˆ"})]})]})]})]})}function Me(){return e.jsx("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"2.5,10.5 7.5,4.5 12.5,10.5"})})}function Le(){return e.jsx("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"2.5,4.5 7.5,10.5 12.5,4.5"})})}function Pe(){return e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})})}function ze({messages:s,profile:l,dateLabelColor:r,onPressStart:n,onPressEnd:d}){return e.jsx("div",{className:"flex flex-col gap-1.5",children:s.map((u,a)=>{const v=u.role==="user",f=v?l?.rightAvatarDataUrl:l?.leftAvatarDataUrl,w=u.content.slice(0,50),k=u.time&&(a===0||s[a-1]?.time?.slice(0,10)!==u.time.slice(0,10))?u.time.slice(0,10):null;return e.jsxs("div",{"data-msg-index":a,children:[k&&e.jsx("div",{className:"my-3 text-center text-[11px]",style:r?{color:r}:void 0,children:k}),e.jsxs("div",{className:`flex items-end gap-2 ${v?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:"mb-4 shrink-0",children:f?e.jsx("img",{src:f,alt:"",className:"h-8 w-8 rounded-full object-cover"}):e.jsx("div",{className:`grid h-8 w-8 place-items-center rounded-full text-xs font-medium text-white ${v?"bg-emerald-400":"bg-sky-300"}`,children:v?l?.rightNick?.[0]??"ä½ ":l?.leftNick?.[0]??"M"})}),e.jsxs("div",{className:`flex max-w-[75%] flex-col gap-0.5 ${v?"items-end":"items-start"}`,children:[e.jsx("div",{className:`message-bubble ${v?"user":"ai"}`,onMouseDown:()=>n?.(a,w),onMouseUp:()=>d?.(),onMouseLeave:()=>d?.(),onTouchStart:()=>n?.(a,w),onTouchEnd:()=>d?.(),onTouchCancel:()=>d?.(),children:e.jsx("div",{className:"content",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:u.content})}),u.time&&e.jsx("p",{className:"px-1 text-[10px]",style:r?{color:r}:void 0,children:u.time.slice(11,16)})]})]})]},`${a}-${u.time??""}`)})})}export{Oe as ChatLogPage};
