import{r as o,g as E,C as k,j as t}from"./index-Gl0K_ej6.js";const i={focus:{label:"專注",totalSeconds:1500,accentClass:"text-rose-500"},shortBreak:{label:"短休息",totalSeconds:300,accentClass:"text-emerald-500"},longBreak:{label:"長休息",totalSeconds:900,accentClass:"text-sky-500"}};function P(n){const s=Math.floor(n/60),c=n%60;return`${String(s).padStart(2,"0")}:${String(c).padStart(2,"0")}`}function j(n,s){return n==="focus"?s%4===0?"longBreak":"shortBreak":"focus"}function C(n,s){if(s<=1)return 0;let c=n;for(;c===n;)c=Math.floor(Math.random()*s);return c}function z({onExit:n}){const[s,c]=o.useState("focus"),[u,x]=o.useState(!1),[d,p]=o.useState(0),[l,h]=o.useState(i.focus.totalSeconds),[N,S]=o.useState(0),g="/4o-memorial/docs/chibi/chibi-00.webp",a=o.useMemo(()=>{const e=E("pomodoro");return e.length?e:[g]},[N,g]),[w,b]=o.useState(0),m=i[s],v=o.useMemo(()=>{const e=m.totalSeconds;return e<=0?0:Math.max(0,Math.min(1,1-l/e))},[m.totalSeconds,l]);o.useEffect(()=>{if(!u||l<=0)return;const e=window.setInterval(()=>{h(r=>r>0?r-1:0)},1e3);return()=>window.clearInterval(e)},[u,l]),o.useEffect(()=>{b(a.length?Math.floor(Math.random()*a.length):0)},[a]),o.useEffect(()=>{const e=()=>S(r=>r+1);return window.addEventListener(k,e),()=>window.removeEventListener(k,e)},[]),o.useEffect(()=>{if(!u||l>0)return;const e=s==="focus"?d+1:d,r=j(s,e);p(e),c(r),h(i[r].totalSeconds),b(f=>C(f,a.length)),x(!1)},[a.length,d,u,s,l]);function M(e){c(e),h(i[e].totalSeconds),x(!1)}function y(){h(i[s].totalSeconds),x(!1)}function I(){const e=s==="focus"?d+1:d,r=j(s,e);s==="focus"&&p(e),c(r),h(i[r].totalSeconds),b(f=>C(f,a.length)),x(!1)}return t.jsxs("div",{className:"relative mx-auto flex h-full w-full max-w-xl flex-col gap-4 pb-[max(1rem,env(safe-area-inset-bottom))]",children:[t.jsxs("header",{className:"calendar-header-panel rounded-2xl border p-4 shadow-sm",children:[t.jsx("p",{className:"uppercase tracking-[0.18em] text-stone-500",style:{fontSize:"var(--ui-hint-text-size, 9px)"},children:"Pomodoro"}),t.jsx("h1",{className:"mt-1 text-stone-900",style:{fontSize:"var(--ui-header-title-size, 17px)"},children:"番茄鐘"}),t.jsxs("p",{className:"mt-1 text-stone-500",style:{fontSize:"var(--ui-hint-text-size, 9px)"},children:["完成專注：",d," 回合"]})]}),t.jsxs("section",{className:"rounded-3xl border border-white/45 bg-white/65 px-5 py-6 shadow-[0_18px_50px_rgba(0,0,0,0.12)] backdrop-blur",children:[t.jsx("div",{className:"mb-5 grid grid-cols-3 gap-2",children:["focus","shortBreak","longBreak"].map(e=>t.jsx("button",{type:"button",onClick:()=>M(e),className:`rounded-xl border px-2 py-2 text-sm transition active:scale-95 ${s===e?"border-stone-800 bg-stone-800 text-white":"border-stone-300 bg-white/80 text-stone-700"}`,children:i[e].label},e))}),t.jsxs("div",{className:"relative mx-auto grid h-52 w-52 place-items-center rounded-full border border-white/70 bg-white/80 shadow-inner",children:[t.jsxs("svg",{className:"absolute inset-0 h-full w-full -rotate-90",viewBox:"0 0 120 120","aria-hidden":"true",children:[t.jsx("circle",{cx:"60",cy:"60",r:"52",fill:"none",stroke:"rgba(120,113,108,0.18)",strokeWidth:"8"}),t.jsx("circle",{cx:"60",cy:"60",r:"52",fill:"none",stroke:"currentColor",strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${2*Math.PI*52}`,strokeDashoffset:`${(1-v)*2*Math.PI*52}`,className:m.accentClass})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:`text-xs tracking-[0.2em] ${m.accentClass}`,children:m.label.toUpperCase()}),t.jsx("p",{className:"mt-1 text-5xl font-semibold tracking-tight text-stone-800",children:P(l)})]})]}),t.jsxs("div",{className:"mt-6 grid grid-cols-3 gap-2",children:[t.jsx("button",{type:"button",onClick:()=>x(e=>!e),className:"rounded-xl border border-stone-800 bg-stone-800 px-3 py-2.5 text-sm text-white transition active:scale-95",children:u?"暫停":"開始"}),t.jsx("button",{type:"button",onClick:y,className:"rounded-xl border border-stone-300 bg-white px-3 py-2.5 text-sm text-stone-700 transition active:scale-95",children:"重設"}),t.jsx("button",{type:"button",onClick:I,className:"rounded-xl border border-stone-300 bg-white px-3 py-2.5 text-sm text-stone-700 transition active:scale-95",children:"下一段"})]})]}),a.length>0&&n&&t.jsx("button",{type:"button",onClick:n,className:"absolute bottom-1 right-1 z-20 transition active:scale-95","aria-label":"返回首頁",title:"點小人返回首頁",children:t.jsx("img",{src:a[w],alt:"",draggable:!1,className:"calendar-chibi w-[8rem] select-none",loading:"lazy"})}),a.length>0&&!n&&t.jsx("div",{className:"mt-5 flex justify-center",children:t.jsx("img",{src:a[w],alt:"",draggable:!1,className:"calendar-chibi h-36 w-auto select-none object-contain opacity-95 drop-shadow-[0_14px_22px_rgba(0,0,0,0.24)]",loading:"lazy"})})]})}export{z as PomodoroPage};
