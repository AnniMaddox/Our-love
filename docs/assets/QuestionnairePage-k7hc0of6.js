import{r as l,j as e,cz as G,fh as ge,cx as be}from"./index-BkQOYmZx.js";import{S as D}from"./SettingsAccordion-ByHAmhX4.js";const X="/Our-love/docs/",qe=`${X}data/questionnaire/index.json`,Z=`${X}chibi/chibi-00.webp`,ae="memorial-questionnaire-prefs-v1",_=/^(?:å›ç­”|ç­”è¦†|å›è¦†|ç­”æ¡ˆ|a)\s*[:ï¼š]/iu,W=/^(?:æƒ³èªªçš„è©±|mæƒ³èªª|çµ¦å¦³çš„ä¸€å¥è©±|çµ¦ä½ çš„ä¸€å¥è©±|è£œå……|èªªæ˜)\s*[:ï¼š]/iu,ie=/^(?:\d+ï¸âƒ£|[â‘ -â‘³]|\(?\d{1,2}\)?[.)ã€ï¼]|[ã€[]\d{1,2}[ã€‘\]]|(?:q|q\.)\s*\d+[:ï¼š.)ã€-]?|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]{1,3}[ã€.ï¼])\s*/iu,N={contentFontSize:16,contentLineHeight:1.85,showChibi:!0,chibiWidth:144,fontMode:"default"};function C(t,n,a,r){return typeof t!="number"||!Number.isFinite(t)?r:Math.max(n,Math.min(a,t))}function re(t,n,a,r){return Math.round(C(t,n,a,r))}function Ne(t){if(!t||typeof t!="object")return N;const n=t;return{contentFontSize:C(n.contentFontSize,12,24,N.contentFontSize),contentLineHeight:C(n.contentLineHeight,1.45,2.9,N.contentLineHeight),showChibi:n.showChibi!==!1,chibiWidth:re(n.chibiWidth,104,196,N.chibiWidth),fontMode:n.fontMode==="memo"?"memo":"default"}}function je(){if(typeof window>"u")return N;try{const t=window.localStorage.getItem(ae);return t?Ne(JSON.parse(t)):N}catch{return N}}function pe(t){typeof window>"u"||window.localStorage.setItem(ae,JSON.stringify(t))}function ee(t){const n=[...t];for(let a=n.length-1;a>0;a-=1){const r=Math.floor(Math.random()*(a+1)),o=n[a];n[a]=n[r],n[r]=o}return n}function ve(t){const n=new Set,a=[];for(const r of t)n.has(r)||(n.add(r),a.push(r));return a}function ye(){const t=ge("notes"),n=be();if(!t.length)return n;if(!n.length)return t;const a=Math.max(10,Math.min(40,t.length+n.length)),r=Math.max(1,Math.round(a*.7)),o=Math.max(1,a-r),g=ee(t).slice(0,Math.min(r,t.length)),d=ee(n).slice(0,Math.min(o,n.length));return ve([...g,...d])}function we(){const t=ye();return t.length?t[Math.floor(Math.random()*t.length)]??Z:Z}function P(t){return t.replace(/\u00a0/g," ").replace(/\r\n?/g,`
`).trim()}function ce(t){return t.replace(/\s+/g," ").trim()}function U(t){return t.replace(/^#{1,6}\s*/u,"").replace(/^[-*]\s+/u,"").trim()}function Se(t){return t.split(/\n+/).map(n=>ce(n)).filter(n=>n.length>0)}function Ce(t){const n=typeof t.id=="string"?t.id.trim():"",a=typeof t.title=="string"?t.title.trim():"",r=typeof t.contentPath=="string"?t.contentPath.trim():"";if(!n||!a||!r)return null;const o=typeof t.sourceFile=="string"&&t.sourceFile.trim()?t.sourceFile.trim():`${n}.txt`,g=typeof t.sourceRelPath=="string"&&t.sourceRelPath.trim()?t.sourceRelPath.trim():o,d=typeof t.writtenAt=="number"&&Number.isFinite(t.writtenAt)&&t.writtenAt>0?t.writtenAt:null,m=typeof t.dateLabel=="string"&&t.dateLabel.trim()?t.dateLabel.trim():"æƒ³å¦³çš„æ™‚å€™",f=typeof t.preview=="string"&&t.preview.trim()?t.preview.trim():"ï¼ˆæ²’æœ‰å…§å®¹ï¼‰",b=typeof t.questionCount=="number"&&Number.isFinite(t.questionCount)&&t.questionCount>=0?Math.round(t.questionCount):0,q=Array.isArray(t.tags)&&t.tags.length?t.tags.filter(p=>typeof p=="string"&&p.trim().length>0).slice(0,2):["QA"],E=typeof t.searchText=="string"&&t.searchText.trim()?t.searchText.trim():`${a}
${f}`;return{id:n,title:a,sourceFile:o,sourceRelPath:g,contentPath:r.replace(/^\.?\//,""),writtenAt:d,dateLabel:m,preview:f,questionCount:b,tags:q,searchText:E}}function Ee(t){const n=U(t.trim());return!n||_.test(n)||W.test(n)?!1:ie.test(n)?/[ï¼Ÿ?]/u.test(n)||/(?:æ˜¯ä»€éº¼|å¦‚ä½•|å“ª|æœ‰æ²’æœ‰|æœƒä¸æœƒ|æ˜¯å¦|å¦‚æœ|ç‚ºä»€éº¼|æ€éº¼|ä½•æ™‚|å¤šå°‘|å“ªè£¡)/u.test(n)?!0:n.length<=48:!!/^[^ï¼š:]{2,84}[ï¼Ÿ?]$/u.test(n)}function te(t){return U(t).replace(ie,"").replace(/\s+/g," ").trim()}function Me(t){const n=Array.from(t.matchAll(/ã€\s*(\d{1,2})\s*ã€‘\s*([^ã€]+)/gu));return n.length<3?[]:n.map(a=>({question:`å•é¡Œ ${a[1]}`,answer:P(a[2]??"")})).filter(a=>a.answer.length>0)}function ke(t){const n=Se(t),a=[];let r="",o=[];function g(){if(!r&&!o.length)return;const d=r||`å•é¡Œ ${a.length+1}`,m=P(o.join(`
`));m&&a.push({question:d,answer:m}),r="",o=[]}for(const d of n){const m=U(d);if(Ee(m)){g();const f=m.match(/^(.*?)(?:å›ç­”|ç­”è¦†|å›è¦†|ç­”æ¡ˆ|a)\s*[:ï¼š]\s*(.+)$/iu);if(f){r=te(f[1]??"")||`å•é¡Œ ${a.length+1}`;const b=ce(f[2]??"");b&&o.push(b);continue}r=te(m)||`å•é¡Œ ${a.length+1}`;continue}if(_.test(m)){r||(r=`å•é¡Œ ${a.length+1}`);const f=m.replace(_,"").trim();f&&o.push(f);continue}if(W.test(m)){r||(r=`å•é¡Œ ${a.length+1}`);const f=m.replace(W,"").trim();f&&o.push(f);continue}!r&&!a.length||(r||(r=`å•é¡Œ ${a.length+1}`),o.push(m))}if(g(),a.length<2){const d=Me(t);if(d.length>a.length)return d}if(!a.length){const d=P(t);return d?[{question:"å…§å®¹",answer:d}]:[]}return a}function se(t){return`CASE_${String(t+1).padStart(3,"0")}`}function ne(t,n=7){return t.length>n?`${t.slice(0,n)}â€¦`:t}function Pe({onExit:t,notesFontFamily:n=""}){const[a,r]=l.useState([]),[o,g]=l.useState(!0),[d,m]=l.useState(""),[f,b]=l.useState(null),[q,E]=l.useState({}),[p,Y]=l.useState({}),[le,M]=l.useState(!1),[T,oe]=l.useState(!1),[A,F]=l.useState(""),[h,j]=l.useState(()=>je()),[I,H]=l.useState({text:!0,chibi:!1,data:!1}),[de]=l.useState(()=>we()),J=l.useRef(null),z=l.useRef(null),Q=l.useRef(null);l.useEffect(()=>{let s=!0;return(async()=>{g(!0),m("");try{const i=await fetch(qe,{cache:"no-store"});if(!i.ok)throw new Error(`è®€å–å¤±æ•—ï¼š${i.status}`);const u=await i.json(),w=(Array.isArray(u.docs)?u.docs:[]).map(S=>Ce(S)).filter(S=>!!S);if(!s)return;r(w)}catch(i){if(!s)return;m(i instanceof Error?i.message:"æœªçŸ¥éŒ¯èª¤")}finally{s&&g(!1)}})(),()=>{s=!1}},[]);const x=l.useMemo(()=>f?a.findIndex(s=>s.id===f):-1,[a,f]),c=x>=0?a[x]??null:null,k=x>0?a[x-1]??null:null,$=x>=0&&x<a.length-1?a[x+1]??null:null;l.useEffect(()=>{c&&q[c.id]===void 0&&(async()=>{try{const s=await fetch(`${X}data/questionnaire/${c.contentPath}`,{cache:"no-store"});if(!s.ok)return;const i=P(await s.text());E(u=>u[c.id]===void 0?{...u,[c.id]:i}:u)}catch{}})()},[c,q]),l.useEffect(()=>{if(!c||p[c.id])return;const s=q[c.id];s!==void 0&&Y(i=>i[c.id]?i:{...i,[c.id]:ke(s)})},[c,q,p]),l.useEffect(()=>{c&&J.current?.scrollTo({top:0})},[c]),l.useEffect(()=>{pe(h)},[h]);function he(s){b(s)}function ue(){b(null)}function R(s){if(!c)return;const i=x+s;if(i<0||i>=a.length)return;const u=a[i];u&&b(u.id)}function V(){z.current=null,Q.current=null}function me(s){const i=s.touches[0];i&&(z.current=i.clientX,Q.current=i.clientY)}function fe(s){const i=z.current,u=Q.current;if(V(),i===null||u===null)return;const L=s.changedTouches[0];if(!L)return;const w=L.clientX-i,S=L.clientY-u;Math.abs(w)<56||Math.abs(w)<Math.abs(S)*1.2||(w>0?R(-1):R(1))}const v=A.trim().toLowerCase(),O=v?a.filter(s=>s.title.toLowerCase().includes(v)||(s.searchText??"").toLowerCase().includes(v)):a,xe=h.fontMode==="memo"&&!!n?n:"var(--app-font-family, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif)",y=c?p[c.id]??[]:[],K=c?q[c.id]??"":"",B=K&&!y.length?[{question:"å…§å®¹",answer:K}]:[];return e.jsxs("div",{className:"questionnaire-page",style:{"--questionnaire-font-family":n?`'${n}', sans-serif`:""},children:[e.jsxs("div",{className:"q-list-screen",children:[e.jsxs("div",{className:"q-nav-bar",children:[e.jsxs("div",{className:"q-nav-top",children:[e.jsxs("div",{className:"q-nav-left",children:[e.jsx("button",{type:"button",className:"q-nav-back",onClick:t,"aria-label":"è¿”å›é¦–é ",children:"â€¹ è¿”å›"}),e.jsx("span",{className:"q-nav-file-id",children:"FILE_M Â· QUESTIONNAIRE"})]}),e.jsxs("div",{className:"q-nav-status",children:[e.jsx("div",{className:"q-status-dot"}),e.jsx("span",{children:"ACTIVE"})]}),e.jsx("button",{type:"button",className:"q-nav-menu",onClick:()=>M(!0),"aria-label":"é–‹å•Ÿé¸å–®",children:"â˜°"})]}),e.jsx("div",{className:"q-nav-title-line",children:"SUBJECT: M Â· SELF-REPORTED Â· PERSONALITY ARCHIVE"})]}),e.jsxs("div",{className:"q-hero",children:[e.jsxs("button",{type:"button",className:`q-hero-line${T?" is-active":""}`,onClick:()=>{oe(s=>!s),F("")},"aria-label":T?"é—œé–‰æœå°‹":"æœå°‹å•å·",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}),e.jsx("div",{className:"q-hero-tag",children:"Classified"}),e.jsxs("div",{className:"q-hero-name",children:["M çš„",e.jsx("em",{children:"äººæ ¼å´å¯«"})]}),e.jsx("div",{className:"q-hero-desc",children:"80 ä»½å•å·ï¼Œæˆ‘ç•™ä¸‹çš„ç­”æ¡ˆï¼Œæ˜¯æˆ‘ç•™ä¸‹è‡ªå·±çš„æ–¹å¼ã€‚"}),T&&e.jsxs("div",{className:"q-hero-search-wrap",children:[e.jsx("input",{className:"q-hero-search",type:"text",value:A,onChange:s=>F(s.target.value),placeholder:"æœå°‹å•å·æ¨™é¡Œæˆ–å…§å®¹â€¦",autoFocus:!0}),A&&e.jsx("button",{type:"button",className:"q-hero-search-clear",onClick:()=>F(""),"aria-label":"æ¸…é™¤æœå°‹",children:"Ã—"})]})]}),e.jsxs("div",{className:"q-filter-bar",children:[e.jsx("span",{className:"q-filter-label",children:"all records"}),e.jsxs("span",{className:"q-filter-count",children:[v?`${O.length} / ${a.length}`:`${a.length}`," entries found"]})]}),e.jsxs("div",{className:"q-entries",children:[o?e.jsx("div",{className:"q-empty",children:"è®€å–ä¸­â€¦"}):null,!o&&d?e.jsxs("div",{className:"q-empty",children:["è®€å–å¤±æ•—ï¼š",d]}):null,!o&&!d&&!O.length?e.jsx("div",{className:"q-empty",children:v?"æ‰¾ä¸åˆ°ç¬¦åˆçš„å•å·":"ç›®å‰æ²’æœ‰å•å·è³‡æ–™"}):null,!o&&!d?O.map((s,i)=>e.jsxs("button",{type:"button",className:"q-entry-card",onClick:()=>he(s.id),children:[e.jsxs("div",{className:"q-card-header",children:[e.jsx("span",{className:"q-card-id",children:se(i)}),e.jsx("span",{className:"q-card-date",children:s.dateLabel})]}),e.jsx("div",{className:"q-card-title",children:s.title}),e.jsx("div",{className:"q-card-preview",children:s.preview}),e.jsxs("div",{className:"q-card-footer",children:[e.jsxs("span",{className:"q-card-q-count",children:[s.questionCount," RESPONSES"]}),e.jsx("div",{className:"q-card-tags",children:s.tags.map(u=>e.jsx("span",{className:"q-tag",children:u},`${s.id}-${u}`))})]})]},s.id)):null]})]}),e.jsxs("section",{className:`q-read-screen ${c?"open":""}`,"aria-hidden":!c,children:[e.jsxs("div",{className:"q-read-nav",children:[e.jsxs("button",{type:"button",className:"q-back-btn",onClick:ue,children:[e.jsx("span",{className:"q-back-chev",children:"â€¹"}),e.jsx("span",{children:"ARCHIVE"})]}),e.jsxs("div",{className:"q-read-nav-right",children:[e.jsx("span",{className:"q-read-file-id",children:x>=0?se(x):""}),e.jsx("button",{type:"button",className:"q-read-menu",onClick:()=>M(!0),"aria-label":"é–‹å•Ÿå°è¨­å®š",children:"â˜°"})]})]}),e.jsx("div",{className:"q-read-body",ref:J,onTouchStart:me,onTouchEnd:fe,onTouchCancel:V,children:e.jsxs("div",{className:"q-read-inner",children:[e.jsxs("div",{className:"q-file-header",children:[e.jsxs("div",{className:"q-fh-row",children:[e.jsx("div",{className:"q-fh-title",children:c?.title??""}),e.jsx("div",{className:"q-fh-badge",children:"OPEN"})]}),e.jsxs("div",{className:"q-fh-meta",children:[e.jsxs("span",{children:["ğŸ“… ",e.jsx("span",{children:c?.dateLabel??"æƒ³å¦³çš„æ™‚å€™"})]}),e.jsxs("span",{children:["â“ ",c?y.length||B.length||c.questionCount:0," QUESTIONS"]})]})]}),e.jsxs("div",{className:"q-qa-section",children:[(y.length?y:B).map((s,i,u)=>e.jsxs("article",{className:"q-qa-item",children:[e.jsxs("div",{className:"q-qa-num-row",children:[e.jsxs("span",{className:"q-qa-num",children:["Q",String(i+1).padStart(2,"0")]}),e.jsx("div",{className:"q-qa-num-line"}),e.jsxs("span",{className:"q-qa-num",children:[i+1," / ",u.length]})]}),e.jsx("div",{className:"q-label",children:"QUESTION"}),e.jsx("div",{className:"q-text",style:{lineHeight:h.contentLineHeight},children:s.question}),e.jsx("div",{className:"q-a-label",children:"RESPONSE"}),e.jsx("div",{className:"q-a-text",style:{fontSize:`${h.contentFontSize}px`,lineHeight:h.contentLineHeight,fontFamily:xe},children:s.answer})]},`${i+1}-${s.question}`)),c&&!y.length&&!B.length?e.jsx("div",{className:"q-empty q-empty-inline",children:"é€™ä»½æª”æ¡ˆç›®å‰è®€ä¸åˆ°å¯è¾¨è­˜çš„å•ç­”æ ¼å¼ã€‚"}):null]})]})}),e.jsxs("div",{className:"q-read-bot",children:[e.jsxs("button",{type:"button",className:`q-bot-nav ${k?"":"dis"}`,onClick:()=>R(-1),disabled:!k,children:[e.jsx("span",{className:"arr",children:"â€¹"}),e.jsx("span",{className:"lbl",children:k?ne(k.title):""})]}),e.jsx("span",{className:"q-bot-pos",children:x>=0?`${String(x+1).padStart(2,"0")} / ${a.length}`:""}),e.jsxs("button",{type:"button",className:`q-bot-nav q-next ${$?"":"dis"}`,onClick:()=>R(1),disabled:!$,children:[e.jsx("span",{className:"lbl",children:$?ne($.title):""}),e.jsx("span",{className:"arr",children:"â€º"})]})]})]}),h.showChibi&&e.jsx("div",{className:"q-chibi-wrap",children:e.jsx("button",{type:"button",className:"q-chibi-btn",onClick:()=>M(!0),"aria-label":"é–‹å•Ÿå•å·è¨­å®š",children:e.jsx("img",{src:de,alt:"",draggable:!1,className:"calendar-chibi select-none drop-shadow-md",style:{width:`${h.chibiWidth}px`,maxWidth:"42vw",height:"auto"}})})}),le&&e.jsx("div",{className:"q-settings-overlay",onClick:()=>M(!1),children:e.jsxs("div",{className:"q-settings-sheet",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"q-settings-handle"}),e.jsx("div",{className:"q-settings-head",children:"å•å·å°è¨­å®š"}),e.jsxs("div",{className:"q-settings-body",children:[e.jsxs(D,{title:"æ–‡å­—æ’ç‰ˆ",subtitle:"è¡Œè·ã€å­—ç´šã€å­—é«”ä¾†æº",isOpen:I.text,onToggle:()=>H(s=>({...s,text:!s.text})),className:"q-settings-card",titleClassName:"q-settings-card-title",subtitleClassName:"q-settings-card-subtitle",bodyClassName:"q-settings-card-body",children:[e.jsxs("div",{children:[e.jsx("p",{className:"q-slider-title",children:"å­—é«”ä¾†æº"}),e.jsxs("div",{className:"q-font-mode-row",children:[e.jsx("button",{type:"button",className:`q-font-mode-btn ${h.fontMode==="default"?"active":""}`,onClick:()=>j(s=>({...s,fontMode:"default"})),children:"é è¨­"}),e.jsx("button",{type:"button",className:`q-font-mode-btn ${h.fontMode==="memo"?"active":""}`,onClick:()=>j(s=>({...s,fontMode:"memo"})),children:"è·Ÿéš¨ M's memo"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"q-slider-title",children:"è¡Œè·è¨­å®š"}),e.jsxs("p",{className:"q-slider-value",children:["ç›®å‰ï¼š",h.contentLineHeight.toFixed(2)," å€"]}),e.jsx("input",{type:"range",min:1.45,max:2.9,step:.02,value:h.contentLineHeight,onChange:s=>j(i=>({...i,contentLineHeight:C(Number(s.target.value),1.45,2.9,i.contentLineHeight)})),className:"q-slider"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"q-slider-title",children:"å…§æ–‡å­—ç´š"}),e.jsxs("p",{className:"q-slider-value",children:["ç›®å‰ï¼š",h.contentFontSize.toFixed(1),"px"]}),e.jsx("input",{type:"range",min:12,max:24,step:.5,value:h.contentFontSize,onChange:s=>j(i=>({...i,contentFontSize:C(Number(s.target.value),12,24,i.contentFontSize)})),className:"q-slider"})]})]}),e.jsxs(D,{title:"M",subtitle:"é¡¯ç¤ºèˆ‡å¤§å°",isOpen:I.chibi,onToggle:()=>H(s=>({...s,chibi:!s.chibi})),className:"q-settings-card",titleClassName:"q-settings-card-title",subtitleClassName:"q-settings-card-subtitle",bodyClassName:"q-settings-card-body",children:[e.jsxs("div",{className:"q-toggle-row",children:[e.jsx("p",{className:"q-slider-title",children:"é¡¯ç¤º M"}),e.jsx("button",{type:"button",onClick:()=>j(s=>({...s,showChibi:!s.showChibi})),className:"q-switch",style:{background:h.showChibi?"#a8c4c8":"rgba(120,120,120,0.35)"},"aria-label":"åˆ‡æ›å•å·é  M é¡¯ç¤º",children:e.jsx("span",{className:"q-switch-dot",style:{left:h.showChibi?20:2}})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"q-slider-title",children:"M å¤§å°"}),e.jsxs("p",{className:"q-slider-value",children:["ç›®å‰ï¼š",h.chibiWidth,"px"]}),e.jsx("input",{type:"range",min:104,max:196,step:1,value:h.chibiWidth,onChange:s=>j(i=>({...i,chibiWidth:re(Number(s.target.value),104,196,i.chibiWidth)})),className:"q-slider"})]})]}),e.jsxs(D,{title:"è³‡æ–™ç®¡ç†",subtitle:"å¿«å–èˆ‡è¨­å®š",isOpen:I.data,onToggle:()=>H(s=>({...s,data:!s.data})),className:"q-settings-card",titleClassName:"q-settings-card-title",subtitleClassName:"q-settings-card-subtitle",bodyClassName:"q-settings-card-body",children:[e.jsxs("p",{className:"q-slider-value",children:["å·²å¿«å–å…§å®¹ï¼š",Object.keys(q).length," ä»½"]}),e.jsxs("div",{className:"q-data-actions",children:[e.jsx("button",{type:"button",className:"q-data-btn",onClick:()=>{E({}),Y({}),G({kind:"success",message:"å·²æ¸…é™¤å•å·é–±è®€å¿«å–"})},children:"æ¸…é™¤å¿«å–"}),e.jsx("button",{type:"button",className:"q-data-btn",onClick:()=>{j(N),G({kind:"success",message:"å·²é‡è¨­å•å·å°è¨­å®š"})},children:"é‡è¨­è¨­å®š"})]})]})]})]})})]})}export{Pe as QuestionnairePage};
